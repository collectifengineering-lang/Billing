(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[552],{45955:function(e,s,t){Promise.resolve().then(t.bind(t,84064))},84064:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return d}});var a=t(57437),r=t(90483),n=t(2265),c=t(27648),i=t(32660),l=t(65302),o=t(45131);function d(){let{user:e,loading:s}=(0,r.a)(),[t,d]=(0,n.useState)(null),[m,u]=(0,n.useState)(!1);return((0,n.useEffect)(()=>{(async()=>{u(!0);try{let e=await fetch("/api/auth/admin-test"),s=await e.json();d(s)}catch(e){d({error:e instanceof Error?e.message:"Unknown error"})}finally{u(!1)}})()},[]),s)?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm border-b",children:(0,a.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsx)("div",{className:"flex items-center justify-between h-16",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(c.default,{href:"/",className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(i.Z,{className:"w-5 h-5"})}),(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Access Test"})]})})})}),(0,a.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"User Authentication Status"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"Authenticated:"}),(0,a.jsxs)("span",{className:"flex items-center ".concat(e?"text-green-600":"text-red-600"),children:[e?(0,a.jsx)(l.Z,{className:"w-4 h-4 mr-2"}):(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),e?"Yes":"No"]})]}),e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"User ID:"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.id})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"Name:"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.name})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"Email:"}),(0,a.jsx)("span",{className:"text-sm text-gray-900",children:e.email})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"Is Admin:"}),(0,a.jsxs)("span",{className:"flex items-center ".concat(e.isAdmin?"text-green-600":"text-red-600"),children:[e.isAdmin?(0,a.jsx)(l.Z,{className:"w-4 h-4 mr-2"}):(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),e.isAdmin?"Yes":"No"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"Is Basic User:"}),(0,a.jsxs)("span",{className:"flex items-center ".concat(e.isBasic?"text-green-600":"text-red-600"),children:[e.isBasic?(0,a.jsx)(l.Z,{className:"w-4 h-4 mr-2"}):(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),e.isBasic?"Yes":"No"]})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Environment Variable Test"}),m?(0,a.jsxs)("div",{className:"text-center py-4",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-gray-600",children:"Testing environment variables..."})]}):t?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"API Success:"}),(0,a.jsxs)("span",{className:"flex items-center ".concat(t.success?"text-green-600":"text-red-600"),children:[t.success?(0,a.jsx)(l.Z,{className:"w-4 h-4 mr-2"}):(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),t.success?"Yes":"No"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"Environment Variable Exists:"}),(0,a.jsxs)("span",{className:"flex items-center ".concat(t.envVarExists?"text-green-600":"text-red-600"),children:[t.envVarExists?(0,a.jsx)(l.Z,{className:"w-4 h-4 mr-2"}):(0,a.jsx)(o.Z,{className:"w-4 h-4 mr-2"}),t.envVarExists?"Yes":"No"]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"Raw Value:"}),(0,a.jsx)("span",{className:"text-sm text-gray-900 font-mono bg-gray-100 px-2 py-1 rounded",children:t.adminEmails||"undefined"})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"Parsed Array:"}),(0,a.jsxs)("span",{className:"text-sm text-gray-900",children:["[",t.adminEmailsArray.join(", "),"]"]})]}),t.error&&(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm font-medium text-gray-500",children:"Error:"}),(0,a.jsx)("span",{className:"text-sm text-red-600",children:t.error})]})]}):(0,a.jsx)("p",{className:"text-gray-500",children:"No environment test data available"})]}),(0,a.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-blue-900 mb-4",children:"Troubleshooting"}),(0,a.jsxs)("div",{className:"space-y-3 text-sm text-blue-800",children:[(0,a.jsx)("p",{children:'If you\'re getting "Access Denied" errors:'}),(0,a.jsxs)("ol",{className:"list-decimal list-inside space-y-2 ml-4",children:[(0,a.jsxs)("li",{children:["Check that your email is in the ",(0,a.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"NEXT_PUBLIC_ADMIN_EMAILS"})," environment variable"]}),(0,a.jsxs)("li",{children:["Ensure your email ends with ",(0,a.jsx)("code",{className:"bg-blue-100 px-1 rounded",children:"@collectif.nyc"})]}),(0,a.jsx)("li",{children:"Verify you're properly authenticated with Azure AD"}),(0,a.jsx)("li",{children:"Check the browser console for debug information"})]})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border p-6",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Test Admin Pages"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(c.default,{href:"/settings",className:"block w-full text-left px-4 py-2 text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-md",children:"Test Settings Page"}),(0,a.jsx)(c.default,{href:"/dashboard",className:"block w-full text-left px-4 py-2 text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded-md",children:"Test Dashboard Page"})]})]})]})})]})}},90483:function(e,s,t){"use strict";t.d(s,{AuthProvider:function(){return g},a:function(){return N}});var a=t(57437),r=t(2265),n=t(96244);let c="72ed6933-6bc6-430e-a75a-cb5d2e1c20e1",i="e4748cdc-321b-4db0-bc36-141b121a9117";c&&i||(console.warn("Azure AD environment variables are not set. Authentication will not work."),console.warn("Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file"));let l={auth:{clientId:c||"dummy-client-id",authority:"https://login.microsoftonline.com/".concat(i||"dummy-tenant-id"),redirectUri:window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}},o=new n.Lx(l),d={scopes:["User.Read","Directory.Read.All"]};function m(e){if(!e)return console.warn("checkAdminStatus: No user email provided"),!1;try{var s;if((((s="jonathan@collectif.nyc,Rafael@collectif.nyc",void 0===s)?void 0:s.split(",").map(e=>e.trim()))||[]).includes(e))return console.log("checkAdminStatus: User is admin via NEXT_PUBLIC_ADMIN_EMAILS"),!0}catch(e){console.warn("checkAdminStatus: Error checking NEXT_PUBLIC_ADMIN_EMAILS:",e)}if(e.endsWith("@collectif.nyc"))return console.log("checkAdminStatus: User is admin via @collectif.nyc domain"),!0;try{if(localStorage.getItem("adminOverride")===e)return console.log("checkAdminStatus: User is admin via localStorage override"),!0}catch(e){console.warn("checkAdminStatus: Error checking localStorage override:",e)}for(let s of[/^admin@/i,/^administrator@/i,/^superuser@/i,/^root@/i])if(s.test(e))return console.log("checkAdminStatus: User is admin via pattern match:",s),!0;return console.log("checkAdminStatus: User is not admin:",e),!1}async function u(){try{if(!c||!i)throw Error("Azure AD environment variables are not configured. Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file");return await o.loginRedirect(d),null}catch(e){throw console.error("Sign in error:",e),e}}async function x(){try{await o.logoutPopup()}catch(e){console.error("Sign out error:",e)}}async function h(){try{let e=o.getActiveAccount();if(!e)return console.log("getAuthUser: No active account found"),null;let s=null;try{let e=await o.acquireTokenSilent({scopes:["User.Read","Directory.Read.All"]}),t=await fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(e.accessToken)}});if(!t.ok)throw Error("Failed to fetch user details from Graph API");s=await t.json(),console.log("getAuthUser: Successfully fetched user data from Graph API")}catch(t){console.warn("getAuthUser: Graph API failed, using fallback data:",t),s={mail:e.username,userPrincipalName:e.username,displayName:e.name}}let t=s.mail||s.userPrincipalName||e.username,a=m(t);return console.log("getAuthUser Debug:",{userEmail:t,accountName:e.name,accountId:e.localAccountId,isAdmin:a,adminEmails:"jonathan@collectif.nyc,Rafael@collectif.nyc",envVarAccessible:!0}),{id:e.localAccountId,name:s.displayName||e.name||"",email:t||"",isAdmin:a,isBasic:!0}}catch(e){console.error("getAuthUser error:",e);try{let e=o.getActiveAccount();if(!e)return console.log("getAuthUser: No account available for fallback"),null;let s=e.username,t=m(s);return console.log("getAuthUser Fallback Debug:",{accountEmail:s,accountName:e.name,isAdmin:t}),{id:e.localAccountId||"fallback-user",name:e.name||"Unknown User",email:s||"",isAdmin:t,isBasic:!0}}catch(e){return console.error("getAuthUser: Fallback also failed:",e),null}}}let f=(0,r.createContext)(void 0);function g(e){let{children:s}=e,[t,n]=(0,r.useState)(null),[c,i]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{try{await o.initialize();let e=await o.handleRedirectPromise();e&&(console.log("Redirect response received:",e),o.setActiveAccount(e.account));let s=await h();n(s)}catch(e){console.error("Auth initialization error:",e)}finally{i(!1)}})()},[]);let l=async()=>{try{i(!0),await u()}catch(e){console.error("Sign in error:",e),i(!1)}},d=async()=>{try{i(!0),await x(),n(null)}catch(e){console.error("Sign out error:",e)}finally{i(!1)}};return(0,a.jsx)(f.Provider,{value:{user:t,loading:c,signIn:l,signOut:d},children:s})}function N(){let e=(0,r.useContext)(f);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},32660:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(39763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},65302:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(39763).Z)("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},45131:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(39763).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])}},function(e){e.O(0,[451,244,971,117,744],function(){return e(e.s=45955)}),_N_E=e.O()}]);