(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[552],{45955:function(e,n,i){Promise.resolve().then(i.bind(i,84064))},84064:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return s}});var t=i(57437),a=i(90483),c=i(2265);function s(){let{user:e,loading:n}=(0,a.a)(),[i,s]=(0,c.useState)({}),[r,o]=(0,c.useState)(null),[l,d]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let i={NEXT_PUBLIC_ADMIN_EMAILS:"jonathan@collectif.nyc,Rafael@collectif.nyc",userEmail:null==e?void 0:e.email,userIsAdmin:null==e?void 0:e.isAdmin,loading:n,user:e?{id:e.id,email:e.email,isAdmin:e.isAdmin,isBasic:e.isBasic}:null};console.log("AdminTest Debug Info:",i),s(i)},[e,n]);let u=async()=>{if(null==e?void 0:e.email){d(!0);try{let n=await fetch("/api/auth/admin-test?email=".concat(encodeURIComponent(e.email))),i=await n.json();o(i),console.log("Server admin test result:",i)}catch(e){o({error:e instanceof Error?e.message:"Unknown error"})}finally{d(!1)}}};return n?(0,t.jsx)("div",{children:"Loading..."}):e?(0,t.jsxs)("div",{className:"p-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Admin Access Test"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"p-4 border rounded",children:[(0,t.jsx)("h2",{className:"font-semibold",children:"Environment Variables (Client Side)"}),(0,t.jsx)("pre",{className:"text-sm bg-gray-100 p-2 rounded",children:JSON.stringify(i,null,2)})]}),(0,t.jsxs)("div",{className:"p-4 border rounded",children:[(0,t.jsx)("h2",{className:"font-semibold",children:"User Status"}),(0,t.jsxs)("p",{children:["Email: ",e.email]}),(0,t.jsxs)("p",{children:["Is Admin: ",e.isAdmin?"Yes":"No"]}),(0,t.jsxs)("p",{children:["Is Basic: ",e.isBasic?"Yes":"No"]})]}),(0,t.jsxs)("div",{className:"p-4 border rounded",children:[(0,t.jsx)("h2",{className:"font-semibold",children:"Server-Side Admin Check"}),(0,t.jsx)("button",{onClick:u,disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded disabled:bg-gray-400",children:l?"Testing...":"Test Server Admin Check"}),r&&(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("h3",{className:"font-medium",children:"Server Response:"}),(0,t.jsx)("pre",{className:"text-sm bg-gray-100 p-2 rounded mt-2",children:JSON.stringify(r,null,2)})]})]}),(0,t.jsxs)("div",{className:"p-4 border rounded",children:[(0,t.jsx)("h2",{className:"font-semibold",children:"Access Test"}),e.isAdmin?(0,t.jsx)("div",{className:"text-green-600",children:"✅ You have admin access! You should be able to view the settings and financial dashboard."}):(0,t.jsx)("div",{className:"text-red-600",children:"❌ You do not have admin access. Check the environment variable NEXT_PUBLIC_ADMIN_EMAILS."})]}),(0,t.jsxs)("div",{className:"p-4 border rounded bg-yellow-50",children:[(0,t.jsx)("h2",{className:"font-semibold",children:"Troubleshooting Steps"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside space-y-2 mt-2",children:[(0,t.jsxs)("li",{children:["Check that ",(0,t.jsx)("code",{className:"bg-yellow-100 px-1 rounded",children:"NEXT_PUBLIC_ADMIN_EMAILS=jonathan@collectif.nyc"})," is set in your Vercel environment variables"]}),(0,t.jsx)("li",{children:"Verify the environment variable is deployed (may take a few minutes after setting)"}),(0,t.jsxs)("li",{children:["Check that your email ends with ",(0,t.jsx)("code",{className:"bg-yellow-100 px-1 rounded",children:"@collectif.nyc"})]}),(0,t.jsx)("li",{children:"Look at the browser console for debug information"}),(0,t.jsx)("li",{children:"Try the server-side admin check above"})]})]})]})]}):(0,t.jsx)("div",{children:"Not authenticated"})}},90483:function(e,n,i){"use strict";i.d(n,{AuthProvider:function(){return g},a:function(){return v}});var t=i(57437),a=i(2265),c=i(96244);let s="72ed6933-6bc6-430e-a75a-cb5d2e1c20e1",r="e4748cdc-321b-4db0-bc36-141b121a9117";s&&r||(console.warn("Azure AD environment variables are not set. Authentication will not work."),console.warn("Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file"));let o={auth:{clientId:s||"dummy-client-id",authority:"https://login.microsoftonline.com/".concat(r||"dummy-tenant-id"),redirectUri:window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}},l=new c.Lx(o),d={scopes:["User.Read","Directory.Read.All"]};function u(e){if(!e)return console.warn("checkAdminStatus: No user email provided"),!1;console.log("checkAdminStatus: Checking admin status for:",e);try{var n;let i=((n="jonathan@collectif.nyc,Rafael@collectif.nyc",void 0===n)?void 0:n.split(",").map(e=>e.trim()))||[];if(console.log("checkAdminStatus: Admin emails from env:",i),console.log("checkAdminStatus: Raw NEXT_PUBLIC_ADMIN_EMAILS value:","jonathan@collectif.nyc,Rafael@collectif.nyc"),i.includes(e))return console.log("checkAdminStatus: User is admin via NEXT_PUBLIC_ADMIN_EMAILS"),!0}catch(e){console.warn("checkAdminStatus: Error checking NEXT_PUBLIC_ADMIN_EMAILS:",e)}if(e.endsWith("@collectif.nyc"))return console.log("checkAdminStatus: User is admin via @collectif.nyc domain"),!0;try{if(localStorage.getItem("adminOverride")===e)return console.log("checkAdminStatus: User is admin via localStorage override"),!0}catch(e){console.warn("checkAdminStatus: Error checking localStorage override:",e)}for(let n of[/^admin@/i,/^administrator@/i,/^superuser@/i,/^root@/i])if(n.test(e))return console.log("checkAdminStatus: User is admin via pattern match:",n),!0;return"jonathan@collectif.nyc"===e?(console.log("checkAdminStatus: User is admin via hardcoded fallback"),!0):(console.log("checkAdminStatus: User is not admin:",e),!1)}async function m(){try{if(!s||!r)throw Error("Azure AD environment variables are not configured. Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file");return await l.loginRedirect(d),null}catch(e){throw console.error("Sign in error:",e),e}}async function h(){try{await l.logoutPopup()}catch(e){console.error("Sign out error:",e)}}async function f(){try{let e=l.getActiveAccount();if(!e)return console.log("getAuthUser: No active account found"),null;let n=null;try{let e=await l.acquireTokenSilent({scopes:["User.Read","Directory.Read.All"]}),i=await fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(e.accessToken)}});if(!i.ok)throw Error("Failed to fetch user details from Graph API");n=await i.json(),console.log("getAuthUser: Successfully fetched user data from Graph API")}catch(i){console.warn("getAuthUser: Graph API failed, using fallback data:",i),n={mail:e.username,userPrincipalName:e.username,displayName:e.name}}let i=n.mail||n.userPrincipalName||e.username,t=u(i);return console.log("getAuthUser Debug:",{userEmail:i,accountName:e.name,accountId:e.localAccountId,isAdmin:t,adminEmails:"jonathan@collectif.nyc,Rafael@collectif.nyc",envVarAccessible:!0}),{id:e.localAccountId,name:n.displayName||e.name||"",email:i||"",isAdmin:t,isBasic:!0}}catch(e){console.error("getAuthUser error:",e);try{let e=l.getActiveAccount();if(!e)return console.log("getAuthUser: No account available for fallback"),null;let n=e.username,i=u(n);return console.log("getAuthUser Fallback Debug:",{accountEmail:n,accountName:e.name,isAdmin:i}),{id:e.localAccountId||"fallback-user",name:e.name||"Unknown User",email:n||"",isAdmin:i,isBasic:!0}}catch(e){return console.error("getAuthUser: Fallback also failed:",e),null}}}let A=(0,a.createContext)(void 0);function g(e){let{children:n}=e,[i,c]=(0,a.useState)(null),[s,r]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{await l.initialize();let e=await l.handleRedirectPromise();e&&(console.log("Redirect response received:",e),l.setActiveAccount(e.account));let n=await f();c(n)}catch(e){console.error("Auth initialization error:",e)}finally{r(!1)}})()},[]);let o=async()=>{try{r(!0),await m()}catch(e){console.error("Sign in error:",e),r(!1)}},d=async()=>{try{r(!0),await h(),c(null)}catch(e){console.error("Sign out error:",e)}finally{r(!1)}};return(0,t.jsx)(A.Provider,{value:{user:i,loading:s,signIn:o,signOut:d},children:n})}function v(){let e=(0,a.useContext)(A);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},function(e){e.O(0,[244,971,117,744],function(){return e(e.s=45955)}),_N_E=e.O()}]);