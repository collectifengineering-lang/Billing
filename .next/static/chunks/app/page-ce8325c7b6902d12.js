(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{78929:function(e,t,r){Promise.resolve().then(r.bind(r,36800))},36800:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return ed}});var a=r(57437),s=r(2265),l=r(27648),i=r(98239),o=r(48614),n=r(63639),d=r(58896),c=r(46221),x=r(98420),m=r(95252),h=r(91723),u=r(33327),b=r(48736),g=r(70525),p=r(95805),j=r(42488),f=r(11239),y=r(76858),v=r(32489),w=r(31047),N=r(66070),k=r(35974);function C(e){let{isOpen:t,onClose:r,project:s}=e;if(!s)return null;let l=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),n=e=>"".concat((100*e).toFixed(1),"%");return(0,a.jsx)(o.M,{children:t&&(0,a.jsx)(i.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",onClick:r,children:(0,a.jsxs)(i.E.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{type:"spring",damping:25,stiffness:300},className:"bg-white dark:bg-slate-800 rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-slate-700",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:(0,a.jsx)(x.Z,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:s.name}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:s.customer})]})]}),(0,a.jsx)("button",{onClick:r,className:"p-2 hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors duration-200",children:(0,a.jsx)(v.Z,{className:"h-6 w-6 text-gray-500"})})]}),(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(k.C,{className:"".concat((e=>{switch(e){case"active":return"bg-green-100 text-green-800 border-green-200";case"completed":return"bg-blue-100 text-blue-800 border-blue-200";case"on-hold":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}})(s.status)," border"),children:s.status.charAt(0).toUpperCase()+s.status.slice(1)}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-300",children:[(0,a.jsx)(w.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:new Date(s.startDate).toLocaleDateString()}),s.endDate&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{children:"-"}),(0,a.jsx)("span",{children:new Date(s.endDate).toLocaleDateString()})]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Budget"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l(s.budget)})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,a.jsx)(N.Zb,{className:"bg-gradient-to-r from-blue-50 to-blue-100 dark:from-blue-900/20 dark:to-blue-800/20 border-0",children:(0,a.jsx)(N.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(m.Z,{className:"h-8 w-8 text-blue-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-blue-600 dark:text-blue-400",children:"Revenue"}),(0,a.jsx)("p",{className:"text-xl font-bold text-blue-900 dark:text-blue-100",children:l(s.revenue)})]})]})})}),(0,a.jsx)(N.Zb,{className:"bg-gradient-to-r from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 border-0",children:(0,a.jsx)(N.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(h.Z,{className:"h-8 w-8 text-green-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Hours"}),(0,a.jsxs)("p",{className:"text-xl font-bold text-green-900 dark:text-green-100",children:[s.hours,"h"]})]})]})})}),(0,a.jsx)(N.Zb,{className:"bg-gradient-to-r from-purple-50 to-purple-100 dark:from-purple-900/20 dark:to-purple-800/20 border-0",children:(0,a.jsx)(N.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(d.Z,{className:"h-8 w-8 text-purple-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-purple-600 dark:text-purple-400",children:"Efficiency"}),(0,a.jsx)("p",{className:"text-xl font-bold text-purple-900 dark:text-purple-100",children:n(s.efficiency)})]})]})})}),(0,a.jsx)(N.Zb,{className:"bg-gradient-to-r from-orange-50 to-orange-100 dark:from-orange-900/20 dark:to-orange-800/20 border-0",children:(0,a.jsx)(N.aY,{className:"p-4",children:(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(g.Z,{className:"h-8 w-8 text-orange-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Profit Margin"}),(0,a.jsx)("p",{className:"text-xl font-bold text-orange-900 dark:text-orange-100",children:n(s.profitMargin)})]})]})})})]}),(0,a.jsxs)(N.Zb,{className:"border-0 shadow-lg",children:[(0,a.jsxs)(N.Ol,{children:[(0,a.jsx)(N.ll,{className:"text-xl font-bold",children:"Financial Summary"}),(0,a.jsx)(N.SZ,{children:"Project financial performance overview"})]}),(0,a.jsx)(N.aY,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Total Budget"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l(s.budget)})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Amount Billed"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:l(s.billed)})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"Remaining"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:l(s.budget-s.billed)})]})]})})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-slate-700",children:[(0,a.jsx)("button",{onClick:r,className:"px-4 py-2 text-gray-600 dark:text-gray-300 hover:text-gray-800 dark:hover:text-white transition-colors duration-200",children:"Close"}),(0,a.jsx)("button",{className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:"View Full Details"})]})]})]})})})}var S=r(29),E=r.n(S),P=r(54887),Z=r(60413),I=r(94508),F=r(22135),T=r(40875),O=r(73247),A=r(92369),D=r(30401),R=r(69064),M=r(92735),H=r(17689),L=r(65302),B=r(22252);function z(e){let t=[],r="",a=!1;for(let s=0;s<e.length;s++){let l=e[s];'"'===l?a&&'"'===e[s+1]?(r+='"',s++):a=!a:","!==l||a?r+=l:(t.push(r.trim()),r="")}return t.push(r.trim()),t}function Y(e){let[t,r]=e.split("-");return new Date(parseInt(t),parseInt(r)-1).toLocaleDateString("en-US",{month:"short",year:"numeric"})}function U(e,t){let r=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");if(void 0!==a.download){let e=URL.createObjectURL(r);a.setAttribute("href",e),a.setAttribute("download",t),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}function V(e){let{billingData:t,monthlyProjections:r,asrFees:l,signedFees:i,monthRange:o,onImportData:n}=e,[d,c]=(0,s.useState)(!1),[x,m]=(0,s.useState)(null),[h,u]=(0,s.useState)(!1),g=(0,s.useRef)(null),p=async e=>{var r;let a=null===(r=e.target.files)||void 0===r?void 0:r[0];if(a){if(!a.name.toLowerCase().endsWith(".csv")){R.Am.error("Please select a CSV file");return}c(!0),m(null);try{let e=await new Promise((e,t)=>{let r=new FileReader;r.onload=t=>{var r;e(null===(r=t.target)||void 0===r?void 0:r.result)},r.onerror=()=>{t(Error("Failed to read CSV file"))},r.readAsText(a)}),r=function(e,t){try{let r=e.trim().split("\n");if(r.length<2)return{success:!1,errors:["CSV file must have at least a header row and one data row"]};let a=z(r[0]),s=r.slice(1),l=["Project ID","Project Name","Customer Name","Signed Fee","ASR Fee"].filter(e=>!a.includes(e));if(l.length>0)return{success:!1,errors:["Missing required headers: ".concat(l.join(", "))]};let i=a.slice(5),o=i.filter(e=>!/^\d{4}-\d{2}$/.test(e));if(o.length>0)return{success:!1,errors:["Invalid month format found: ".concat(o.join(", "),". Expected format: YYYY-MM")]};let n={},d=[];if(s.forEach((e,r)=>{let s=z(e);if(s.length!==a.length){d.push("Row ".concat(r+2,": Column count mismatch. Expected ").concat(a.length,", got ").concat(s.length));return}let l=s[0].trim();if(s[1],s[2],parseFloat(s[3]),parseFloat(s[4]),!t.some(e=>e.projectId===l)){d.push("Row ".concat(r+2,': Project ID "').concat(l,'" not found in current data'));return}let o={};i.forEach((e,t)=>{let r=parseFloat(s[5+t])||0;o[e]=r}),n[l]=o}),d.length>0)return{success:!1,errors:d,data:n};return{success:!0,data:n,message:"Successfully imported ".concat(Object.keys(n).length," projects with ").concat(i.length," months of data")}}catch(e){return{success:!1,errors:["Error parsing CSV: ".concat(e instanceof Error?e.message:"Unknown error")]}}}(e,t);m(r),r.success&&r.data?R.Am.success(r.message||"Import completed successfully!"):R.Am.error("Import failed. Please check the errors below.")}catch(e){console.error("Import error:",e),R.Am.error("Failed to read CSV file"),m({success:!1,errors:["Failed to read CSV file"]})}finally{c(!1)}}},j=()=>{u(!1),m(null),g.current&&(g.current.value="")};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,a.jsxs)("button",{onClick:()=>{try{let e=function(e,t,r,a,s){let l=["Project ID","Project Name","Customer Name","Signed Fee","ASR Fee",...s.map(e=>Y(e))],i=e.map(e=>{let l={projectId:e.projectId,projectName:e.projectName,customerName:e.customerName,signedFee:a[e.projectId]||e.signedFee||0,asrFee:r[e.projectId]||0};return s.forEach(r=>{var a;let s=(null===(a=t[e.projectId])||void 0===a?void 0:a[r])||0;l[r]=s}),l});return[l.join(","),...i.map(e=>l.map(t=>{let r;if("Project ID"===t){let t=e.projectId;console.log("CSV Export - Project ID type:",typeof t,"value:",t),console.log("CSV Export - Final Project ID value:",r="number"==typeof t||"string"==typeof t?String(t):"")}else if("Project Name"===t)r=e.projectName;else if("Customer Name"===t)r=e.customerName;else if("Signed Fee"===t)r=e.signedFee;else if("ASR Fee"===t)r=e.asrFee;else{let a=s.find(e=>Y(e)===t);r=a?e[a]:0}let a=String(r).replace(/"/g,'""');return'"'.concat(a,'"')}).join(","))].join("\n")}(t,r,l,i,o),a=function(){let e=new Date,t=e.toISOString().slice(0,10),r=e.toTimeString().slice(0,8).replace(/:/g,"-");return"projections-export-".concat(t,"-").concat(r,".csv")}();U(e,a),R.Am.success("Projections exported successfully!")}catch(e){console.error("Export error:",e),R.Am.error("Failed to export projections")}},className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[(0,a.jsx)(M.Z,{className:"w-4 h-4"}),"Export to CSV"]}),(0,a.jsxs)("button",{onClick:()=>{u(!0),m(null)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,a.jsx)(H.Z,{className:"w-4 h-4"}),"Import from CSV"]}),(0,a.jsxs)("button",{onClick:()=>{U("Project ID,Project Name,Customer Name,Signed Fee,ASR Fee,2024-01,2024-02,2024-03,2024-04,2024-05,2024-06\n910829000008470049,Sample Project,Sample Customer,50000,10000,5000,7500,6000,8000,9000,7000","projections-template.csv"),R.Am.success("Template downloaded successfully!")},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[(0,a.jsx)(b.Z,{className:"w-4 h-4"}),"Download Template"]})]}),h&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,a.jsx)(b.Z,{className:"w-5 h-5"}),"Import Projections from CSV"]}),(0,a.jsx)("button",{onClick:j,className:"text-gray-500 hover:text-gray-700",children:(0,a.jsx)(v.Z,{className:"w-5 h-5"})})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Select a CSV file to import projections data. The file should include:"}),(0,a.jsxs)("ul",{className:"text-sm text-gray-600 list-disc list-inside mb-4",children:[(0,a.jsx)("li",{children:"Project ID, Project Name, Customer Name"}),(0,a.jsx)("li",{children:"Signed Fee and ASR Fee columns"}),(0,a.jsx)("li",{children:"Monthly projection columns (format: YYYY-MM)"})]}),(0,a.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,a.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,a.jsx)("strong",{children:"Tip:"}),' Use the "Download Template" button to get a sample CSV file with the correct format.']})}),(0,a.jsx)("input",{ref:g,type:"file",accept:".csv",onChange:p,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",disabled:d})]}),x&&(0,a.jsxs)("div",{className:"mb-4",children:[x.success?(0,a.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,a.jsx)(L.Z,{className:"w-5 h-5 text-green-600"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-green-800 font-medium",children:"Import Successful"}),(0,a.jsx)("p",{className:"text-green-700 text-sm",children:x.message})]})]}):(0,a.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,a.jsx)(B.Z,{className:"w-5 h-5 text-red-600 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-red-800 font-medium",children:"Import Failed"}),x.errors&&(0,a.jsx)("ul",{className:"text-red-700 text-sm mt-1",children:x.errors.map((e,t)=>(0,a.jsx)("li",{className:"list-disc list-inside",children:e},t))})]})]}),!x.success&&x.data&&Object.keys(x.data).length>0&&(0,a.jsx)("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-yellow-800 text-sm",children:'Some data was successfully parsed. You can still import the valid data by clicking "Import Valid Data".'})})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)("button",{onClick:j,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(null==x?void 0:x.data)&&Object.keys(x.data).length>0&&(0,a.jsxs)("button",{onClick:()=>{(null==x?void 0:x.success)&&x.data&&(n(x.data),u(!1),m(null),R.Am.success("Data imported successfully!"))},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:["Import ",x.success?"All":"Valid"," Data"]})]})]})})]})}var J=r(77086);function K(e){let{billingData:t,projections:r,onUpdateProjections:l,closedProjects:i,onClosedProjectsChange:o,useDB:n=!0}=e,d=t||[],[c,x]=(0,s.useState)(null),[m,h]=(0,s.useState)(null),[u,b]=(0,s.useState)(null),[g,p]=(0,s.useState)(""),[j,f]=(0,s.useState)(null),[y,w]=(0,s.useState)(null),N=(0,s.useRef)(null),[k,C]=(0,s.useState)(null),[S,M]=(0,s.useState)(null),H=(0,s.useRef)(null),[L,B]=(0,s.useState)(null),[z,Y]=(0,s.useState)(""),[U,K]=(0,s.useState)(null),[W,G]=(0,s.useState)(i||new Set),[_,X]=(0,s.useState)([]),[$,q]=(0,s.useState)({}),[Q,ee]=(0,s.useState)(!1),[et,er]=(0,s.useState)({field:"projectName",direction:"asc"}),[ea,es]=(0,s.useState)(""),el=e=>fetch(e).then(e=>e.json()),ei={revalidateOnFocus:!0,revalidateOnReconnect:!0,refreshInterval:0},{data:eo,mutate:en}=(0,J.ZP)("/api/signed-fees",el,ei),{data:ed,mutate:ec}=(0,J.ZP)("/api/asr-fees",el,ei),{data:ex,mutate:em}=(0,J.ZP)("/api/projections",el,ei),{data:eh,mutate:eu}=(0,J.ZP)("/api/statuses",el,ei),{data:eb,mutate:eg}=(0,J.ZP)("/api/comments",el,ei),{data:ep,mutate:ej}=(0,J.ZP)("/api/closed-projects",el,ei),{data:ef,mutate:ey}=(0,J.ZP)("/api/project-assignments",el,ei),{data:ev,mutate:ew}=(0,J.ZP)("/api/project-managers",el,ei),[eN,ek]=(0,s.useState)({}),[eC,eS]=(0,s.useState)({}),[eE,eP]=(0,s.useState)({}),[eZ,eI]=(0,s.useState)({}),[eF,eT]=(0,s.useState)({}),eO=(0,s.useRef)(null),eA=(0,s.useRef)(null),eD=(0,s.useRef)(null),eR=(0,s.useRef)(null),eM=(0,s.useRef)(null),eH=(0,s.useRef)(null),eL=(0,s.useRef)(null),eB=(0,s.useRef)(null),[ez,eY]=(0,s.useState)(0),[eU,eV]=(0,s.useState)(0),[eJ,eK]=(0,s.useState)(!1),[eW,eG]=(0,s.useState)(0),[e_,eX]=(0,s.useState)(0),e$=(0,s.useMemo)(()=>(0,I.ji)(),[]),eq=(0,s.useMemo)(()=>new Date().toISOString().slice(0,7),[]);(0,s.useEffect)(()=>{eo&&Object.keys(eo).length>0&&ek(eo)},[eo]),(0,s.useEffect)(()=>{ed&&Object.keys(ed).length>0&&eS(ed)},[ed]),(0,s.useEffect)(()=>{ex&&Object.keys(ex).length>0&&eP(ex)},[ex]),(0,s.useEffect)(()=>{eh&&Object.keys(eh).length>0&&eI(eh)},[eh]),(0,s.useEffect)(()=>{eb&&Object.keys(eb).length>0&&eT(eb)},[eb]),(0,s.useEffect)(()=>{if(ep&&Array.isArray(ep)){let e=new Set(ep);G(e),null==o||o(e)}},[ep,o]),(0,s.useEffect)(()=>{ef&&"object"==typeof ef&&q(ef)},[ef]),(0,s.useEffect)(()=>{ev&&Array.isArray(ev)&&X(ev)},[ev]),(0,s.useEffect)(()=>()=>{f(null),w(null),C(null),M(null),B(null),K(null)},[]),(0,s.useEffect)(()=>{console.log("HighPerformanceTable: projectManagers state changed:",_)},[_]),(0,s.useEffect)(()=>{let e=setInterval(()=>{let e=localStorage.getItem("projectManagers");e&&Array.isArray(JSON.parse(e))&&0===_.length&&(console.log("HighPerformanceTable: Periodic check found project managers but state is empty, reloading"),X(JSON.parse(e)))},5e3);return()=>clearInterval(e)},[_.length]),(0,s.useEffect)(()=>{let e=e=>{if(j&&y){let t=e.target,r=N.current;r&&!r.contains(t)&&(f(null),w(null))}if(k&&S){let t=e.target,r=H.current;r&&!r.contains(t)&&(C(null),M(null))}if(L&&eB.current){let t=e.target;eB.current.contains(t)||(B(null),Y(""),K(null))}};return(j||k||L)&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[j,y,k,S,L]),(0,s.useEffect)(()=>{var e,t;let r=()=>{eO.current&&eA.current&&(eA.current.scrollTop=eO.current.scrollTop)},a=()=>{eO.current&&eA.current&&(eO.current.scrollTop=eA.current.scrollTop)};return null===(e=eO.current)||void 0===e||e.addEventListener("scroll",r),null===(t=eA.current)||void 0===t||t.addEventListener("scroll",a),()=>{var e,t;null===(e=eO.current)||void 0===e||e.removeEventListener("scroll",r),null===(t=eA.current)||void 0===t||t.removeEventListener("scroll",a)}},[]);let eQ=(0,s.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:220,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200,a=e.getBoundingClientRect(),s=window.innerWidth,l=window.innerHeight,i=a.left,o=a.bottom+5;return i+t+8>s&&(i=Math.max(8,s-t-8)),o+r+8>l&&(o=Math.max(8,a.top-r-5)),i=Math.max(8,i),o=Math.max(8,o),console.log("Dropdown positioning:",{anchor:e.tagName,rect:{left:a.left,top:a.top,right:a.right,bottom:a.bottom},viewport:{width:s,height:l},dropdown:{width:t,height:r},calculated:{x:i,y:o}}),{x:i,y:o}},[]);(0,s.useEffect)(()=>{let e;let t=()=>{clearTimeout(e),e=setTimeout(()=>{if(j||k){var e,t;let r=Math.max((null===(e=eO.current)||void 0===e?void 0:e.scrollTop)||0,(null===(t=eA.current)||void 0===t?void 0:t.scrollTop)||0);Math.abs(r-window.lastScrollTop||0)>50&&(j&&(f(null),w(null)),k&&(C(null),M(null))),window.lastScrollTop=r}},100)},r=eO.current,a=eA.current;return r&&r.addEventListener("scroll",t),a&&a.addEventListener("scroll",t),()=>{clearTimeout(e),r&&r.removeEventListener("scroll",t),a&&a.removeEventListener("scroll",t)}},[j,k]),(0,s.useEffect)(()=>{let e;let t=()=>{clearTimeout(e),e=setTimeout(()=>{let e=window.innerWidth,t=window.innerHeight;(Math.abs(e-window.lastWidth||0)>100||Math.abs(t-window.lastHeight||0)>100)&&(j&&(f(null),w(null)),k&&(C(null),M(null)),window.lastWidth=e,window.lastHeight=t)},100)};return window.addEventListener("resize",t),()=>{clearTimeout(e),window.removeEventListener("resize",t)}},[j,k]),(0,s.useEffect)(()=>{eO.current&&eO.current.classList.add("hide-scrollbar"),eA.current&&(eA.current.style.overflowX="hidden")},[]),(0,s.useEffect)(()=>{if(eM.current){let e=e$.indexOf(eq);-1!==e&&(eM.current.scrollLeft=128*e)}},[e$,eq]),(0,s.useEffect)(()=>{var e;let t=()=>{eM.current&&ee(eM.current.scrollLeft>0)};return null===(e=eM.current)||void 0===e||e.addEventListener("scroll",t),()=>{var e;null===(e=eM.current)||void 0===e||e.removeEventListener("scroll",t)}},[]),(0,s.useEffect)(()=>{eH.current&&eY(eH.current.clientHeight);let e=new ResizeObserver(()=>{eH.current&&eY(eH.current.clientHeight)});return eH.current&&e.observe(eH.current),()=>e.disconnect()},[]),(0,s.useEffect)(()=>{eL.current&&eV(eL.current.clientHeight);let e=new ResizeObserver(()=>{eL.current&&eV(eL.current.clientHeight)});return eL.current&&e.observe(eL.current),()=>e.disconnect()},[]),(0,s.useEffect)(()=>{eG((()=>{let e=document.createElement("div");e.style.overflowY="scroll",e.style.width="50px",e.style.height="50px",e.style.visibility="hidden",document.body.appendChild(e);let t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t})())},[]),(0,s.useEffect)(()=>{eX((()=>{let e=document.createElement("div");e.style.overflowX="scroll",e.style.height="50px",e.style.width="50px",e.style.visibility="hidden",document.body.appendChild(e);let t=e.offsetHeight-e.clientHeight;return document.body.removeChild(e),t})())},[]);let e0=(0,s.useCallback)((e,t)=>{var r;return(null==ex?void 0:null===(r=ex[e])||void 0===r?void 0:r[t])||0},[ex]),e5=(0,s.useCallback)(e=>(null==ed?void 0:ed[e])||0,[ed]),e6=(0,s.useCallback)(e=>((null==eo?void 0:eo[e.projectId])||0)+e5(e.projectId),[eo,e5]),e2=(0,s.useCallback)(e=>e$.reduce((t,r)=>t+e0(e,r),0),[e$,e0]);(0,s.useCallback)(e=>{let t=null==ef?void 0:ef[e];if(!t)return;if(ev&&!Array.isArray(ev)){var r;return null===(r=ev[t])||void 0===r?void 0:r.color}let a=null==ev?void 0:ev.find(e=>e.id===t);return null==a?void 0:a.color},[ef,ev]);let e1=(0,s.useCallback)((e,t)=>{var r;return(null==eh?void 0:null===(r=eh[e])||void 0===r?void 0:r[t])||""},[eh]),e8=(0,s.useCallback)((e,t)=>{var r;return(null==eb?void 0:null===(r=eb[e])||void 0===r?void 0:r[t])||""},[eb]),e9=e=>{switch(e){case"Confirmed":return"bg-blue-100/80 dark:bg-blue-900/40 border-l-4 border-l-blue-500 dark:border-l-blue-400 shadow-sm";case"Estimate":return"bg-amber-100/80 dark:bg-amber-900/40 border-l-4 border-l-amber-500 dark:border-l-amber-400 shadow-sm";case"Billed":return"bg-emerald-100/80 dark:bg-emerald-900/40 border-l-4 border-l-emerald-500 dark:border-l-emerald-400 shadow-sm";case"Other":return"bg-violet-100/80 dark:bg-violet-900/40 border-l-4 border-l-violet-500 dark:border-l-violet-400 shadow-sm";default:return""}},e7=(0,s.useCallback)((e,t,r)=>{x({projectId:e,month:t}),p(r.toString())},[]),e4=(0,s.useCallback)(async()=>{if(!c)return;let{projectId:e,month:t}=c,r=parseFloat(g)||0;try{await fetch("/api/projections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,month:t,value:r})}),em(),window.dispatchEvent(new CustomEvent("projectionsUpdated")),x(null),p("")}catch(e){console.error("Error saving projection:",e),R.ZP.error("Failed to save projection")}},[c,g,em]),e3=(0,s.useCallback)(async()=>{if(!m)return;let e=parseFloat(g)||0;try{await fetch("/api/asr-fees",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:m,value:e})}),eS(t=>({...t,[m]:e})),ec(),h(null),p("")}catch(e){console.error("Error saving ASR fee:",e),R.ZP.error("Failed to save ASR fee")}},[m,g,ec]),te=(0,s.useCallback)(async()=>{if(!u)return;let e=parseFloat(g)||0;try{await fetch("/api/signed-fees",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:u,value:e})}),ek(t=>({...t,[u]:e})),en(),b(null),p("")}catch(e){console.error("Error saving signed fee:",e),R.ZP.error("Failed to save signed fee")}},[u,g,en]),tt=(0,s.useCallback)(async e=>{try{await fetch("/api/closed-projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})});let t=new Set(W);t.add(e),G(t),null==o||o(t),ej(),f(null),window.dispatchEvent(new CustomEvent("projectStatusChanged",{detail:{projectId:e,status:"closed",closedProjects:t}})),R.ZP.success("Project closed")}catch(e){console.error("Error closing project:",e),R.ZP.error("Failed to close project")}},[W,o,ej]);(0,s.useCallback)(async e=>{try{await fetch("/api/closed-projects",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})});let t=new Set(W);t.delete(e),G(t),null==o||o(t),ej(),window.dispatchEvent(new CustomEvent("projectStatusChanged",{detail:{projectId:e,status:"reopened",closedProjects:t}})),R.ZP.success("Project reopened")}catch(e){console.error("Error reopening project:",e),R.ZP.error("Failed to reopen project")}},[W,o,ej]);let tr=async e=>{if(!k)return;let{projectId:t,month:r}=k;try{"Clear"===e?await fetch("/api/statuses",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:t,month:r})}):await fetch("/api/statuses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:t,month:r,status:e})}),eu(),window.dispatchEvent(new CustomEvent("projectionsUpdated")),C(null),M(null)}catch(e){console.error("Error updating status:",e),R.ZP.error("Failed to update status")}},ta=async e=>{if(!k)return;let{projectId:t,month:r}=k;if("AddComment"===e||"EditComment"===e){B(k),Y(e8(t,r)),K(S),C(null),M(null);return}if("RemoveComment"===e){try{await fetch("/api/comments",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:t,month:r})}),eg(),C(null),M(null)}catch(e){console.error("Error removing comment:",e),R.ZP.error("Failed to remove comment")}return}await tr(e)},ts=(0,s.useCallback)(e=>[...e].sort((e,t)=>{let r,a;switch(et.field){case"projectName":r=e.projectName.toLowerCase(),a=t.projectName.toLowerCase();break;case"signedFee":r=eN[e.projectId]||e.signedFee||0,a=eN[t.projectId]||t.signedFee||0;break;case"asrFee":r=e5(e.projectId),a=e5(t.projectId);break;case"totalFee":r=e6(e),a=e6(t);break;case"projected":r=e2(e.projectId),a=e2(t.projectId);break;default:if(!e$.includes(et.field))return 0;r=e0(e.projectId,et.field),a=e0(t.projectId,et.field)}return r<a?"asc"===et.direction?-1:1:r>a?"asc"===et.direction?1:-1:0}),[et,eN,e5,e6,e2,e$,e0]),tl=(0,s.useCallback)(e=>{er(t=>({field:e,direction:t.field===e&&"asc"===t.direction?"desc":"asc"}))},[]),ti=e=>et.field!==e?null:"asc"===et.direction?(0,a.jsx)(F.Z,{className:"h-4 w-4"}):(0,a.jsx)(T.Z,{className:"h-4 w-4"}),to=e=>et.field!==e?null:"asc"===et.direction?(0,a.jsx)(F.Z,{className:"h-3 w-3"}):(0,a.jsx)(T.Z,{className:"h-3 w-3"}),tn=(0,s.useMemo)(()=>ep&&Array.isArray(ep)?new Set(ep):new Set,[ep]),td=ts(d.filter(e=>!tn.has(e.projectId))),tc=(0,s.useMemo)(()=>ea.trim()?td.filter(e=>e.projectName.toLowerCase().includes(ea.toLowerCase())):td,[td,ea]);console.log("HighPerformanceTable: safeBillingData length:",d.length),console.log("HighPerformanceTable: activeProjects length:",td.length),console.log("HighPerformanceTable: filteredProjects length:",tc.length),console.log("HighPerformanceTable: closedProjects size:",W.size),d.length>0&&console.log("HighPerformanceTable: First billing data item:",d[0]),(0,s.useEffect)(()=>{let e=()=>{if(eH.current){let e=eH.current.scrollHeight>eH.current.clientHeight;eK(e);let t=eW||15,r=e?"".concat(t,"px"):"0";eD.current&&eD.current.firstChild&&(eD.current.firstChild.style.paddingRight=r),eR.current&&eR.current.firstChild&&(eR.current.firstChild.style.paddingRight=r)}};e();let t=new ResizeObserver(e);eH.current&&t.observe(eH.current);let r=setInterval(e,500);return()=>{t.disconnect(),clearInterval(r)}},[td.length,eW]);let tx=async e=>{try{let t=[];Object.keys(e).forEach(r=>{Object.keys(e[r]).forEach(a=>{let s=e[r][a];0!==s&&t.push(fetch("/api/projections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:r,month:a,value:s})}))})}),t.length>0&&(await Promise.all(t),em(),R.ZP.success("Data imported successfully")),l&&l(e)}catch(e){console.error("Error importing data:",e),R.ZP.error("Failed to import data")}};return(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-xl border border-gray-200 dark:border-slate-700 overflow-hidden",children:[(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 px-6 py-6 border-b border-gray-200 dark:border-slate-700",children:[(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex items-center justify-between mb-6",children:(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750",children:[(0,a.jsx)("h3",{className:"jsx-19280ab6560fe750 text-2xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-2",children:"Projections Table"}),(0,a.jsxs)("p",{className:"jsx-19280ab6560fe750 text-sm text-gray-600 dark:text-gray-300",children:["Virtualized table with ",tc.length," active projects - click any cell to edit"]})]})}),(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 mb-6",children:[(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 relative",children:[(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none",children:(0,a.jsx)(O.Z,{className:"h-5 w-5 text-gray-400 dark:text-gray-500"})}),(0,a.jsx)("input",{type:"text",placeholder:"Filter projects by name...",value:ea,onChange:e=>es(e.target.value),className:"jsx-19280ab6560fe750 block w-full pl-12 pr-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl leading-5 bg-white dark:bg-slate-700 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 dark:focus:ring-blue-400 sm:text-sm text-gray-900 dark:text-white transition-all duration-200"}),ea&&(0,a.jsx)("button",{onClick:()=>es(""),className:"jsx-19280ab6560fe750 absolute inset-y-0 right-0 pr-4 flex items-center text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors duration-200",children:(0,a.jsx)(v.Z,{className:"h-5 w-5"})})]}),ea&&(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 mt-3 text-sm text-gray-600 dark:text-gray-300",children:["Showing ",tc.length," of ",td.length," projects"]})]}),(0,a.jsx)(V,{billingData:d,monthlyProjections:eE,asrFees:eC,signedFees:eN,monthRange:e$,onImportData:tx})]}),(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 relative table-container",children:[(0,a.jsxs)("div",{style:{width:"776px",height:"600px"},className:"jsx-19280ab6560fe750 absolute left-0 top-0 z-30 bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm flex flex-col",children:[(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 flex bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-b border-gray-200 dark:border-slate-600 sticky-header",children:[(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-[264px] bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsxs)("div",{onClick:()=>tl("projectName"),className:"jsx-19280ab6560fe750 h-18 px-4 py-3 flex items-center justify-start cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors group",children:[(0,a.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-800 dark:group-hover:text-gray-100",children:"Project"}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 ml-1 text-gray-400 dark:text-gray-500 group-hover:text-gray-600 dark:group-hover:text-gray-400",children:ti("projectName")})]})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsxs)("div",{onClick:()=>tl("signedFee"),className:"jsx-19280ab6560fe750 h-18 px-4 py-3 flex items-center justify-end cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors group",children:[(0,a.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-800 dark:group-hover:text-gray-100",children:"Signed Fee"}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 ml-1 text-gray-400 dark:text-gray-500 group-hover:text-gray-600 dark:group-hover:text-gray-400",children:ti("signedFee")})]})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsxs)("div",{onClick:()=>tl("asrFee"),className:"jsx-19280ab6560fe750 h-18 px-4 py-3 flex items-center justify-end cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors group",children:[(0,a.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-800 dark:group-hover:text-gray-100",children:"Total ASR Fee"}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 ml-1 text-gray-400 dark:text-gray-500 group-hover:text-gray-600 dark:group-hover:text-gray-400",children:ti("asrFee")})]})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsxs)("div",{onClick:()=>tl("totalFee"),className:"jsx-19280ab6560fe750 h-18 px-4 py-3 flex items-center justify-end cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors group",children:[(0,a.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-800 dark:group-hover:text-gray-100",children:"Total Fee"}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 ml-1 text-gray-400 dark:text-gray-500 group-hover:text-gray-600 dark:group-hover:text-gray-400",children:ti("totalFee")})]})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsxs)("div",{onClick:()=>tl("projected"),className:"jsx-19280ab6560fe750 h-18 px-4 py-3 flex items-center justify-end cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors group",children:[(0,a.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-800 dark:group-hover:text-gray-100",children:"Projected"}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 ml-1 text-gray-400 dark:text-gray-500 group-hover:text-gray-600 dark:group-hover:text-gray-400",children:ti("projected")})]})})]}),(0,a.jsx)("div",{ref:eL,style:{overflowY:"auto",overflowX:"hidden"},className:"jsx-19280ab6560fe750 flex-1 hide-scrollbar",children:(0,a.jsx)(Z.t7,{height:eU,itemCount:tc.length,itemSize:72,width:776,outerRef:eO,overscanCount:5,children:e=>{let{index:t,style:r}=e,s=tc[t];if(!s)return null;let l=e2(s.projectId),i=e6(s),o=e5(s.projectId),n=m===s.projectId,d=(null==ef?void 0:ef[s.projectId])||$[s.projectId],c=(null==ev?void 0:ev[d])||_.find(e=>e.id===d);return(0,a.jsxs)("div",{style:r,className:"jsx-19280ab6560fe750 flex border-b border-gray-200 dark:border-slate-600 sticky-column",children:[(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-[264px] bg-gray-50/90 dark:bg-slate-800/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 flex items-center h-18 px-4",children:[(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 flex-1 min-w-0 flex flex-col justify-center overflow-hidden",children:[(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 flex items-center",children:[c&&(0,a.jsx)("div",{style:{backgroundColor:c.color},className:"jsx-19280ab6560fe750 w-3 h-3 rounded-full mr-2 shadow-sm"}),(0,a.jsx)("span",{title:s.projectName,className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-900 dark:text-white truncate",children:s.projectName})]}),c&&(0,a.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs text-gray-500 dark:text-gray-400 italic truncate",children:c.name})]}),(0,a.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),f(s.projectId),w(e.currentTarget)},"data-project-id":s.projectId,className:"jsx-19280ab6560fe750 ml-2 p-1 text-gray-400 dark:text-gray-500 hover:text-gray-600 dark:hover:text-gray-300 transition-colors duration-200 dropdown-trigger",children:(0,a.jsx)(A.Z,{className:"h-4 w-4"})})]})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-800/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center",children:u===s.projectId?(0,a.jsx)("input",{type:"number",value:g,onChange:e=>p(e.target.value),onBlur:te,onKeyDown:e=>"Enter"===e.key&&te(),autoFocus:!0,className:"jsx-19280ab6560fe750 w-full px-2 py-1 border border-blue-300 dark:border-blue-400 rounded text-sm bg-white dark:bg-slate-700 text-gray-900 dark:text-white"}):(()=>{let e=eN[s.projectId],t=null==eo?void 0:eo[s.projectId],r=void 0!==e?e:void 0!==t?t:0;return(0,a.jsx)("div",{onClick:()=>{b(s.projectId),p(r.toString())},className:"jsx-19280ab6560fe750 text-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-700 p-1 rounded transition-colors duration-200 text-gray-900 dark:text-white",children:(0,I.xG)(r)})})()})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-800/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center",children:n?(0,a.jsx)("input",{type:"number",value:g,onChange:e=>p(e.target.value),onBlur:e3,onKeyDown:e=>"Enter"===e.key&&e3(),autoFocus:!0,className:"jsx-19280ab6560fe750 w-full px-2 py-1 border border-blue-300 dark:border-blue-400 rounded text-sm bg-white dark:bg-slate-700 text-gray-900 dark:text-white"}):(0,a.jsx)("div",{onClick:()=>{h(s.projectId),p(o.toString())},className:"jsx-19280ab6560fe750 text-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-700 p-1 rounded transition-colors duration-200 text-gray-900 dark:text-white",children:(0,I.xG)(o)})})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-800/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900 dark:text-white",children:(0,I.xG)(i)})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-800/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900 dark:text-white",children:(0,I.xG)(l)})})]})}})}),(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 flex bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-t border-gray-200 dark:border-slate-600",children:[(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-[264px] bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-left text-sm font-medium text-gray-900 dark:text-white",children:"Totals"})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900 dark:text-white",children:(0,I.xG)(d.reduce((e,t)=>{let r=eN[t.projectId],a=null==eo?void 0:eo[t.projectId];return e+(void 0!==r?r:void 0!==a?a:0)},0))})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900 dark:text-white",children:(0,I.xG)(d.reduce((e,t)=>e+e5(t.projectId),0))})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900 dark:text-white",children:(0,I.xG)(d.reduce((e,t)=>e+e6(t),0))})}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-r border-gray-200 dark:border-slate-600",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900 dark:text-white",children:(0,I.xG)(d.reduce((e,t)=>e+e2(t.projectId),0))})})]}),(0,a.jsx)("div",{style:{height:"".concat(e_,"px")},className:"jsx-19280ab6560fe750"})]}),(0,a.jsx)("div",{ref:eM,style:{height:"600px",marginLeft:"776px"},className:"jsx-19280ab6560fe750 "+"overflow-x-auto overflow-y-hidden scrollable-outer ".concat(Q?"scrolled-horizontal":""),children:(0,a.jsxs)("div",{style:{width:"".concat(128*e$.length,"px"),height:"100%",display:"flex",flexDirection:"column"},className:"jsx-19280ab6560fe750",children:[(0,a.jsx)("div",{ref:eD,className:"jsx-19280ab6560fe750 scrollable-header",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-b border-gray-200 dark:border-slate-600 sticky-header header-flex",children:e$.map(e=>(0,a.jsx)("div",{onClick:()=>tl(e),title:"Click to sort by ".concat((0,I.bh)(e)," projections"),className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 flex items-center justify-center px-4 py-3 border-r border-gray-200 dark:border-slate-600 h-18 bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors group",children:(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 flex flex-col items-center group-hover:text-gray-700 dark:group-hover:text-gray-200",children:[(0,a.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-600 dark:text-gray-300 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-800 dark:group-hover:text-gray-100",children:(0,I.bh)(e)}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 text-gray-400 dark:text-gray-500 mt-0.5 group-hover:text-gray-600 dark:group-hover:text-gray-400",children:to(e)})]})},e))})}),(0,a.jsx)("div",{ref:eH,style:{overflowY:"auto",overflowX:"hidden"},className:"jsx-19280ab6560fe750 flex-1 body-wrapper",children:(0,a.jsx)(Z.t7,{height:ez,itemCount:tc.length,itemSize:72,width:128*e$.length,outerRef:eA,overscanCount:5,children:e=>{let{index:t,style:r}=e,s=tc[t];return s?(0,a.jsx)("div",{style:r,className:"jsx-19280ab6560fe750 flex border-b border-gray-200",children:e$.map(e=>{let t=e0(s.projectId,e),r=(null==c?void 0:c.projectId)===s.projectId&&(null==c?void 0:c.month)===e;return(0,a.jsxs)("div",{onClick:()=>e7(s.projectId,e,t),title:e8(s.projectId,e),className:"jsx-19280ab6560fe750 "+"flex-shrink-0 w-32 h-18 px-4 py-2 text-center text-sm border-r border-gray-200 dark:border-slate-600 cursor-pointer relative ".concat(e9(e1(s.projectId,e))||"bg-white/90 dark:bg-slate-800/90 backdrop-blur-sm"),children:[r?(0,a.jsx)("input",{type:"number",value:g,onChange:e=>p(e.target.value),onBlur:e4,onKeyDown:e=>"Enter"===e.key&&e4(),autoFocus:!0,className:"jsx-19280ab6560fe750 w-full px-2 py-1 border border-blue-300 dark:border-blue-400 rounded text-sm bg-white dark:bg-slate-700 text-gray-900 dark:text-white"}):(0,a.jsx)("span",{className:"jsx-19280ab6560fe750 text-gray-900 dark:text-white",children:(0,I.xG)(t)}),(0,a.jsx)("button",{onClick:t=>{t.preventDefault(),t.stopPropagation();let r=t.currentTarget.getBoundingClientRect();if(r.width,r.bottom<0||r.top>window.innerHeight||r.right<0||r.left>window.innerWidth){console.warn("Status button is outside viewport, skipping dropdown positioning:",{projectId:s.projectId,month:e,rect:r,viewport:{width:window.innerWidth,height:window.innerHeight}});return}let a=r.left;r.left+200>window.innerWidth&&(a=r.right-200);let l={x:Math.max(8,a),y:r.bottom+5};if(l.x<0||l.y<0||l.x>window.innerWidth||l.y>window.innerHeight){console.warn("Calculated status position is outside viewport:",{projectId:s.projectId,month:e,position:l,viewport:{width:window.innerWidth,height:window.innerHeight}});return}console.log("HighPerformanceTable status dropdown positioning:",{projectId:s.projectId,month:e,rect:{left:r.left,right:r.right,bottom:r.bottom},window:{width:window.innerWidth,height:window.innerHeight},calculated:l}),C({projectId:s.projectId,month:e}),M(t.currentTarget)},className:"jsx-19280ab6560fe750 absolute top-1 right-1 text-gray-400 hover:text-gray-600 text-xs dropdown-trigger",children:"â‹¯"})]},e)})}):null}})}),(0,a.jsx)("div",{ref:eR,className:"jsx-19280ab6560fe750 scrollable-footer",children:(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm border-t border-gray-200 dark:border-slate-600 footer-flex",children:e$.map((e,t)=>{let r=e$.map(e=>d.reduce((t,r)=>t+e0(r.projectId,e),0));return(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900 dark:text-white border-r border-gray-200 dark:border-slate-600 bg-gray-50/90 dark:bg-slate-700/90 backdrop-blur-sm",children:(0,I.xG)(r[t])},e)})})})]})})]}),j&&y&&(0,P.createPortal)((0,a.jsxs)("div",{ref:N,"data-dropdown":"true",style:{left:"".concat(eQ(y,220,200).x,"px"),top:"".concat(eQ(y,220,200).y,"px"),pointerEvents:"auto"},className:"jsx-19280ab6560fe750 fixed bg-white/95 dark:bg-slate-800/95 backdrop-blur-sm border border-gray-200 dark:border-slate-600 rounded-xl shadow-2xl z-[9999] min-w-[220px] py-2",children:[(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 py-1",children:[(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 px-3 pb-1 text-[11px] font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Assign Project Manager"}),ev&&0!==Object.keys(ev).length||0!==_.length?(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 space-y-0.5",children:(()=>{let e=(null==ef?void 0:ef[j])||$[j];return ev&&Object.keys(ev).length>0?Object.entries(ev).map(t=>{let[r,s]=t;return(0,a.jsxs)("button",{onClick:async()=>{try{await fetch("/api/project-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:j,managerId:r})}),ey(),f(null)}catch(e){console.error("Error assigning project manager:",e),R.ZP.error("Failed to assign project manager")}},className:"jsx-19280ab6560fe750 "+"w-full px-3 py-2 text-left text-sm flex items-center justify-between hover:bg-gray-50 dark:hover:bg-slate-700 text-gray-900 dark:text-white ".concat(e===r?"bg-gray-50 dark:bg-slate-700":""),children:[(0,a.jsxs)("span",{className:"jsx-19280ab6560fe750 flex items-center space-x-2",children:[(0,a.jsx)("span",{style:{backgroundColor:s.color},className:"jsx-19280ab6560fe750 w-3 h-3 rounded-full inline-block shadow-sm"}),(0,a.jsx)("span",{className:"jsx-19280ab6560fe750",children:s.name})]}),e===r&&(0,a.jsx)(D.Z,{className:"h-4 w-4 text-green-600 dark:text-green-400"})]},r)}):_.map(t=>(0,a.jsxs)("button",{onClick:()=>{let e={...$,[j]:t.id};q(e),localStorage.setItem("projectAssignments",JSON.stringify(e)),f(null)},className:"jsx-19280ab6560fe750 "+"w-full px-3 py-2 text-left text-sm flex items-center justify-between hover:bg-gray-50 dark:hover:bg-slate-700 text-gray-900 dark:text-white ".concat(e===t.id?"bg-gray-50 dark:bg-slate-700":""),children:[(0,a.jsxs)("span",{className:"jsx-19280ab6560fe750 flex items-center space-x-2",children:[(0,a.jsx)("span",{style:{backgroundColor:t.color},className:"jsx-19280ab6560fe750 w-3 h-3 rounded-full inline-block shadow-sm"}),(0,a.jsx)("span",{className:"jsx-19280ab6560fe750",children:t.name})]}),e===t.id&&(0,a.jsx)(D.Z,{className:"h-4 w-4 text-green-600 dark:text-green-400"})]},t.id))})()}):(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 px-3 py-2 text-xs text-gray-400 dark:text-gray-500 italic",children:"No project managers available"})]}),((null==ef?void 0:ef[j])||$[j])&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 my-1 border-t border-gray-200 dark:border-slate-600"}),(0,a.jsxs)("button",{onClick:async()=>{try{await fetch("/api/project-assignments",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:j})}),ey(),f(null)}catch(e){console.error("Error removing project manager:",e),R.ZP.error("Failed to remove project manager")}},className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm text-orange-600 dark:text-orange-400 hover:bg-orange-50 dark:hover:bg-orange-900/20 flex items-center transition-colors duration-200",children:[(0,a.jsx)(A.Z,{className:"h-4 w-4 mr-2"}),"Remove Manager"]})]}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 my-1 border-t border-gray-200"}),(0,a.jsxs)("button",{onClick:()=>tt(j),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center",children:[(0,a.jsx)(v.Z,{className:"h-4 w-4 mr-2"}),"Close Project"]})]}),document.body),k&&S&&(0,P.createPortal)((0,a.jsxs)("div",{ref:H,"data-dropdown":"true",style:{left:"".concat(eQ(S,200,150).x,"px"),top:"".concat(eQ(S,200,150).y,"px"),pointerEvents:"auto"},className:"jsx-19280ab6560fe750 fixed bg-white/95 dark:bg-slate-800/95 backdrop-blur-sm border border-gray-200 dark:border-slate-600 rounded-xl shadow-2xl z-[9999] min-w-[200px] py-2",children:[(()=>{let e=e1(k.projectId,k.month);return(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 py-1",children:[(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 px-3 pb-1 text-[11px] font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Status"}),["Confirmed","Estimate","Billed","Other"].map(t=>(0,a.jsxs)("button",{onClick:()=>ta(t),className:"jsx-19280ab6560fe750 "+"w-full px-3 py-2 text-left text-sm flex items-center justify-between hover:bg-gray-50 dark:hover:bg-slate-700 text-gray-900 dark:text-white ".concat(e===t?"bg-gray-50 dark:bg-slate-700":""),children:[(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 "+"w-3 h-3 rounded-full ".concat("Confirmed"===t?"bg-blue-500 dark:bg-blue-400":"Estimate"===t?"bg-amber-500 dark:bg-amber-400":"Billed"===t?"bg-emerald-500 dark:bg-emerald-400":"bg-violet-500 dark:bg-violet-400")}),(0,a.jsx)("span",{className:"jsx-19280ab6560fe750",children:t})]}),e===t&&(0,a.jsx)(D.Z,{className:"h-4 w-4 text-green-600 dark:text-green-400"})]},t)),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 my-1 border-t border-gray-200 dark:border-slate-600"}),(0,a.jsx)("button",{onClick:()=>ta("Clear"),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700",children:"Clear"})]})})(),(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 py-1",children:[(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 px-3 pb-1 text-[11px] font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"Comment"}),(0,a.jsx)("button",{onClick:()=>ta(e8(k.projectId,k.month)?"EditComment":"AddComment"),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-slate-700 text-gray-900 dark:text-white",children:e8(k.projectId,k.month)?"Edit Comment":"Add Comment"}),e8(k.projectId,k.month)&&(0,a.jsx)("button",{onClick:()=>ta("RemoveComment"),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm hover:bg-gray-50 dark:hover:bg-slate-700 text-gray-900 dark:text-white",children:"Remove Comment"})]})]}),document.body),L&&U&&(0,P.createPortal)((0,a.jsxs)("div",{ref:eB,style:{left:"".concat(eQ(U,300,200).x,"px"),top:"".concat(eQ(U,300,200).y,"px"),pointerEvents:"auto"},className:"jsx-19280ab6560fe750 fixed bg-white border border-gray-200 rounded-md shadow-lg z-[9999] min-w-[300px] max-w-md comment-modal",children:[(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 px-4 py-3 border-b border-gray-200 flex justify-between items-center",children:[(0,a.jsx)("h3",{className:"jsx-19280ab6560fe750 text-lg font-medium text-gray-900",children:"Edit Comment"}),(0,a.jsx)("button",{onClick:()=>{B(null),Y(""),K(null)},className:"jsx-19280ab6560fe750 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(v.Z,{className:"h-5 w-5"})})]}),(0,a.jsx)("div",{className:"jsx-19280ab6560fe750 p-4",children:(0,a.jsx)("textarea",{value:z,onChange:e=>Y(e.target.value),rows:4,autoFocus:!0,className:"jsx-19280ab6560fe750 w-full px-2 py-1 border border-gray-300 rounded text-sm"})}),(0,a.jsxs)("div",{className:"jsx-19280ab6560fe750 px-4 py-3 border-t border-gray-200 flex justify-end",children:[(0,a.jsx)("button",{onClick:async()=>{let{projectId:e,month:t}=L,r=z.trim();try{r?await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,month:t,comment:r})}):await fetch("/api/comments",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,month:t})}),eg(),B(null),Y(""),K(null)}catch(e){console.error("Error saving comment:",e),R.ZP.error("Failed to save comment")}},className:"jsx-19280ab6560fe750 px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded-md",children:"Save Comment"}),(0,a.jsx)("button",{onClick:()=>{B(null),Y(""),K(null)},className:"jsx-19280ab6560fe750 ml-2 px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md",children:"Cancel"})]})]}),document.body),(0,a.jsx)(E(),{id:"19280ab6560fe750",children:".table-container.jsx-19280ab6560fe750{position:relative;overflow:hidden}.sticky-header.jsx-19280ab6560fe750{position:-webkit-sticky;position:sticky;top:0;z-index:40;background:inherit;overflow:hidden}.sticky-column.jsx-19280ab6560fe750{position:-webkit-sticky;position:sticky;left:0;z-index:30;background:white;overflow:hidden}.scrolled-horizontal.jsx-19280ab6560fe750{-webkit-box-shadow:inset -10px 0 8px -8px rgba(0,0,0,.1);-moz-box-shadow:inset -10px 0 8px -8px rgba(0,0,0,.1);box-shadow:inset -10px 0 8px -8px rgba(0,0,0,.1)}.hide-scrollbar.jsx-19280ab6560fe750::-webkit-scrollbar{display:none}.hide-scrollbar.jsx-19280ab6560fe750{-ms-overflow-style:none;scrollbar-width:none}.hide-horizontal-scrollbar.jsx-19280ab6560fe750{overflow-x:hidden!important}.body-wrapper.jsx-19280ab6560fe750{scrollbar-gutter:stable}.scrollable-header.jsx-19280ab6560fe750,.scrollable-footer.jsx-19280ab6560fe750{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.header-flex.jsx-19280ab6560fe750,.footer-flex.jsx-19280ab6560fe750{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.scrollable-outer.jsx-19280ab6560fe750{scrollbar-gutter:stable}"})]})}var W=r(47625),G=r(5481),_=r(56940),X=r(97059),$=r(62994),q=r(8147),Q=r(22190),ee=r(23263);function et(e){let{billingData:t,closedProjects:r}=e,l=t||[],i=r||new Set,[o,n]=(0,s.useState)(0),d=e=>fetch(e).then(e=>e.json()),{data:c}=(0,J.ZP)("/api/projections",d),{data:x}=(0,J.ZP)("/api/statuses",d);(0,s.useEffect)(()=>{let e=()=>{n(e=>e+1)};return window.addEventListener("projectionsUpdated",e),window.addEventListener("statusUpdated",e),()=>{window.removeEventListener("projectionsUpdated",e),window.removeEventListener("statusUpdated",e)}},[]);let m=c||{},h=x||{},u=(0,I.UF)().map(e=>{let t=0,r=0,a=new Set([...l.map(e=>e.projectId),...Array.from(i)]);a.forEach(a=>{let s=m[a],l=h[a];if(s&&s[e]){let a=s[e];l&&"Billed"===l[e]?r+=a:t+=a}});let s=t;return e===new Date().toISOString().slice(0,7)&&console.log("BillingChart: Current month data:",{month:e,monthProjected:t,monthBilled:r,monthUnbilled:s,allProjectIdsCount:a.size,activeProjectsCount:l.length,closedProjectsCount:i.size}),{month:e,name:(0,I.bh)(e),billed:r,unbilled:s,projected:t,total:t}});return(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsx)("div",{className:"chart-container",children:(0,a.jsx)(W.h,{width:"100%",height:320,children:(0,a.jsxs)(G.T,{data:u,margin:{top:20,right:30,left:20,bottom:5},children:[(0,a.jsx)(_.q,{strokeDasharray:"3 3"}),(0,a.jsx)(X.K,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0}),(0,a.jsx)($.B,{tickFormatter:e=>"$".concat((e/1e3).toFixed(0),"k"),fontSize:12,label:{value:"Amount (USD)",angle:-90,position:"insideLeft"}}),(0,a.jsx)(q.u,{content:(0,a.jsx)(e=>{let{active:t,payload:r,label:s}=e;return t&&r&&r.length?(0,a.jsxs)("div",{className:"bg-white p-4 border rounded-lg shadow-lg",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900",children:s}),r.map((e,t)=>(0,a.jsxs)("p",{className:"text-sm",style:{color:e.color},children:[e.name,": ",(0,I.xG)(e.value)]},t))]}):null},{})}),(0,a.jsx)(Q.D,{}),(0,a.jsx)(ee.u,{type:"monotone",dataKey:"projected",stackId:"1",stroke:"#f97316",fill:"#f97316",fillOpacity:.6,name:"Projected"}),(0,a.jsx)(ee.u,{type:"monotone",dataKey:"billed",stackId:"1",stroke:"#10b981",fill:"#10b981",fillOpacity:.6,name:"Billed"})]})})})})})}var er=r(12339),ea=r(32759),es=r(75169),el=r(3574),ei=r(20407),eo=r(77031),en=r(31699);function ed(){let[e,t]=(0,s.useState)(null),[r,v]=(0,s.useState)([]),[w,S]=(0,s.useState)("projections-table"),[E,P]=(0,s.useState)(null),[Z,I]=(0,s.useState)(!1),[F,T]=(0,s.useState)(!0),[O,A]=(0,s.useState)(null),[D,R]=(0,s.useState)([]),[M,H]=(0,s.useState)({}),[L,B]=(0,s.useState)(new Set);(0,s.useEffect)(()=>{r&&!Array.isArray(r)&&(console.warn("topProjects is not an array, resetting to empty array:",r),v([]))},[r]),(0,s.useEffect)(()=>{(async()=>{try{T(!0),A(null);try{console.log("Setting up database schema..."),(await fetch("/api/setup-database",{method:"POST"})).ok?console.log("Database setup completed"):console.log("Database setup failed, continuing with existing schema")}catch(e){console.log("Database setup error, continuing with existing schema:",e)}let[e,r,a]=await Promise.all([fetch("/api/homepage-dashboard"),fetch("/api/top-projects"),fetch("/api/projects")]);if(!e.ok)throw Error("Failed to fetch dashboard data");if(!r.ok)throw Error("Failed to fetch top projects data");if(!a.ok)throw Error("Failed to fetch projects data");let s=await e.json(),l=await r.json(),i=await a.json();if(s&&"object"==typeof s?t(s):(console.warn("Invalid dashboard data received:",s),t(null)),console.log("Raw topProjectsData:",l),l&&l.success&&l.data&&Array.isArray(l.data.topProjects)?(console.log("Setting topProjects:",l.data.topProjects),v(l.data.topProjects)):(console.warn("Invalid topProjects data received, setting empty array:",l),v([])),i.success&&i.data){let e=i.data.map(e=>({projectId:e.project_id,projectName:e.project_name,customerName:e.customer_name,signedFee:e.signed_fee||0,monthlyData:[],totalBilled:0,totalUnbilled:0,totalProjected:0,isClosed:!1,projectManagerId:void 0,clockifyData:void 0,totalHours:0,billableHours:0,nonBillableHours:0,hourlyRate:0,efficiency:0}));R(e)}}catch(e){console.error("Error fetching dashboard data:",e),A(e instanceof Error?e.message:"Failed to load dashboard data")}finally{T(!1)}})();let e=localStorage.getItem("closedProjects");if(e)try{let t=JSON.parse(e);B(new Set(t))}catch(e){console.error("Error parsing closed projects from localStorage:",e)}let r=e=>{let{projectId:t,status:r,closedProjects:a}=e.detail;console.log("HomePage: Received project status change:",{projectId:t,status:r,newClosedProjects:a}),a&&(B(a),localStorage.setItem("closedProjects",JSON.stringify(Array.from(a))))};return window.addEventListener("projectStatusChanged",r),()=>{window.removeEventListener("projectStatusChanged",r)}},[]);let z=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),Y=e=>"".concat(e.toLocaleString(),"h"),U=e=>"".concat((100*e).toFixed(0),"%"),V=e=>{if(!Array.isArray(r)||!e)return;let t=r.find(t=>t.id===e);t&&(P(t),I(!0))},J={hidden:{opacity:0,y:20},visible:{opacity:1,y:0},exit:{opacity:0,y:-20}},G={hidden:{opacity:0,scale:.95},visible:{opacity:1,scale:1}};if(F)return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-xl text-gray-600 dark:text-gray-300",children:"Loading dashboard data..."})]})});if(O||!e)return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center max-w-md mx-auto p-6",children:[(0,a.jsx)(n.Z,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Error Loading Dashboard"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:O||"Failed to load dashboard data"}),(0,a.jsx)("button",{onClick:()=>window.location.reload(),className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200",children:"Retry"})]})});let _=[{name:"Billable",value:Math.round(100*e.efficiency),color:"#10b981"},{name:"Non-Billable",value:Math.round((1-e.efficiency)*100),color:"#6b7280"}],Q=(Array.isArray(r)?r:[]).slice(0,5).map(e=>({name:e.name||"Unknown Project",hours:e.hours||0,revenue:e.revenue||0,efficiency:Math.round(100*(e.efficiency||0)),multiplier:e.multiplier||0}));return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:[(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)(i.E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},className:"relative mb-12",children:[(0,a.jsx)("div",{className:"absolute top-0 right-0",children:(0,a.jsx)(l.default,{href:"/settings",className:"inline-flex items-center justify-center w-12 h-12 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border border-gray-200 dark:border-slate-700 rounded-full hover:bg-white dark:hover:bg-slate-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:(0,a.jsx)(d.Z,{className:"h-6 w-6 text-gray-600 dark:text-gray-300"})})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-4",children:"Billing Dashboard"}),(0,a.jsx)("p",{className:"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto mb-6",children:"Comprehensive financial insights and project performance metrics for engineering excellence"}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-center space-y-3 sm:space-y-0 sm:space-x-4",children:[(0,a.jsxs)(l.default,{href:"/dashboard",className:"inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200 shadow-lg hover:shadow-xl",children:[(0,a.jsx)(c.Z,{className:"h-5 w-5 mr-2"}),"Detailed Finances"]}),(0,a.jsxs)(l.default,{href:"/projects",className:"inline-flex items-center px-6 py-3 bg-gray-600 text-white font-medium rounded-lg hover:bg-gray-700 transition-colors duration-200 shadow-lg hover:shadow-xl",children:[(0,a.jsx)(x.Z,{className:"h-5 w-5 mr-2"}),"Project Information"]})]})]})]}),(0,a.jsxs)(er.mQ,{value:w,onValueChange:S,className:"w-full space-y-8",children:[(0,a.jsxs)(er.dr,{className:"grid w-full grid-cols-6 h-16 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border border-gray-200 dark:border-slate-700 rounded-xl p-1 shadow-lg",children:[(0,a.jsxs)(er.SP,{value:"projections-table",className:"text-white data-[state=active]:bg-indigo-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-200 rounded-lg",children:[(0,a.jsx)(d.Z,{className:"h-5 w-5 mr-2"}),"Projections Table"]}),(0,a.jsxs)(er.SP,{value:"billing",className:"text-white data-[state=active]:bg-blue-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-200 rounded-lg",children:[(0,a.jsx)(m.Z,{className:"h-5 w-5 mr-2"}),"Billing Overview"]}),(0,a.jsxs)(er.SP,{value:"time-tracking",className:"text-white data-[state=active]:bg-green-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-200 rounded-lg",children:[(0,a.jsx)(h.Z,{className:"h-5 w-5 mr-2"}),"Time Tracking KPIs"]}),(0,a.jsxs)(er.SP,{value:"performance",className:"text-white data-[state=active]:bg-purple-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-200 rounded-lg",children:[(0,a.jsx)(c.Z,{className:"h-5 w-5 mr-2"}),"Performance Metrics"]}),(0,a.jsxs)(er.SP,{value:"top-projects",className:"text-white data-[state=active]:bg-orange-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-200 rounded-lg",children:[(0,a.jsx)(u.Z,{className:"h-5 w-5 mr-2"}),"Top Projects"]}),(0,a.jsxs)(er.SP,{value:"bottom-projects",className:"text-white data-[state=active]:bg-red-500 data-[state=active]:text-white data-[state=active]:shadow-lg transition-all duration-200 rounded-lg",children:[(0,a.jsx)(n.Z,{className:"h-5 w-5 mr-2"}),"Bottom Projects"]})]}),(0,a.jsx)(er.nU,{value:"billing",className:"space-y-6",children:(0,a.jsx)(o.M,{mode:"wait",children:(0,a.jsxs)(i.E.div,{variants:J,initial:"hidden",animate:"visible",exit:"exit",transition:{duration:.3},className:"space-y-6",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[{name:"Total Projects",value:e.totalProjects,icon:b.Z,color:"from-blue-500 to-blue-600",description:"Active and closed projects",trend:"+12% from last month"},{name:"Total Billed YTD",value:z(e.totalBilled),icon:m.Z,color:"from-green-500 to-green-600",description:"Year-to-date billed amount",trend:"+8.5% from last year"},{name:"Backlog",value:z(e.totalUnbilled),icon:g.Z,color:"from-yellow-500 to-yellow-600",description:"Unbilled work in progress",trend:"+15% from last month"},{name:"Active Projects",value:e.activeProjects,icon:p.Z,color:"from-purple-500 to-purple-600",description:"Currently active projects",trend:"+5% from last month"}].map((e,t)=>(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.1*t},children:(0,a.jsxs)(N.Zb,{className:"h-full bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-0 shadow-xl hover:shadow-2xl transition-all duration-300 hover:-translate-y-1",children:[(0,a.jsx)(N.Ol,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"p-3 rounded-xl bg-gradient-to-r ".concat(e.color),children:(0,a.jsx)(e.icon,{className:"h-6 w-6 text-white"})}),(0,a.jsx)(k.C,{variant:"secondary",className:"text-xs",children:e.trend})]})}),(0,a.jsxs)(N.aY,{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300 mb-2",children:e.name}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:e.value}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.description})]})]})},e.name))}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.4},children:(0,a.jsx)(N.Zb,{className:"bg-gradient-to-r from-blue-500 to-blue-600 text-white border-0 shadow-xl",children:(0,a.jsx)(N.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium opacity-90 mb-1",children:"Total Revenue"}),(0,a.jsx)("p",{className:"text-3xl font-bold",children:z(e.totalBilled+e.totalUnbilled)}),(0,a.jsx)("p",{className:"text-sm opacity-80 mt-2",children:"Combined billed and unbilled"})]}),(0,a.jsx)(m.Z,{className:"h-12 w-12 opacity-80"})]})})})}),(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.5},children:(0,a.jsx)(N.Zb,{className:"bg-gradient-to-r from-emerald-500 to-emerald-600 text-white border-0 shadow-xl",children:(0,a.jsx)(N.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium opacity-90 mb-1",children:"Project Count"}),(0,a.jsx)("p",{className:"text-3xl font-bold",children:e.totalProjects}),(0,a.jsx)("p",{className:"text-sm opacity-80 mt-2",children:"Total projects managed"})]}),(0,a.jsx)(x.Z,{className:"h-12 w-12 opacity-80"})]})})})}),(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.6},children:(0,a.jsx)(N.Zb,{className:"bg-gradient-to-r from-violet-500 to-violet-600 text-white border-0 shadow-xl",children:(0,a.jsx)(N.aY,{className:"p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium opacity-90 mb-1",children:"Active Rate"}),(0,a.jsx)("p",{className:"text-3xl font-bold",children:U(e.activeProjects/e.totalProjects)}),(0,a.jsx)("p",{className:"text-sm opacity-80 mt-2",children:"Projects currently active"})]}),(0,a.jsx)(j.Z,{className:"h-12 w-12 opacity-80"})]})})})})]})]},"billing")})}),(0,a.jsx)(er.nU,{value:"time-tracking",className:"space-y-6",children:(0,a.jsx)(o.M,{mode:"wait",children:(0,a.jsxs)(i.E.div,{variants:J,initial:"hidden",animate:"visible",exit:"exit",transition:{duration:.3},className:"space-y-6",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6",children:[{name:"Total Hours",value:Y(e.totalHours),icon:h.Z,color:"from-indigo-500 to-indigo-600",description:"Total tracked hours",progress:100},{name:"Billable Hours",value:Y(e.billableHours),icon:d.Z,color:"from-emerald-500 to-emerald-600",description:"Billable time tracked",progress:e.billableHours/e.totalHours*100},{name:"Efficiency",value:U(e.efficiency),icon:c.Z,color:"from-orange-500 to-orange-600",description:"Billable hours ratio",progress:100*e.efficiency},{name:"Avg Hourly Rate",value:z(e.averageHourlyRate),icon:f.Z,color:"from-pink-500 to-pink-600",description:"Average billable rate",progress:85}].map((t,r)=>(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.1*r},children:(0,a.jsxs)(N.Zb,{className:"h-full bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-0 shadow-xl hover:shadow-2xl transition-all duration-300 hover:-translate-y-1",children:[(0,a.jsx)(N.Ol,{className:"pb-3",children:(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsx)("div",{className:"p-3 rounded-xl bg-gradient-to-r ".concat(t.color),children:(0,a.jsx)(t.icon,{className:"h-6 w-6 text-white"})})})}),(0,a.jsxs)(N.aY,{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300 mb-2",children:t.name}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-3",children:t.value}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-3",children:t.description}),"Efficiency"===t.name?(0,a.jsxs)("div",{className:"relative w-16 h-16 mx-auto",children:[(0,a.jsxs)("svg",{className:"w-16 h-16 transform -rotate-90",viewBox:"0 0 36 36",children:[(0,a.jsx)("path",{className:"text-gray-200 dark:text-gray-600",strokeWidth:"3",fill:"none",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"}),(0,a.jsx)("path",{className:"text-emerald-500",strokeWidth:"3",strokeDasharray:"".concat(t.progress,", 100"),strokeLinecap:"round",fill:"none",d:"M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"})]}),(0,a.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-sm font-bold text-gray-900 dark:text-white",children:U(e.efficiency)})})]}):(0,a.jsx)(ea.E,{value:t.progress,className:"h-2"})]})]})},t.name))}),(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.4},children:(0,a.jsxs)(N.Zb,{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-0 shadow-xl",children:[(0,a.jsxs)(N.Ol,{children:[(0,a.jsx)(N.ll,{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Billable vs Non-Billable Hours"}),(0,a.jsx)(N.SZ,{children:"Visual breakdown of time allocation efficiency"})]}),(0,a.jsxs)(N.aY,{children:[(0,a.jsx)("div",{className:"h-64",children:(0,a.jsx)(W.h,{width:"100%",height:"100%",children:(0,a.jsxs)(es.u,{children:[(0,a.jsx)(el.b,{data:_,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:5,dataKey:"value",children:_.map((e,t)=>(0,a.jsx)(ei.b,{fill:e.color},"cell-".concat(t)))}),(0,a.jsx)(q.u,{})]})})}),(0,a.jsx)("div",{className:"flex justify-center space-x-8 mt-4",children:_.map(e=>(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full",style:{backgroundColor:e.color}}),(0,a.jsxs)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:[e.name,": ",e.value,"%"]})]},e.name))})]})]})})]},"time-tracking")})}),(0,a.jsx)(er.nU,{value:"performance",className:"space-y-6",children:(0,a.jsx)(o.M,{mode:"wait",children:(0,a.jsxs)(i.E.div,{variants:J,initial:"hidden",animate:"visible",exit:"exit",transition:{duration:.3},className:"space-y-6",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[{name:"Total Time Value",value:z(e.totalTimeValue),icon:j.Z,color:"from-cyan-500 to-cyan-600",description:"Total value of tracked time",metric:"High Performance"},{name:"Avg Hours/Project",value:Y(e.averageHoursPerProject),icon:u.Z,color:"from-violet-500 to-violet-600",description:"Average hours per project",metric:"Optimal"}].map((e,t)=>(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.1*t},children:(0,a.jsxs)(N.Zb,{className:"h-full bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-0 shadow-xl hover:shadow-2xl transition-all duration-300 hover:-translate-y-1",children:[(0,a.jsx)(N.Ol,{className:"pb-3",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"p-3 rounded-xl bg-gradient-to-r ".concat(e.color),children:(0,a.jsx)(e.icon,{className:"h-6 w-6 text-white"})}),(0,a.jsx)(k.C,{variant:"default",className:"text-xs",children:e.metric})]})}),(0,a.jsxs)(N.aY,{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-300 mb-2",children:e.name}),(0,a.jsx)("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:e.value}),(0,a.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.description})]})]})},e.name))}),(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.3},children:(0,a.jsx)(N.Zb,{className:"bg-gradient-to-r from-slate-800 to-slate-900 text-white border-0 shadow-xl",children:(0,a.jsx)(N.aY,{className:"p-8",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl font-bold text-blue-400 mb-2",children:U(e.efficiency)}),(0,a.jsx)("div",{className:"text-sm text-gray-300",children:"Overall Efficiency"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl font-bold text-green-400 mb-2",children:e.activeProjects}),(0,a.jsx)("div",{className:"text-sm text-gray-300",children:"Active Projects"})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"text-4xl font-bold text-purple-400 mb-2",children:z(e.averageHourlyRate)}),(0,a.jsx)("div",{className:"text-sm text-gray-300",children:"Avg Hourly Rate"})]})]})})})})]},"performance")})}),(0,a.jsx)(er.nU,{value:"projections-table",className:"space-y-6",children:(0,a.jsx)(o.M,{mode:"wait",children:(0,a.jsxs)(i.E.div,{variants:J,initial:"hidden",animate:"visible",exit:"exit",transition:{duration:.3},className:"space-y-6",children:[(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.1},children:(0,a.jsxs)(N.Zb,{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-0 shadow-xl",children:[(0,a.jsxs)(N.Ol,{children:[(0,a.jsx)(N.ll,{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Financial Projections Overview"}),(0,a.jsx)(N.SZ,{children:"Projected and billed amounts from 1 year back to 1 year in the future"})]}),(0,a.jsx)(N.aY,{children:(0,a.jsx)(et,{billingData:D,closedProjects:L})})]})}),(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.2},children:(0,a.jsx)(N.Zb,{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-0 shadow-xl",children:(0,a.jsx)(N.aY,{children:(0,a.jsx)(K,{billingData:D,projections:M,onUpdateProjections:e=>{H(e)},closedProjects:L,onClosedProjectsChange:B})})})})]},"projections-table")})}),(0,a.jsx)(er.nU,{value:"top-projects",className:"space-y-6",children:(0,a.jsx)(o.M,{mode:"wait",children:(0,a.jsxs)(i.E.div,{variants:J,initial:"hidden",animate:"visible",exit:"exit",transition:{duration:.3},className:"space-y-6",children:[(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.1},children:(0,a.jsxs)(N.Zb,{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-0 shadow-xl",children:[(0,a.jsxs)(N.Ol,{children:[(0,a.jsx)(N.ll,{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Top Performing Projects by Multiplier"}),(0,a.jsx)(N.SZ,{children:"Multiplier comparison of top 5 projects (higher = better profitability)"})]}),(0,a.jsx)(N.aY,{children:Q.length>0?(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(W.h,{width:"100%",height:"100%",children:(0,a.jsxs)(eo.v,{data:Q,margin:{top:20,right:30,left:20,bottom:5},children:[(0,a.jsx)(X.K,{dataKey:"name"}),(0,a.jsx)($.B,{}),(0,a.jsx)(q.u,{formatter:(e,t)=>["multiplier"===t?Number(e).toFixed(2)+"x":"revenue"===t?z(Number(e)):e,"multiplier"===t?"Multiplier":"revenue"===t?"Revenue":"Hours"]}),(0,a.jsx)(en.$,{dataKey:"multiplier",fill:"#3b82f6",radius:[4,4,0,0]})]})})}):(0,a.jsx)("div",{className:"h-80 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(c.Z,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No project data available"}),(0,a.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Projects will appear here once data is loaded"})]})})})]})}),(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.2},children:(0,a.jsxs)(N.Zb,{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-0 shadow-xl",children:[(0,a.jsxs)(N.Ol,{children:[(0,a.jsx)(N.ll,{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Top Performing Projects by Multiplier"}),(0,a.jsx)(N.SZ,{children:"Projects ranked by profitability multiplier (higher = better). Click on any project to view detailed metrics."})]}),(0,a.jsx)(N.aY,{children:(0,a.jsx)("div",{className:"space-y-4",children:r.map((e,t)=>(0,a.jsxs)(i.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3+.1*t},className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-slate-700 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-600 transition-colors duration-200 cursor-pointer group",onClick:()=>V(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-yellow-400 to-orange-500 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-sm font-bold",children:t+1})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-200",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.hours,"h â€¢ ",U(e.efficiency)," efficient"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-semibold text-gray-900 dark:text-white",children:[(e.multiplier||0).toFixed(2),"x"]}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Multiplier"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:z(e.revenue)}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Revenue"})]}),(0,a.jsx)(y.Z,{className:"h-5 w-5 text-gray-400 group-hover:text-blue-500 transition-colors duration-200"})]})]},e.id))})})]})})]},"top-projects")})}),(0,a.jsx)(er.nU,{value:"bottom-projects",className:"space-y-6",children:(0,a.jsx)(o.M,{mode:"wait",children:(0,a.jsxs)(i.E.div,{variants:J,initial:"hidden",animate:"visible",exit:"exit",transition:{duration:.3},className:"space-y-6",children:[(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.1},children:(0,a.jsxs)(N.Zb,{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-0 shadow-xl",children:[(0,a.jsxs)(N.Ol,{children:[(0,a.jsx)(N.ll,{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Bottom Performing Projects by Multiplier"}),(0,a.jsx)(N.SZ,{children:"Multiplier comparison of bottom 5 projects (lower = worse profitability)"})]}),(0,a.jsx)(N.aY,{children:Array.isArray(r)&&r.length>0?(0,a.jsx)("div",{className:"h-80",children:(0,a.jsx)(W.h,{width:"100%",height:"100%",children:(0,a.jsxs)(eo.v,{data:r.slice(-5).reverse().map(e=>({name:e.name||"Unknown Project",hours:e.hours||0,revenue:e.revenue||0,efficiency:Math.round(100*(e.efficiency||0)),multiplier:e.multiplier||0})),margin:{top:20,right:30,left:20,bottom:5},children:[(0,a.jsx)(X.K,{dataKey:"name"}),(0,a.jsx)($.B,{}),(0,a.jsx)(q.u,{formatter:(e,t)=>["multiplier"===t?Number(e).toFixed(2)+"x":"revenue"===t?z(Number(e)):e,"multiplier"===t?"Multiplier":"revenue"===t?"Revenue":"Hours"]}),(0,a.jsx)(en.$,{dataKey:"multiplier",fill:"#ef4444",radius:[4,4,0,0]})]})})}):(0,a.jsx)("div",{className:"h-80 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(n.Z,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No project data available"}),(0,a.jsx)("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:"Projects will appear here once data is loaded"})]})})})]})}),(0,a.jsx)(i.E.div,{variants:G,initial:"hidden",animate:"visible",transition:{delay:.2},children:(0,a.jsxs)(N.Zb,{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border-0 shadow-xl",children:[(0,a.jsxs)(N.Ol,{children:[(0,a.jsx)(N.ll,{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Bottom Performing Projects by Multiplier"}),(0,a.jsx)(N.SZ,{children:"Projects ranked by lowest profitability multiplier (lower = worse). Click on any project to view detailed metrics."})]}),(0,a.jsx)(N.aY,{children:(0,a.jsx)("div",{className:"space-y-4",children:Array.isArray(r)&&r.length>0?r.slice(-5).reverse().map((e,t)=>(0,a.jsxs)(i.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:.3+.1*t},className:"flex items-center justify-between p-4 bg-red-50 dark:bg-red-900/20 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors duration-200 cursor-pointer group border border-red-200 dark:border-red-800",onClick:()=>V(e.id),children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"w-10 h-10 bg-gradient-to-r from-red-400 to-red-600 rounded-full flex items-center justify-center",children:(0,a.jsx)("span",{className:"text-white text-sm font-bold",children:Array.isArray(r)?r.length-t:0})})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white group-hover:text-red-600 dark:group-hover:text-red-400 transition-colors duration-200",children:e.name||"Unknown Project"}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.hours||0,"h â€¢ ",U(e.efficiency||0)," efficient"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"font-semibold text-red-600 dark:text-red-400",children:[(e.multiplier||0).toFixed(2),"x"]}),(0,a.jsx)("p",{className:"text-sm text-red-500 dark:text-red-400",children:"Multiplier"})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:z(e.revenue||0)}),(0,a.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Revenue"})]}),(0,a.jsx)(y.Z,{className:"h-5 w-5 text-red-400 group-hover:text-red-600 transition-colors duration-200"})]})]},e.id||"project-".concat(t))):(0,a.jsxs)("div",{className:"text-center py-8",children:[(0,a.jsx)(n.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:"No project data available"})]})})})]})})]},"bottom-projects")})})]})]}),(0,a.jsx)(C,{isOpen:Z,onClose:()=>{I(!1),P(null)},project:E||void 0})]})}}},function(e){e.O(0,[451,64,961,425,788,848,757,417,971,117,744],function(){return e(e.s=78929)}),_N_E=e.O()}]);