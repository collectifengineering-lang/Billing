(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[938],{19396:function(e,r,t){Promise.resolve().then(t.bind(t,96799))},96799:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return m}});var a=t(57437),s=t(2265),n=t(77086),o=t(69064),l=t(27648),i=t(32660);let c=(0,t(39763).Z)("Key",[["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["path",{d:"m15.5 7.5 3 3L22 7l-3-3",key:"1rn1fs"}]]);var d=t(95805),u=t(91723),g=t(17486);function h(){let[e,r]=(0,s.useState)(!1),[t,g]=(0,s.useState)(!1),[h,m]=(0,s.useState)(""),[x,b]=(0,s.useState)(""),[f,y]=(0,s.useState)("#6366f1"),[p,k]=(0,s.useState)({configured:!1}),{data:v,error:j}=(0,n.ZP)("/api/auth/status",async e=>{let r=await fetch(e);if(!r.ok)throw Error("Failed to fetch token status");return r.json()}),{data:w,mutate:N}=(0,n.ZP)("/api/project-managers",async e=>{let r=await fetch(e);if(!r.ok)throw Error("Failed to fetch project managers");let t=await r.json();try{let e=Object.entries(t||{}).map(e=>{let[r,t]=e;return{id:r,...t||{}}});localStorage.setItem("projectManagers",JSON.stringify(e))}catch(e){}return t});(0,s.useEffect)(()=>{A()},[]);let A=async()=>{try{console.log("Settings: Testing Clockify connection...");let e=await fetch("/api/clockify?action=test-connection"),r=await e.json();r.success?(console.log("Settings: Clockify connection successful"),k({configured:!0,workspaces:r.workspaces})):(console.log("Settings: Clockify connection failed:",r.error),k({configured:!1,error:r.error}))}catch(e){console.error("Settings: Error testing Clockify connection:",e),k({configured:!1,error:"Failed to connect to Clockify"})}},E=async()=>{r(!0);try{if(!(await fetch("/api/auth/status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"refresh"})})).ok)throw Error("Failed to refresh token");o.Am.success("Token refreshed successfully")}catch(e){console.error("Error refreshing token:",e),o.Am.error("Failed to refresh token")}finally{r(!1)}},S=async()=>{if(!x.trim()){o.Am.error("Manager name is required");return}g(!0);try{if(!(await fetch("/api/project-managers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:h||void 0,name:x.trim(),color:f})})).ok)throw Error("Failed to save project manager");o.Am.success(h?"Manager updated successfully":"Manager added successfully"),m(""),b(""),y("#6366f1"),N()}catch(e){console.error("Error saving manager:",e),o.Am.error("Failed to save manager")}finally{g(!1)}},C=async e=>{if(confirm("Are you sure you want to delete this project manager?"))try{if(!(await fetch("/api/project-managers",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e})})).ok)throw Error("Failed to delete project manager");o.Am.success("Manager deleted successfully"),N()}catch(e){console.error("Error deleting manager:",e),o.Am.error("Failed to delete manager")}};return(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,a.jsxs)("div",{className:"relative mb-12",children:[(0,a.jsx)("div",{className:"absolute top-0 left-0",children:(0,a.jsx)(l.default,{href:"/",className:"inline-flex items-center justify-center w-12 h-12 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border border-gray-200 dark:border-slate-700 rounded-full hover:bg-white dark:hover:bg-slate-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:(0,a.jsx)(i.Z,{className:"h-6 w-6 text-gray-600 dark:text-gray-300"})})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-4",children:"Settings"}),(0,a.jsx)("p",{className:"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto",children:"Configure project managers, integrations, and system preferences"})]})]}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto space-y-8",children:[(0,a.jsxs)("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border border-gray-200 dark:border-slate-700 rounded-2xl shadow-xl p-8",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-blue-100 dark:bg-blue-900/40 rounded-xl flex items-center justify-center mr-4",children:(0,a.jsx)(c,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Authentication Status"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Zoho Books API connection status"})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[j?(0,a.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-4",children:(0,a.jsx)("p",{className:"text-red-700 dark:text-red-300",children:"Error loading token status"})}):v?(0,a.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-4",children:(0,a.jsxs)("p",{className:"text-green-700 dark:text-green-300",children:["Token expires: ",new Date(v.expiresAt).toLocaleString()]})}):(0,a.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-4",children:(0,a.jsx)("p",{className:"text-yellow-700 dark:text-yellow-300",children:"Loading token status..."})}),(0,a.jsx)("button",{onClick:E,disabled:e,className:"px-6 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 text-white rounded-xl font-medium transition-colors duration-200 shadow-lg hover:shadow-xl disabled:cursor-not-allowed",children:e?"Refreshing...":"Refresh Token"})]})]}),(0,a.jsxs)("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border border-gray-200 dark:border-slate-700 rounded-2xl shadow-xl p-8",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-purple-100 dark:bg-purple-900/40 rounded-xl flex items-center justify-center mr-4",children:(0,a.jsx)(d.Z,{className:"h-6 w-6 text-purple-600 dark:text-purple-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Project Managers"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Manage project manager assignments and colors"})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-slate-700/50 rounded-xl p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:h?"Edit Manager":"Add New Manager"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)("input",{type:"text",placeholder:"Manager Name",value:x,onChange:e=>b(e.target.value),className:"px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl bg-white dark:bg-slate-800 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200"}),(0,a.jsx)("input",{type:"color",value:f,onChange:e=>y(e.target.value),className:"w-full h-12 border border-gray-300 dark:border-slate-600 rounded-xl cursor-pointer"}),(0,a.jsx)("button",{onClick:S,disabled:t||!x.trim(),className:"px-6 py-3 bg-purple-600 hover:bg-purple-700 disabled:bg-purple-400 text-white rounded-xl font-medium transition-colors duration-200 shadow-lg hover:shadow-xl disabled:cursor-not-allowed",children:t?"Saving...":h?"Update":"Add"})]}),h&&(0,a.jsx)("button",{onClick:()=>{m(""),b(""),y("#6366f1")},className:"mt-3 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",children:"Cancel Edit"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Current Managers"}),w&&Object.keys(w).length>0?(0,a.jsx)("ul",{className:"space-y-3",children:Object.entries(w).map(e=>{let[r,{name:t,color:s}]=e;return(0,a.jsxs)("li",{className:"flex items-center justify-between bg-white dark:bg-slate-700 rounded-xl p-4 border border-gray-200 dark:border-slate-600",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-4 h-4 rounded-full border-2 border-white dark:border-slate-600 shadow-sm",style:{backgroundColor:s}}),(0,a.jsx)("span",{className:"text-gray-900 dark:text-white font-medium",children:t}),(0,a.jsxs)("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:["(",r,")"]})]}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>{m(r),b(t),y(s)},className:"px-3 py-1 text-sm text-blue-600 dark:text-blue-400 hover:text-blue-700 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors duration-200",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>C(r),className:"px-3 py-1 text-sm text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors duration-200",children:"Delete"})]})]},r)})}):(0,a.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,a.jsx)(d.Z,{className:"h-12 w-12 mx-auto mb-3 text-gray-400 dark:text-gray-500"}),(0,a.jsx)("p",{children:"No project managers configured yet"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border border-gray-200 dark:border-slate-700 rounded-2xl shadow-xl p-8",children:[(0,a.jsxs)("div",{className:"flex items-center mb-6",children:[(0,a.jsx)("div",{className:"w-12 h-12 bg-green-100 dark:bg-green-900/40 rounded-xl flex items-center justify-center mr-4",children:(0,a.jsx)(u.Z,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Clockify Integration"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Time tracking and analytics integration"})]})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[p.configured?(0,a.jsx)("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-xl p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-green-500 rounded-full mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-lg font-semibold text-green-800 dark:text-green-200",children:"Clockify Integration Active"}),(0,a.jsx)("p",{className:"text-green-600 dark:text-green-300",children:"Time tracking data will be included in dashboard metrics"})]})]})}):(0,a.jsx)("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-xl p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-3 h-3 bg-yellow-500 rounded-full mr-3"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-lg font-semibold text-yellow-800 dark:text-yellow-200",children:"Clockify Integration Not Configured"}),(0,a.jsx)("p",{className:"text-yellow-600 dark:text-yellow-300",children:p.error||"Please configure Clockify API credentials"})]})]})}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:A,className:"px-6 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl font-medium transition-colors duration-200 shadow-lg hover:shadow-xl",children:"Test Connection"})}),p.workspaces&&p.workspaces.length>0&&(0,a.jsxs)("div",{className:"bg-gray-50 dark:bg-slate-700/50 rounded-xl p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Available Workspaces"}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:p.workspaces.map(e=>(0,a.jsxs)("div",{className:"bg-white dark:bg-slate-700 rounded-lg p-3 border border-gray-200 dark:border-slate-600",children:[(0,a.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:e.name}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["ID: ",e.id]})]},e.id))})]})]})]})]})]})})}function m(){return(0,a.jsx)(g.Z,{children:(0,a.jsx)(h,{})})}},17486:function(e,r,t){"use strict";t.d(r,{Z:function(){return l}});var a=t(57437),s=t(90483),n=t(99376),o=t(2265);function l(e){let{children:r}=e,{user:t,loading:l}=(0,s.a)(),i=(0,n.useRouter)();return((0,o.useEffect)(()=>{console.log("AdminOnly Debug:",{loading:l,user:t?{id:t.id,email:t.email,isAdmin:t.isAdmin,isBasic:t.isBasic}:null,shouldRedirect:!l&&(!t||!t.isAdmin)}),l||t&&t.isAdmin||(console.log("Redirecting to unauthorized page"),i.push("/unauthorized"))},[t,l,i]),l)?(0,a.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-indigo-900 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-xl text-gray-600 dark:text-gray-300",children:"Loading..."})]})}):t&&t.isAdmin?(console.log("AdminOnly: User is admin, rendering children"),(0,a.jsx)(a.Fragment,{children:r})):(console.log("AdminOnly: User not admin, returning null"),null)}},90483:function(e,r,t){"use strict";t.d(r,{AuthProvider:function(){return b},a:function(){return f}});var a=t(57437),s=t(2265),n=t(96244);let o="72ed6933-6bc6-430e-a75a-cb5d2e1c20e1",l="e4748cdc-321b-4db0-bc36-141b121a9117";o&&l||(console.warn("Azure AD environment variables are not set. Authentication will not work."),console.warn("Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file"));let i={auth:{clientId:o||"dummy-client-id",authority:"https://login.microsoftonline.com/".concat(l||"dummy-tenant-id"),redirectUri:window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}},c=new n.Lx(i),d={scopes:["User.Read","Directory.Read.All"]};function u(e){if(!e)return console.warn("checkAdminStatus: No user email provided"),!1;try{var r;if((((r="jonathan@collectif.nyc,Rafael@collectif.nyc",void 0===r)?void 0:r.split(",").map(e=>e.trim()))||[]).includes(e))return console.log("checkAdminStatus: User is admin via NEXT_PUBLIC_ADMIN_EMAILS"),!0}catch(e){console.warn("checkAdminStatus: Error checking NEXT_PUBLIC_ADMIN_EMAILS:",e)}if(e.endsWith("@collectif.nyc"))return console.log("checkAdminStatus: User is admin via @collectif.nyc domain"),!0;try{if(localStorage.getItem("adminOverride")===e)return console.log("checkAdminStatus: User is admin via localStorage override"),!0}catch(e){console.warn("checkAdminStatus: Error checking localStorage override:",e)}for(let r of[/^admin@/i,/^administrator@/i,/^superuser@/i,/^root@/i])if(r.test(e))return console.log("checkAdminStatus: User is admin via pattern match:",r),!0;return console.log("checkAdminStatus: User is not admin:",e),!1}async function g(){try{if(!o||!l)throw Error("Azure AD environment variables are not configured. Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file");return await c.loginRedirect(d),null}catch(e){throw console.error("Sign in error:",e),e}}async function h(){try{await c.logoutPopup()}catch(e){console.error("Sign out error:",e)}}async function m(){try{let e=c.getActiveAccount();if(!e)return console.log("getAuthUser: No active account found"),null;let r=null;try{let e=await c.acquireTokenSilent({scopes:["User.Read","Directory.Read.All"]}),t=await fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(e.accessToken)}});if(!t.ok)throw Error("Failed to fetch user details from Graph API");r=await t.json(),console.log("getAuthUser: Successfully fetched user data from Graph API")}catch(t){console.warn("getAuthUser: Graph API failed, using fallback data:",t),r={mail:e.username,userPrincipalName:e.username,displayName:e.name}}let t=r.mail||r.userPrincipalName||e.username,a=u(t);return console.log("getAuthUser Debug:",{userEmail:t,accountName:e.name,accountId:e.localAccountId,isAdmin:a,adminEmails:"jonathan@collectif.nyc,Rafael@collectif.nyc",envVarAccessible:!0}),{id:e.localAccountId,name:r.displayName||e.name||"",email:t||"",isAdmin:a,isBasic:!0}}catch(e){console.error("getAuthUser error:",e);try{let e=c.getActiveAccount();if(!e)return console.log("getAuthUser: No account available for fallback"),null;let r=e.username,t=u(r);return console.log("getAuthUser Fallback Debug:",{accountEmail:r,accountName:e.name,isAdmin:t}),{id:e.localAccountId||"fallback-user",name:e.name||"Unknown User",email:r||"",isAdmin:t,isBasic:!0}}catch(e){return console.error("getAuthUser: Fallback also failed:",e),null}}}let x=(0,s.createContext)(void 0);function b(e){let{children:r}=e,[t,n]=(0,s.useState)(null),[o,l]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{try{await c.initialize();let e=await c.handleRedirectPromise();e&&(console.log("Redirect response received:",e),c.setActiveAccount(e.account));let r=await m();n(r)}catch(e){console.error("Auth initialization error:",e)}finally{l(!1)}})()},[]);let i=async()=>{try{l(!0),await g()}catch(e){console.error("Sign in error:",e),l(!1)}},d=async()=>{try{l(!0),await h(),n(null)}catch(e){console.error("Sign out error:",e)}finally{l(!1)}};return(0,a.jsx)(x.Provider,{value:{user:t,loading:o,signIn:i,signOut:d},children:r})}function f(){let e=(0,s.useContext)(x);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},32660:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(39763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},95805:function(e,r,t){"use strict";t.d(r,{Z:function(){return a}});let a=(0,t(39763).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},99376:function(e,r,t){"use strict";var a=t(35475);t.o(a,"useRouter")&&t.d(r,{useRouter:function(){return a.useRouter}})}},function(e){e.O(0,[451,244,64,848,971,117,744],function(){return e(e.s=19396)}),_N_E=e.O()}]);