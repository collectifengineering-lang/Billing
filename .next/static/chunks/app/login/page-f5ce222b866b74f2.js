(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[626],{45161:function(e,n,i){Promise.resolve().then(i.bind(i,66374))},66374:function(e,n,i){"use strict";i.r(n),i.d(n,{default:function(){return o}});var t=i(57437),r=i(2265),l=i(99376),a=i(90483);function o(){let{user:e,loading:n,signIn:i}=(0,a.a)(),o=(0,l.useRouter)(),[c,s]=(0,r.useState)(null);(0,r.useEffect)(()=>{!n&&e&&o.push("/")},[e,n,o]);let u=async()=>{try{s(null),await i()}catch(e){console.error("Sign in error:",e),s(e instanceof Error?e.message:"Sign in failed")}};return n?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):e?null:(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"max-w-md w-full space-y-8",children:[(0,t.jsx)("div",{children:(0,t.jsx)("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Sign in to your account"})}),(0,t.jsxs)("div",{className:"mt-8 space-y-6",children:[c&&(0,t.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)("svg",{className:"h-5 w-5 text-red-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Authentication Error"}),(0,t.jsxs)("div",{className:"mt-2 text-sm text-red-700",children:[(0,t.jsx)("p",{children:c}),c.includes("environment variables")&&(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("p",{className:"font-medium",children:"To fix this:"}),(0,t.jsxs)("ol",{className:"list-decimal list-inside mt-1 space-y-1",children:[(0,t.jsxs)("li",{children:["Create a ",(0,t.jsx)("code",{className:"bg-red-100 px-1 rounded",children:".env.local"})," file in the project root"]}),(0,t.jsx)("li",{children:"Add your Azure AD configuration:"})]}),(0,t.jsx)("pre",{className:"mt-2 bg-red-100 p-2 rounded text-xs overflow-x-auto",children:"NEXT_PUBLIC_AZURE_AD_CLIENT_ID=your-client-id\nNEXT_PUBLIC_AZURE_AD_TENANT_ID=your-tenant-id"})]})]})]})]})}),(0,t.jsx)("div",{children:(0,t.jsx)("button",{onClick:u,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:"Sign in with Azure AD"})})]})]})})}},90483:function(e,n,i){"use strict";i.d(n,{AuthProvider:function(){return x},a:function(){return A}});var t=i(57437),r=i(2265),l=i(96244),a=i(40257);let o="72ed6933-6bc6-430e-a75a-cb5d2e1c20e1",c="e4748cdc-321b-4db0-bc36-141b121a9117";o&&c||(console.warn("Azure AD environment variables are not set. Authentication will not work."),console.warn("Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file"));let s={auth:{clientId:o||"dummy-client-id",authority:"https://login.microsoftonline.com/".concat(c||"dummy-tenant-id"),redirectUri:window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}},u=new l.Lx(s),d={scopes:["User.Read","Directory.Read.All"]};async function m(){try{if(!o||!c)throw Error("Azure AD environment variables are not configured. Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file");return await u.loginRedirect(d),null}catch(e){throw console.error("Sign in error:",e),e}}async function h(){try{await u.logoutPopup()}catch(e){console.error("Sign out error:",e)}}async function f(){try{var e,n,i,t,r;let l=u.getActiveAccount();if(!l)return null;let o=await u.acquireTokenSilent({scopes:["User.Read","Directory.Read.All"]}),c=await fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(o.accessToken)}});if(!c.ok)throw Error("Failed to fetch user details");let s=await c.json(),d=(null===(e=a.env.NEXT_PUBLIC_ADMIN_EMAILS)||void 0===e?void 0:e.split(","))||[],m=d.includes(s.mail)||d.includes(s.userPrincipalName)||(null===(n=s.mail)||void 0===n?void 0:n.endsWith("@collectif.nyc"))||(null===(i=s.mail)||void 0===i?void 0:i.endsWith("@yourcompany.com"));return console.log("Auth Debug:",{userEmail:s.mail,userPrincipalName:s.userPrincipalName,adminEmails:d,isAdmin:m,adminEmailsIncludes:d.includes(s.mail),adminEmailsIncludesPrincipal:d.includes(s.userPrincipalName),endsWithCollectif:null===(t=s.mail)||void 0===t?void 0:t.endsWith("@collectif.nyc"),endsWithLegacy:null===(r=s.mail)||void 0===r?void 0:r.endsWith("@yourcompany.com"),envVar:a.env.NEXT_PUBLIC_ADMIN_EMAILS}),{id:l.localAccountId,name:l.name||"",email:l.username||"",isAdmin:m,isBasic:!0}}catch(n){console.error("Get auth user error:",n);let e=u.getActiveAccount();return console.log("Auth Fallback Debug:",{accountEmail:null==e?void 0:e.username,accountName:null==e?void 0:e.name,isAdmin:!1}),{id:(null==e?void 0:e.localAccountId)||"",name:(null==e?void 0:e.name)||"",email:(null==e?void 0:e.username)||"",isAdmin:!1,isBasic:!0}}}let v=(0,r.createContext)(void 0);function x(e){let{children:n}=e,[i,l]=(0,r.useState)(null),[a,o]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{try{await u.initialize();let e=await u.handleRedirectPromise();e&&(console.log("Redirect response received:",e),u.setActiveAccount(e.account));let n=await f();l(n)}catch(e){console.error("Auth initialization error:",e)}finally{o(!1)}})()},[]);let c=async()=>{try{o(!0),await m()}catch(e){console.error("Sign in error:",e),o(!1)}},s=async()=>{try{o(!0),await h(),l(null)}catch(e){console.error("Sign out error:",e)}finally{o(!1)}};return(0,t.jsx)(v.Provider,{value:{user:i,loading:a,signIn:c,signOut:s},children:n})}function A(){let e=(0,r.useContext)(v);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},99376:function(e,n,i){"use strict";var t=i(35475);i.o(t,"useRouter")&&i.d(n,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[649,971,117,744],function(){return e(e.s=45161)}),_N_E=e.O()}]);