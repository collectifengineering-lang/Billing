(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{78929:function(e,t,r){Promise.resolve().then(r.bind(r,60624))},60624:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return W}});var s=r(57437),a=r(2265),o=r(99376),l=r(90483),n=r(58091),i=r(94508),c=r(10398),d=r(7586),u=r(98728),m=r(82431),x=r(50091),h=r(91723),g=r(27648),f=r(33145);function p(e){var t;let{onRefresh:r,onForceRefresh:a,cacheInfo:o,autoRefreshStatus:l}=e;return(0,s.jsx)("div",{className:"bg-white shadow-sm border-b border-gray-200",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-16",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"relative w-12 h-12",children:(0,s.jsx)(f.default,{src:"/collectif-logo.png",alt:"Collectif Logo",fill:!0,className:"object-contain"})}),(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Collectif MEP's Billings"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)(g.default,{href:"/projects",className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",children:[(0,s.jsx)(d.Z,{className:"h-5 w-5 mr-2"}),"Project Summary"]}),(0,s.jsxs)(g.default,{href:"/settings",className:"flex items-center text-gray-600 hover:text-gray-900 transition-colors",children:[(0,s.jsx)(u.Z,{className:"h-5 w-5 mr-2"}),"Settings"]})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsxs)("button",{onClick:r,className:"flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:[(0,s.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,s.jsxs)("button",{onClick:a,className:"flex items-center px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50 transition-colors",children:[(0,s.jsx)(x.Z,{className:"h-4 w-4 mr-2"}),"Force Refresh"]})]}),l&&(0,s.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[(0,s.jsx)(h.Z,{className:"h-3 w-3"}),(0,s.jsx)("span",{className:l.isActive?"text-green-600":"text-gray-400",children:l.isActive?"Auto-refresh":"Auto-refresh off"}),l.isActive&&(0,s.jsxs)("span",{className:"text-gray-400",children:["(",(t=l.nextRefreshIn,"".concat(Math.floor(t/6e4),":").concat(Math.floor(t%6e4/1e3).toString().padStart(2,"0"))),")"]})]}),o&&(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[o.fromCache?"From cache":"Fresh data",o.changes&&(0,s.jsxs)("span",{className:"ml-2 text-green-600",children:["+",Object.values(o.changes).flat().length," changes"]})]})]})]})})})}var j=r(48736),b=r(95252),y=r(70525),v=r(95805);function N(e){let{billingData:t,closedProjects:r}=e,a=(0,i.fc)(t,r),o=[{name:"Total Projects",value:a.totalProjects,icon:j.Z,color:"bg-blue-500"},{name:"Total Billed YTD",value:(0,i.xG)(a.totalBilled),icon:b.Z,color:"bg-green-500"},{name:"Backlog",value:(0,i.xG)(a.totalUnbilled),icon:y.Z,color:"bg-yellow-500"},{name:"Active Projects",value:a.activeProjects,icon:v.Z,color:"bg-purple-500"}];return(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:o.map(e=>(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"p-3 rounded-lg ".concat(e.color),children:(0,s.jsx)(e.icon,{className:"h-6 w-6 text-white"})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-600",children:e.name}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.value})]})]})},e.name))})}var w=r(47625),S=r(7476),C=r(56940),k=r(97059),I=r(62994),P=r(8147),E=r(22190),O=r(23263),F=r(77086);function T(e){let{billingData:t,closedProjects:r}=e,o=t||[],l=r||new Set,[n,c]=(0,a.useState)(0),d=e=>fetch(e).then(e=>e.json()),{data:u}=(0,F.ZP)("/api/projections",d),{data:m}=(0,F.ZP)("/api/statuses",d);(0,a.useEffect)(()=>{let e=()=>{c(e=>e+1)};return window.addEventListener("projectionsUpdated",e),window.addEventListener("statusUpdated",e),()=>{window.removeEventListener("projectionsUpdated",e),window.removeEventListener("statusUpdated",e)}},[]);let x=u||{},h=m||{},g=(0,i.UF)().map(e=>{let t=0,r=0,s=new Set([...o.map(e=>e.projectId),...Array.from(l)]);s.forEach(s=>{let a=x[s],o=h[s];if(a&&a[e]){let s=a[e];o&&"Billed"===o[e]?r+=s:t+=s}});let a=t;return e===new Date().toISOString().slice(0,7)&&console.log("BillingChart: Current month data:",{month:e,monthProjected:t,monthBilled:r,monthUnbilled:a,allProjectIdsCount:s.size,activeProjectsCount:o.length,closedProjectsCount:l.size}),{month:e,name:(0,i.bh)(e),billed:r,unbilled:a,projected:t,total:t}});return(0,s.jsx)("div",{className:"h-80",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsx)("div",{className:"chart-container",children:(0,s.jsx)(w.h,{width:"100%",height:320,children:(0,s.jsxs)(S.T,{data:g,margin:{top:20,right:30,left:20,bottom:5},children:[(0,s.jsx)(C.q,{strokeDasharray:"3 3"}),(0,s.jsx)(k.K,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0}),(0,s.jsx)(I.B,{tickFormatter:e=>"$".concat((e/1e3).toFixed(0),"k"),fontSize:12,label:{value:"Amount (USD)",angle:-90,position:"insideLeft"}}),(0,s.jsx)(P.u,{content:(0,s.jsx)(e=>{let{active:t,payload:r,label:a}=e;return t&&r&&r.length?(0,s.jsxs)("div",{className:"bg-white p-4 border rounded-lg shadow-lg",children:[(0,s.jsx)("p",{className:"font-medium text-gray-900",children:a}),r.map((e,t)=>(0,s.jsxs)("p",{className:"text-sm",style:{color:e.color},children:[e.name,": ",(0,i.xG)(e.value)]},t))]}):null},{})}),(0,s.jsx)(E.D,{}),(0,s.jsx)(O.u,{type:"monotone",dataKey:"projected",stackId:"1",stroke:"#f97316",fill:"#f97316",fillOpacity:.6,name:"Projected"}),(0,s.jsx)(O.u,{type:"monotone",dataKey:"billed",stackId:"1",stroke:"#10b981",fill:"#10b981",fillOpacity:.6,name:"Billed"})]})})})})})}var A=r(29),D=r.n(A),Z=r(60413),R=r(22135),L=r(40875),z=r(73247),B=r(32489),J=r(92369),M=r(69064),U=r(92735),_=r(17689),V=r(65302),H=r(22252);function Y(e){let t=[],r="",s=!1;for(let a=0;a<e.length;a++){let o=e[a];'"'===o?s&&'"'===e[a+1]?(r+='"',a++):s=!s:","!==o||s?r+=o:(t.push(r.trim()),r="")}return t.push(r.trim()),t}function G(e){let[t,r]=e.split("-");return new Date(parseInt(t),parseInt(r)-1).toLocaleDateString("en-US",{month:"short",year:"numeric"})}function X(e,t){let r=new Blob([e],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");if(void 0!==s.download){let e=URL.createObjectURL(r);s.setAttribute("href",e),s.setAttribute("download",t),s.style.visibility="hidden",document.body.appendChild(s),s.click(),document.body.removeChild(s)}}function K(e){let{billingData:t,monthlyProjections:r,asrFees:o,signedFees:l,monthRange:n,onImportData:i}=e,[c,d]=(0,a.useState)(!1),[u,m]=(0,a.useState)(null),[x,h]=(0,a.useState)(!1),g=(0,a.useRef)(null),f=async e=>{var r;let s=null===(r=e.target.files)||void 0===r?void 0:r[0];if(s){if(!s.name.toLowerCase().endsWith(".csv")){M.Am.error("Please select a CSV file");return}d(!0),m(null);try{let e=await new Promise((e,t)=>{let r=new FileReader;r.onload=t=>{var r;e(null===(r=t.target)||void 0===r?void 0:r.result)},r.onerror=()=>{t(Error("Failed to read CSV file"))},r.readAsText(s)}),r=function(e,t){try{let r=e.trim().split("\n");if(r.length<2)return{success:!1,errors:["CSV file must have at least a header row and one data row"]};let s=Y(r[0]),a=r.slice(1),o=["Project ID","Project Name","Customer Name","Signed Fee","ASR Fee"].filter(e=>!s.includes(e));if(o.length>0)return{success:!1,errors:["Missing required headers: ".concat(o.join(", "))]};let l=s.slice(5),n=l.filter(e=>!/^\d{4}-\d{2}$/.test(e));if(n.length>0)return{success:!1,errors:["Invalid month format found: ".concat(n.join(", "),". Expected format: YYYY-MM")]};let i={},c=[];if(a.forEach((e,r)=>{let a=Y(e);if(a.length!==s.length){c.push("Row ".concat(r+2,": Column count mismatch. Expected ").concat(s.length,", got ").concat(a.length));return}let o=a[0].trim();if(a[1],a[2],parseFloat(a[3]),parseFloat(a[4]),!t.some(e=>e.projectId===o)){c.push("Row ".concat(r+2,': Project ID "').concat(o,'" not found in current data'));return}let n={};l.forEach((e,t)=>{let r=parseFloat(a[5+t])||0;n[e]=r}),i[o]=n}),c.length>0)return{success:!1,errors:c,data:i};return{success:!0,data:i,message:"Successfully imported ".concat(Object.keys(i).length," projects with ").concat(l.length," months of data")}}catch(e){return{success:!1,errors:["Error parsing CSV: ".concat(e instanceof Error?e.message:"Unknown error")]}}}(e,t);m(r),r.success&&r.data?M.Am.success(r.message||"Import completed successfully!"):M.Am.error("Import failed. Please check the errors below.")}catch(e){console.error("Import error:",e),M.Am.error("Failed to read CSV file"),m({success:!1,errors:["Failed to read CSV file"]})}finally{d(!1)}}},p=()=>{h(!1),m(null),g.current&&(g.current.value="")};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex gap-2 mb-4",children:[(0,s.jsxs)("button",{onClick:()=>{try{let e=function(e,t,r,s,a){let o=["Project ID","Project Name","Customer Name","Signed Fee","ASR Fee",...a.map(e=>G(e))],l=e.map(e=>{let o={projectId:e.projectId,projectName:e.projectName,customerName:e.customerName,signedFee:s[e.projectId]||e.signedFee||0,asrFee:r[e.projectId]||0};return a.forEach(r=>{var s;let a=(null===(s=t[e.projectId])||void 0===s?void 0:s[r])||0;o[r]=a}),o});return[o.join(","),...l.map(e=>o.map(t=>{let r;if("Project ID"===t){let t=e.projectId;console.log("CSV Export - Project ID type:",typeof t,"value:",t),console.log("CSV Export - Final Project ID value:",r="number"==typeof t||"string"==typeof t?String(t):"")}else if("Project Name"===t)r=e.projectName;else if("Customer Name"===t)r=e.customerName;else if("Signed Fee"===t)r=e.signedFee;else if("ASR Fee"===t)r=e.asrFee;else{let s=a.find(e=>G(e)===t);r=s?e[s]:0}let s=String(r).replace(/"/g,'""');return'"'.concat(s,'"')}).join(","))].join("\n")}(t,r,o,l,n),s=function(){let e=new Date,t=e.toISOString().slice(0,10),r=e.toTimeString().slice(0,8).replace(/:/g,"-");return"projections-export-".concat(t,"-").concat(r,".csv")}();X(e,s),M.Am.success("Projections exported successfully!")}catch(e){console.error("Export error:",e),M.Am.error("Failed to export projections")}},className:"flex items-center gap-2 px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors",children:[(0,s.jsx)(U.Z,{className:"w-4 h-4"}),"Export to CSV"]}),(0,s.jsxs)("button",{onClick:()=>{h(!0),m(null)},className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:[(0,s.jsx)(_.Z,{className:"w-4 h-4"}),"Import from CSV"]}),(0,s.jsxs)("button",{onClick:()=>{X("Project ID,Project Name,Customer Name,Signed Fee,ASR Fee,2024-01,2024-02,2024-03,2024-04,2024-05,2024-06\n910829000008470049,Sample Project,Sample Customer,50000,10000,5000,7500,6000,8000,9000,7000","projections-template.csv"),M.Am.success("Template downloaded successfully!")},className:"flex items-center gap-2 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:[(0,s.jsx)(j.Z,{className:"w-4 h-4"}),"Download Template"]})]}),x&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,s.jsx)(j.Z,{className:"w-5 h-5"}),"Import Projections from CSV"]}),(0,s.jsx)("button",{onClick:p,className:"text-gray-500 hover:text-gray-700",children:(0,s.jsx)(B.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 mb-4",children:"Select a CSV file to import projections data. The file should include:"}),(0,s.jsxs)("ul",{className:"text-sm text-gray-600 list-disc list-inside mb-4",children:[(0,s.jsx)("li",{children:"Project ID, Project Name, Customer Name"}),(0,s.jsx)("li",{children:"Signed Fee and ASR Fee columns"}),(0,s.jsx)("li",{children:"Monthly projection columns (format: YYYY-MM)"})]}),(0,s.jsx)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:(0,s.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,s.jsx)("strong",{children:"Tip:"}),' Use the "Download Template" button to get a sample CSV file with the correct format.']})}),(0,s.jsx)("input",{ref:g,type:"file",accept:".csv",onChange:f,className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",disabled:c})]}),u&&(0,s.jsxs)("div",{className:"mb-4",children:[u.success?(0,s.jsxs)("div",{className:"flex items-center gap-2 p-3 bg-green-50 border border-green-200 rounded-lg",children:[(0,s.jsx)(V.Z,{className:"w-5 h-5 text-green-600"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-green-800 font-medium",children:"Import Successful"}),(0,s.jsx)("p",{className:"text-green-700 text-sm",children:u.message})]})]}):(0,s.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-red-50 border border-red-200 rounded-lg",children:[(0,s.jsx)(H.Z,{className:"w-5 h-5 text-red-600 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-red-800 font-medium",children:"Import Failed"}),u.errors&&(0,s.jsx)("ul",{className:"text-red-700 text-sm mt-1",children:u.errors.map((e,t)=>(0,s.jsx)("li",{className:"list-disc list-inside",children:e},t))})]})]}),!u.success&&u.data&&Object.keys(u.data).length>0&&(0,s.jsx)("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,s.jsx)("p",{className:"text-yellow-800 text-sm",children:'Some data was successfully parsed. You can still import the valid data by clicking "Import Valid Data".'})})]}),(0,s.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,s.jsx)("button",{onClick:p,className:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors",children:"Cancel"}),(null==u?void 0:u.data)&&Object.keys(u.data).length>0&&(0,s.jsxs)("button",{onClick:()=>{(null==u?void 0:u.success)&&u.data&&(i(u.data),h(!1),m(null),M.Am.success("Data imported successfully!"))},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:["Import ",u.success?"All":"Valid"," Data"]})]})]})})]})}function q(e){let{billingData:t,projections:r,onUpdateProjections:o,closedProjects:l,onClosedProjectsChange:n,useDB:c=!0}=e,d=t||[],[u,m]=(0,a.useState)(null),[x,h]=(0,a.useState)(null),[g,f]=(0,a.useState)(null),[p,j]=(0,a.useState)(""),[b,y]=(0,a.useState)(null),[v,N]=(0,a.useState)(null),[w,S]=(0,a.useState)(null),[C,k]=(0,a.useState)(null),[I,P]=(0,a.useState)(null),[E,O]=(0,a.useState)(""),[T,A]=(0,a.useState)(null),[U,_]=(0,a.useState)(l||new Set),[V,H]=(0,a.useState)([]),[Y,G]=(0,a.useState)({}),[X,q]=(0,a.useState)(!1),[W,$]=(0,a.useState)({field:"projectName",direction:"asc"}),[Q,ee]=(0,a.useState)(""),et=e=>fetch(e).then(e=>e.json()),er={revalidateOnFocus:!0,revalidateOnReconnect:!0,refreshInterval:0},{data:es,mutate:ea}=(0,F.ZP)("/api/signed-fees",et,er),{data:eo,mutate:el}=(0,F.ZP)("/api/asr-fees",et,er),{data:en,mutate:ei}=(0,F.ZP)("/api/projections",et,er),{data:ec,mutate:ed}=(0,F.ZP)("/api/statuses",et,er),{data:eu,mutate:em}=(0,F.ZP)("/api/comments",et,er),{data:ex,mutate:eh}=(0,F.ZP)("/api/closed-projects",et,er),{data:eg,mutate:ef}=(0,F.ZP)("/api/project-assignments",et,er),{data:ep,mutate:ej}=(0,F.ZP)("/api/project-managers",et,er),[eb,ey]=(0,a.useState)({}),[ev,eN]=(0,a.useState)({}),[ew,eS]=(0,a.useState)({}),[eC,ek]=(0,a.useState)({}),[eI,eP]=(0,a.useState)({}),eE=(0,a.useRef)(null),eO=(0,a.useRef)(null),eF=(0,a.useRef)(null),eT=(0,a.useRef)(null),eA=(0,a.useRef)(null),eD=(0,a.useRef)(null),eZ=(0,a.useRef)(null),eR=(0,a.useRef)(null),[eL,ez]=(0,a.useState)(0),[eB,eJ]=(0,a.useState)(0),[eM,eU]=(0,a.useState)(!1),[e_,eV]=(0,a.useState)(0),[eH,eY]=(0,a.useState)(0),eG=(0,a.useMemo)(()=>(0,i.ji)(),[]),eX=(0,a.useMemo)(()=>new Date().toISOString().slice(0,7),[]);(0,a.useEffect)(()=>{es&&Object.keys(es).length>0&&ey(es)},[es]),(0,a.useEffect)(()=>{eo&&Object.keys(eo).length>0&&eN(eo)},[eo]),(0,a.useEffect)(()=>{en&&Object.keys(en).length>0&&eS(en)},[en]),(0,a.useEffect)(()=>{ec&&Object.keys(ec).length>0&&ek(ec)},[ec]),(0,a.useEffect)(()=>{eu&&Object.keys(eu).length>0&&eP(eu)},[eu]),(0,a.useEffect)(()=>{if(ex&&Array.isArray(ex)){let e=new Set(ex);_(e),null==n||n(e)}},[ex,n]),(0,a.useEffect)(()=>{eg&&"object"==typeof eg&&G(eg)},[eg]),(0,a.useEffect)(()=>{ep&&Array.isArray(ep)&&H(ep)},[ep]),(0,a.useEffect)(()=>()=>{},[]),(0,a.useEffect)(()=>{console.log("HighPerformanceTable: projectManagers state changed:",V)},[V]),(0,a.useEffect)(()=>{let e=setInterval(()=>{let e=localStorage.getItem("projectManagers");e&&Array.isArray(JSON.parse(e))&&0===V.length&&(console.log("HighPerformanceTable: Periodic check found project managers but state is empty, reloading"),H(JSON.parse(e)))},5e3);return()=>clearInterval(e)},[V.length]),(0,a.useEffect)(()=>{let e=e=>{if(b&&v){let t=e.target,r=document.querySelector('[data-dropdown="true"]');r&&!r.contains(t)&&(y(null),N(null))}if(w&&C){let t=e.target,r=document.querySelector('[data-dropdown="true"]');r&&!r.contains(t)&&(S(null),k(null))}if(I&&eR.current){let t=e.target;eR.current.contains(t)||(P(null),O(""),A(null))}};return(b||w||I)&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[b,v,w,C,I]),(0,a.useEffect)(()=>{var e,t;let r=()=>{eE.current&&eO.current&&(eO.current.scrollTop=eE.current.scrollTop)},s=()=>{eE.current&&eO.current&&(eE.current.scrollTop=eO.current.scrollTop)};return null===(e=eE.current)||void 0===e||e.addEventListener("scroll",r),null===(t=eO.current)||void 0===t||t.addEventListener("scroll",s),()=>{var e,t;null===(e=eE.current)||void 0===e||e.removeEventListener("scroll",r),null===(t=eO.current)||void 0===t||t.removeEventListener("scroll",s)}},[]),(0,a.useEffect)(()=>{eE.current&&eE.current.classList.add("hide-scrollbar"),eO.current&&(eO.current.style.overflowX="hidden")},[]),(0,a.useEffect)(()=>{if(eA.current){let e=eG.indexOf(eX);-1!==e&&(eA.current.scrollLeft=128*e)}},[eG,eX]),(0,a.useEffect)(()=>{var e;let t=()=>{eA.current&&q(eA.current.scrollLeft>0)};return null===(e=eA.current)||void 0===e||e.addEventListener("scroll",t),()=>{var e;null===(e=eA.current)||void 0===e||e.removeEventListener("scroll",t)}},[]),(0,a.useEffect)(()=>{eD.current&&ez(eD.current.clientHeight);let e=new ResizeObserver(()=>{eD.current&&ez(eD.current.clientHeight)});return eD.current&&e.observe(eD.current),()=>e.disconnect()},[]),(0,a.useEffect)(()=>{eZ.current&&eJ(eZ.current.clientHeight);let e=new ResizeObserver(()=>{eZ.current&&eJ(eZ.current.clientHeight)});return eZ.current&&e.observe(eZ.current),()=>e.disconnect()},[]),(0,a.useEffect)(()=>{eV((()=>{let e=document.createElement("div");e.style.overflowY="scroll",e.style.width="50px",e.style.height="50px",e.style.visibility="hidden",document.body.appendChild(e);let t=e.offsetWidth-e.clientWidth;return document.body.removeChild(e),t})())},[]),(0,a.useEffect)(()=>{eY((()=>{let e=document.createElement("div");e.style.overflowX="scroll",e.style.height="50px",e.style.width="50px",e.style.visibility="hidden",document.body.appendChild(e);let t=e.offsetHeight-e.clientHeight;return document.body.removeChild(e),t})())},[]);let eK=(0,a.useCallback)((e,t)=>{var r;return(null==en?void 0:null===(r=en[e])||void 0===r?void 0:r[t])||0},[en]),eq=(0,a.useCallback)(e=>(null==eo?void 0:eo[e])||0,[eo]),eW=(0,a.useCallback)(e=>((null==es?void 0:es[e.projectId])||0)+eq(e.projectId),[es,eq]),e$=(0,a.useCallback)(e=>eG.reduce((t,r)=>t+eK(e,r),0),[eG,eK]);(0,a.useCallback)(e=>{let t=null==eg?void 0:eg[e],r=null==ep?void 0:ep.find(e=>e.id===t);return null==r?void 0:r.color},[eg,ep]);let eQ=(0,a.useCallback)((e,t)=>{var r;return(null==ec?void 0:null===(r=ec[e])||void 0===r?void 0:r[t])||""},[ec]),e0=(0,a.useCallback)((e,t)=>{var r;return(null==eu?void 0:null===(r=eu[e])||void 0===r?void 0:r[t])||""},[eu]),e5=e=>{switch(e){case"Confirmed":return"bg-blue-50";case"Estimate":return"bg-yellow-50";case"Billed":return"bg-green-50";case"Other":return"bg-purple-50";default:return""}},e6=(0,a.useCallback)((e,t,r)=>{m({projectId:e,month:t}),j(r.toString())},[]),e2=(0,a.useCallback)(async()=>{if(!u)return;let{projectId:e,month:t}=u,r=parseFloat(p)||0;try{await fetch("/api/projections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,month:t,value:r})}),ei(),window.dispatchEvent(new CustomEvent("projectionsUpdated")),m(null),j("")}catch(e){console.error("Error saving projection:",e),M.ZP.error("Failed to save projection")}},[u,p,ei]),e1=(0,a.useCallback)(async()=>{if(!x)return;let e=parseFloat(p)||0;try{await fetch("/api/asr-fees",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:x,value:e})}),eN(t=>({...t,[x]:e})),el(),h(null),j("")}catch(e){console.error("Error saving ASR fee:",e),M.ZP.error("Failed to save ASR fee")}},[x,p,el]),e7=(0,a.useCallback)(async()=>{if(!g)return;let e=parseFloat(p)||0;try{await fetch("/api/signed-fees",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:g,value:e})}),ey(t=>({...t,[g]:e})),ea(),f(null),j("")}catch(e){console.error("Error saving signed fee:",e),M.ZP.error("Failed to save signed fee")}},[g,p,ea]),e8=(0,a.useCallback)(async e=>{try{await fetch("/api/closed-projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})});let t=new Set(U);t.add(e),_(t),null==n||n(t),eh(),y(null),M.ZP.success("Project closed")}catch(e){console.error("Error closing project:",e),M.ZP.error("Failed to close project")}},[U,n,eh]);(0,a.useCallback)(async e=>{try{await fetch("/api/closed-projects",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})});let t=new Set(U);t.delete(e),_(t),null==n||n(t),eh(),M.ZP.success("Project reopened")}catch(e){console.error("Error reopening project:",e),M.ZP.error("Failed to reopen project")}},[U,n,eh]);let e9=async e=>{if(!w)return;let{projectId:t,month:r}=w;try{"Clear"===e?await fetch("/api/statuses",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:t,month:r})}):await fetch("/api/statuses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:t,month:r,status:e})}),ed(),window.dispatchEvent(new CustomEvent("projectionsUpdated")),S(null),k(null)}catch(e){console.error("Error updating status:",e),M.ZP.error("Failed to update status")}},e4=async e=>{if(!w)return;let{projectId:t,month:r}=w;if("AddComment"===e||"EditComment"===e){P(w),O(e0(t,r)),A(C),S(null),k(null);return}if("RemoveComment"===e){try{await fetch("/api/comments",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:t,month:r})}),em(),S(null),k(null)}catch(e){console.error("Error removing comment:",e),M.ZP.error("Failed to remove comment")}return}await e9(e)},e3=(0,a.useCallback)(e=>[...e].sort((e,t)=>{let r,s;switch(W.field){case"projectName":r=e.projectName.toLowerCase(),s=t.projectName.toLowerCase();break;case"signedFee":r=eb[e.projectId]||e.signedFee||0,s=eb[t.projectId]||t.signedFee||0;break;case"asrFee":r=eq(e.projectId),s=eq(t.projectId);break;case"totalFee":r=eW(e),s=eW(t);break;case"projected":r=e$(e.projectId),s=e$(t.projectId);break;default:if(!eG.includes(W.field))return 0;r=eK(e.projectId,W.field),s=eK(t.projectId,W.field)}return r<s?"asc"===W.direction?-1:1:r>s?"asc"===W.direction?1:-1:0}),[W,eb,eq,eW,e$,eG,eK]),te=(0,a.useCallback)(e=>{$(t=>({field:e,direction:t.field===e&&"asc"===t.direction?"desc":"asc"}))},[]),tt=e=>W.field!==e?null:"asc"===W.direction?(0,s.jsx)(R.Z,{className:"h-4 w-4"}):(0,s.jsx)(L.Z,{className:"h-4 w-4"}),tr=e=>W.field!==e?null:"asc"===W.direction?(0,s.jsx)(R.Z,{className:"h-3 w-3"}):(0,s.jsx)(L.Z,{className:"h-3 w-3"}),ts=(0,a.useMemo)(()=>ex&&Array.isArray(ex)?new Set(ex):new Set,[ex]),ta=e3(d.filter(e=>!ts.has(e.projectId))),to=(0,a.useMemo)(()=>Q.trim()?ta.filter(e=>e.projectName.toLowerCase().includes(Q.toLowerCase())):ta,[ta,Q]);console.log("HighPerformanceTable: safeBillingData length:",d.length),console.log("HighPerformanceTable: activeProjects length:",ta.length),console.log("HighPerformanceTable: filteredProjects length:",to.length),console.log("HighPerformanceTable: closedProjects size:",U.size),d.length>0&&console.log("HighPerformanceTable: First billing data item:",d[0]),(0,a.useEffect)(()=>{let e=()=>{if(eD.current){let e=eD.current.scrollHeight>eD.current.clientHeight;eU(e);let t=e_||15,r=e?"".concat(t,"px"):"0";eF.current&&eF.current.firstChild&&(eF.current.firstChild.style.paddingRight=r),eT.current&&eT.current.firstChild&&(eT.current.firstChild.style.paddingRight=r)}};e();let t=new ResizeObserver(e);eD.current&&t.observe(eD.current);let r=setInterval(e,500);return()=>{t.disconnect(),clearInterval(r)}},[ta.length,e_]);let tl=async e=>{try{let t=[];Object.keys(e).forEach(r=>{Object.keys(e[r]).forEach(s=>{let a=e[r][s];0!==a&&t.push(fetch("/api/projections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:r,month:s,value:a})}))})}),t.length>0&&(await Promise.all(t),ei(),M.ZP.success("Data imported successfully")),o&&o(e)}catch(e){console.error("Error importing data:",e),M.ZP.error("Failed to import data")}};return(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 bg-white rounded-lg shadow overflow-hidden",children:[(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 px-6 py-4 border-b border-gray-200",children:[(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex items-center justify-between mb-4",children:(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750",children:[(0,s.jsx)("h3",{className:"jsx-19280ab6560fe750 text-lg font-medium text-gray-900",children:"Projections Table"}),(0,s.jsxs)("p",{className:"jsx-19280ab6560fe750 text-sm text-gray-600",children:["Virtualized table with ",to.length," active projects - click any cell to edit"]})]})}),(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 mb-4",children:[(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 relative",children:[(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)(z.Z,{className:"h-4 w-4 text-gray-400"})}),(0,s.jsx)("input",{type:"text",placeholder:"Filter projects by name...",value:Q,onChange:e=>ee(e.target.value),className:"jsx-19280ab6560fe750 block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}),Q&&(0,s.jsx)("button",{onClick:()=>ee(""),className:"jsx-19280ab6560fe750 absolute inset-y-0 right-0 pr-3 flex items-center",children:(0,s.jsx)(B.Z,{className:"h-4 w-4 text-gray-400 hover:text-gray-600"})})]}),Q&&(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 mt-2 text-sm text-gray-600",children:["Showing ",to.length," of ",ta.length," projects"]})]}),(0,s.jsx)(K,{billingData:d,monthlyProjections:ew,asrFees:ev,signedFees:eb,monthRange:eG,onImportData:tl})]}),(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 relative table-container",children:[(0,s.jsxs)("div",{style:{width:"776px",height:"600px"},className:"jsx-19280ab6560fe750 absolute left-0 top-0 z-30 bg-white flex flex-col",children:[(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 flex bg-gray-50 border-b border-gray-200 sticky-header",children:[(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-[264px] bg-gray-50 border-r border-gray-200",children:(0,s.jsxs)("div",{onClick:()=>te("projectName"),className:"jsx-19280ab6560fe750 h-18 px-4 py-3 flex items-center justify-start cursor-pointer hover:bg-gray-100 transition-colors group",children:[(0,s.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-500 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-700",children:"Project"}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 ml-1 text-gray-400 group-hover:text-gray-600",children:tt("projectName")})]})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsxs)("div",{onClick:()=>te("signedFee"),className:"jsx-19280ab6560fe750 h-18 px-4 py-3 flex items-center justify-end cursor-pointer hover:bg-gray-100 transition-colors group",children:[(0,s.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-500 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-700",children:"Signed Fee"}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 ml-1 text-gray-400 group-hover:text-gray-600",children:tt("signedFee")})]})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsxs)("div",{onClick:()=>te("asrFee"),className:"jsx-19280ab6560fe750 h-18 px-4 py-3 flex items-center justify-end cursor-pointer hover:bg-gray-100 transition-colors group",children:[(0,s.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-500 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-700",children:"Total ASR Fee"}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 ml-1 text-gray-400 group-hover:text-gray-600",children:tt("asrFee")})]})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsxs)("div",{onClick:()=>te("totalFee"),className:"jsx-19280ab6560fe750 h-18 px-4 py-3 flex items-center justify-end cursor-pointer hover:bg-gray-100 transition-colors group",children:[(0,s.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-500 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-700",children:"Total Fee"}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 ml-1 text-gray-400 group-hover:text-gray-600",children:tt("totalFee")})]})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsxs)("div",{onClick:()=>te("projected"),className:"jsx-19280ab6560fe750 h-18 px-4 py-3 flex items-center justify-end cursor-pointer hover:bg-gray-100 transition-colors group",children:[(0,s.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-500 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-700",children:"Projected"}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 ml-1 text-gray-400 group-hover:text-gray-600",children:tt("projected")})]})})]}),(0,s.jsx)("div",{ref:eZ,style:{overflowY:"auto",overflowX:"hidden"},className:"jsx-19280ab6560fe750 flex-1 hide-scrollbar",children:(0,s.jsx)(Z.t7,{height:eB,itemCount:to.length,itemSize:72,width:776,outerRef:eE,overscanCount:5,children:e=>{let{index:t,style:r}=e,a=to[t];if(!a)return null;let o=e$(a.projectId),l=eW(a),n=eq(a.projectId),c=x===a.projectId,d=(null==eg?void 0:eg[a.projectId])||Y[a.projectId],u=(null==ep?void 0:ep[d])||V.find(e=>e.id===d);return(0,s.jsxs)("div",{style:r,className:"jsx-19280ab6560fe750 flex border-b border-gray-200 sticky-column",children:[(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-[264px] bg-gray-50 border-r border-gray-200",children:(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 flex items-center h-18 px-4",children:[(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 flex-1 min-w-0 flex flex-col justify-center overflow-hidden",children:[(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 flex items-center",children:[u&&(0,s.jsx)("div",{style:{backgroundColor:u.color},className:"jsx-19280ab6560fe750 w-3 h-3 rounded-full mr-2"}),(0,s.jsx)("span",{title:a.projectName,className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-900 truncate",children:a.projectName})]}),u&&(0,s.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs text-gray-500 italic truncate",children:u.name})]}),(0,s.jsx)("button",{onClick:e=>{y(a.projectId),N({x:e.clientX,y:e.clientY})},className:"jsx-19280ab6560fe750 ml-2 p-1 text-gray-400 hover:text-gray-600",children:(0,s.jsx)(J.Z,{className:"h-4 w-4"})})]})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center",children:g===a.projectId?(0,s.jsx)("input",{type:"number",value:p,onChange:e=>j(e.target.value),onBlur:e7,onKeyDown:e=>"Enter"===e.key&&e7(),autoFocus:!0,className:"jsx-19280ab6560fe750 w-full px-2 py-1 border border-blue-300 rounded text-sm"}):(()=>{let e=eb[a.projectId],t=null==es?void 0:es[a.projectId],r=void 0!==e?e:void 0!==t?t:0;return(0,s.jsx)("div",{onClick:()=>{f(a.projectId),j(r.toString())},className:"jsx-19280ab6560fe750 text-sm cursor-pointer hover:bg-gray-100 p-1 rounded",children:(0,i.xG)(r)})})()})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center",children:c?(0,s.jsx)("input",{type:"number",value:p,onChange:e=>j(e.target.value),onBlur:e1,onKeyDown:e=>"Enter"===e.key&&e1(),autoFocus:!0,className:"jsx-19280ab6560fe750 w-full px-2 py-1 border border-blue-300 rounded text-sm"}):(0,s.jsx)("div",{onClick:()=>{h(a.projectId),j(n.toString())},className:"jsx-19280ab6560fe750 text-sm cursor-pointer hover:bg-gray-100 p-1 rounded",children:(0,i.xG)(n)})})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium",children:(0,i.xG)(l)})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium",children:(0,i.xG)(o)})})]})}})}),(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 flex bg-gray-50 border-t border-gray-200",children:[(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-[264px] bg-gray-50 border-r border-gray-200",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-left text-sm font-medium text-gray-900",children:"Totals"})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900",children:(0,i.xG)(d.reduce((e,t)=>{let r=eb[t.projectId],s=null==es?void 0:es[t.projectId];return e+(void 0!==r?r:void 0!==s?s:0)},0))})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900",children:(0,i.xG)(d.reduce((e,t)=>e+eq(t.projectId),0))})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900",children:(0,i.xG)(d.reduce((e,t)=>e+eW(t),0))})}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 bg-gray-50 border-r border-gray-200",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900",children:(0,i.xG)(d.reduce((e,t)=>e+e$(t.projectId),0))})})]}),(0,s.jsx)("div",{style:{height:"".concat(eH,"px")},className:"jsx-19280ab6560fe750"})]}),(0,s.jsx)("div",{ref:eA,style:{height:"600px",marginLeft:"776px"},className:"jsx-19280ab6560fe750 "+"overflow-x-auto overflow-y-hidden scrollable-outer ".concat(X?"scrolled-horizontal":""),children:(0,s.jsxs)("div",{style:{width:"".concat(128*eG.length,"px"),height:"100%",display:"flex",flexDirection:"column"},className:"jsx-19280ab6560fe750",children:[(0,s.jsx)("div",{ref:eF,className:"jsx-19280ab6560fe750 scrollable-header",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex bg-gray-50 border-b border-gray-200 sticky-header header-flex",children:eG.map(e=>(0,s.jsx)("div",{onClick:()=>te(e),title:"Click to sort by ".concat((0,i.bh)(e)," projections"),className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 flex items-center justify-center px-4 py-3 border-r border-gray-200 h-18 bg-gray-50 cursor-pointer hover:bg-gray-100 transition-colors group",children:(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 flex flex-col items-center group-hover:text-gray-700",children:[(0,s.jsx)("span",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-500 uppercase tracking-wider leading-none whitespace-nowrap group-hover:text-gray-700",children:(0,i.bh)(e)}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 text-gray-400 mt-0.5 group-hover:text-gray-600",children:tr(e)})]})},e))})}),(0,s.jsx)("div",{ref:eD,style:{overflowY:"auto",overflowX:"hidden"},className:"jsx-19280ab6560fe750 flex-1 body-wrapper",children:(0,s.jsx)(Z.t7,{height:eL,itemCount:to.length,itemSize:72,width:128*eG.length,outerRef:eO,overscanCount:5,children:e=>{let{index:t,style:r}=e,a=to[t];return a?(0,s.jsx)("div",{style:r,className:"jsx-19280ab6560fe750 flex border-b border-gray-200",children:eG.map(e=>{let t=eK(a.projectId,e),r=(null==u?void 0:u.projectId)===a.projectId&&(null==u?void 0:u.month)===e;return(0,s.jsxs)("div",{onClick:()=>e6(a.projectId,e,t),title:e0(a.projectId,e),className:"jsx-19280ab6560fe750 "+"flex-shrink-0 w-32 h-18 px-4 py-2 text-center text-sm border-r border-gray-200 cursor-pointer relative ".concat(e5(eQ(a.projectId,e))||"bg-white"),children:[r?(0,s.jsx)("input",{type:"number",value:p,onChange:e=>j(e.target.value),onBlur:e2,onKeyDown:e=>"Enter"===e.key&&e2(),autoFocus:!0,className:"jsx-19280ab6560fe750 w-full px-2 py-1 border border-blue-300 rounded text-sm"}):(0,i.xG)(t),(0,s.jsx)("button",{onClick:t=>{t.stopPropagation(),S({projectId:a.projectId,month:e}),k({x:t.clientX,y:t.clientY})},className:"jsx-19280ab6560fe750 absolute top-1 right-1 text-gray-400 hover:text-gray-600 text-xs",children:"â‹¯"})]},e)})}):null}})}),(0,s.jsx)("div",{ref:eT,className:"jsx-19280ab6560fe750 scrollable-footer",children:(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex bg-gray-50 border-t border-gray-200 footer-flex",children:eG.map((e,t)=>{let r=eG.map(e=>d.reduce((t,r)=>t+eK(r.projectId,e),0));return(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 flex-shrink-0 w-32 h-18 px-4 py-2 text-center text-sm font-medium text-gray-900 border-r border-gray-200 bg-gray-50",children:(0,i.xG)(r[t])},e)})})})]})})]}),b&&v&&(0,s.jsxs)("div",{"data-dropdown":"true",style:{left:"".concat(v.x,"px"),top:"".concat(v.y,"px"),pointerEvents:"auto"},className:"jsx-19280ab6560fe750 fixed bg-white border border-gray-200 rounded-md shadow-lg z-[9999] min-w-max",children:[(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 px-3 py-2 border-b border-gray-200",children:[(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-500 mb-2",children:"Assign Project Manager"}),ep&&0!==Object.keys(ep).length||0!==V.length?(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 space-y-1",children:[Object.values(ep||{}).map(e=>(0,s.jsxs)("button",{onClick:async()=>{try{await fetch("/api/project-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:b,managerId:e.id})}),ef(),y(null)}catch(e){console.error("Error assigning project manager:",e),M.ZP.error("Failed to assign project manager")}},className:"jsx-19280ab6560fe750 w-full flex items-center space-x-2 px-2 py-1 text-sm text-gray-700 hover:bg-gray-50 rounded",children:[(0,s.jsx)("div",{style:{backgroundColor:e.color},className:"jsx-19280ab6560fe750 w-3 h-3 rounded-full"}),(0,s.jsx)("span",{className:"jsx-19280ab6560fe750",children:e.name})]},e.id)),V.map(e=>(0,s.jsxs)("button",{onClick:()=>{let t={...Y,[b]:e.id};G(t),localStorage.setItem("projectAssignments",JSON.stringify(t)),y(null)},className:"jsx-19280ab6560fe750 w-full flex items-center space-x-2 px-2 py-1 text-sm text-gray-700 hover:bg-gray-50 rounded",children:[(0,s.jsx)("div",{style:{backgroundColor:e.color},className:"jsx-19280ab6560fe750 w-3 h-3 rounded-full"}),(0,s.jsx)("span",{className:"jsx-19280ab6560fe750",children:e.name})]},e.id))]}):(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 text-xs text-gray-400 italic",children:"No project managers available"})]}),((null==eg?void 0:eg[b])||Y[b])&&(0,s.jsxs)("button",{onClick:async()=>{try{await fetch("/api/project-assignments",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:b})}),ef(),y(null)}catch(e){console.error("Error removing project manager:",e),M.ZP.error("Failed to remove project manager")}},className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm text-orange-600 hover:bg-orange-50 flex items-center",children:[(0,s.jsx)(J.Z,{className:"h-4 w-4 mr-2"}),"Remove Manager"]}),(0,s.jsxs)("button",{onClick:()=>e8(b),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm text-red-600 hover:bg-red-50 flex items-center",children:[(0,s.jsx)(B.Z,{className:"h-4 w-4 mr-2"}),"Close Project"]})]}),w&&C&&(0,s.jsxs)("div",{"data-dropdown":"true",style:{left:"".concat(C.x,"px"),top:"".concat(C.y,"px"),pointerEvents:"auto"},className:"jsx-19280ab6560fe750 fixed bg-white border border-gray-200 rounded-md shadow-lg z-[9999] min-w-[160px] py-1",children:[(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 px-3 py-1",children:[(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-500 uppercase tracking-wider mb-1",children:"Status"}),(0,s.jsx)("button",{onClick:()=>e4("Confirmed"),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm hover:bg-gray-50",children:"Confirmed"}),(0,s.jsx)("button",{onClick:()=>e4("Estimate"),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm hover:bg-gray-50",children:"Estimate"}),(0,s.jsx)("button",{onClick:()=>e4("Billed"),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm hover:bg-gray-50",children:"Billed"}),(0,s.jsx)("button",{onClick:()=>e4("Other"),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm hover:bg-gray-50",children:"Other"}),(0,s.jsx)("button",{onClick:()=>e4("Clear"),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm hover:bg-gray-50",children:"Clear"})]}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 border-t border-gray-200 my-1"}),(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 px-3 py-1",children:[(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 text-xs font-medium text-gray-500 uppercase tracking-wider mb-1",children:"Comment"}),(0,s.jsx)("button",{onClick:()=>e4(e0(w.projectId,w.month)?"EditComment":"AddComment"),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm hover:bg-gray-50",children:e0(w.projectId,w.month)?"Edit Comment":"Add Comment"}),e0(w.projectId,w.month)&&(0,s.jsx)("button",{onClick:()=>e4("RemoveComment"),className:"jsx-19280ab6560fe750 w-full px-3 py-2 text-left text-sm hover:bg-gray-50",children:"Remove Comment"})]})]}),I&&T&&(0,s.jsxs)("div",{ref:eR,style:{left:"".concat(T.x,"px"),top:"".concat(T.y,"px"),pointerEvents:"auto"},className:"jsx-19280ab6560fe750 fixed bg-white border border-gray-200 rounded-md shadow-lg z-[9999] min-w-[300px] max-w-md comment-modal",children:[(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 px-4 py-3 border-b border-gray-200 flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"jsx-19280ab6560fe750 text-lg font-medium text-gray-900",children:"Edit Comment"}),(0,s.jsx)("button",{onClick:()=>{P(null),O(""),A(null)},className:"jsx-19280ab6560fe750 text-gray-400 hover:text-gray-600",children:(0,s.jsx)(B.Z,{className:"h-5 w-5"})})]}),(0,s.jsx)("div",{className:"jsx-19280ab6560fe750 p-4",children:(0,s.jsx)("textarea",{value:E,onChange:e=>O(e.target.value),rows:4,autoFocus:!0,className:"jsx-19280ab6560fe750 w-full px-2 py-1 border border-gray-300 rounded text-sm"})}),(0,s.jsxs)("div",{className:"jsx-19280ab6560fe750 px-4 py-3 border-t border-gray-200 flex justify-end",children:[(0,s.jsx)("button",{onClick:async()=>{let{projectId:e,month:t}=I,r=E.trim();try{r?await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,month:t,comment:r})}):await fetch("/api/comments",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,month:t})}),em(),P(null),O(""),A(null)}catch(e){console.error("Error saving comment:",e),M.ZP.error("Failed to save comment")}},className:"jsx-19280ab6560fe750 px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 rounded-md",children:"Save Comment"}),(0,s.jsx)("button",{onClick:()=>{P(null),O(""),A(null)},className:"jsx-19280ab6560fe750 ml-2 px-4 py-2 text-sm text-gray-600 hover:bg-gray-100 rounded-md",children:"Cancel"})]})]}),(0,s.jsx)(D(),{id:"19280ab6560fe750",children:".table-container.jsx-19280ab6560fe750{position:relative;overflow:hidden}.sticky-header.jsx-19280ab6560fe750{position:-webkit-sticky;position:sticky;top:0;z-index:40;background:inherit;overflow:hidden}.sticky-column.jsx-19280ab6560fe750{position:-webkit-sticky;position:sticky;left:0;z-index:30;background:white;overflow:hidden}.scrolled-horizontal.jsx-19280ab6560fe750{-webkit-box-shadow:inset -10px 0 8px -8px rgba(0,0,0,.1);-moz-box-shadow:inset -10px 0 8px -8px rgba(0,0,0,.1);box-shadow:inset -10px 0 8px -8px rgba(0,0,0,.1)}.hide-scrollbar.jsx-19280ab6560fe750::-webkit-scrollbar{display:none}.hide-scrollbar.jsx-19280ab6560fe750{-ms-overflow-style:none;scrollbar-width:none}.hide-horizontal-scrollbar.jsx-19280ab6560fe750{overflow-x:hidden!important}.body-wrapper.jsx-19280ab6560fe750{scrollbar-gutter:stable}.scrollable-header.jsx-19280ab6560fe750,.scrollable-footer.jsx-19280ab6560fe750{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.header-flex.jsx-19280ab6560fe750,.footer-flex.jsx-19280ab6560fe750{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.scrollable-outer.jsx-19280ab6560fe750{scrollbar-gutter:stable}"})]})}function W(){let{user:e,loading:t}=(0,l.a)(),{isMigrating:r,isMigrated:d,hasLocalData:u,migrateData:m}=(0,n.c)(),x=(0,o.useRouter)(),[h,g]=(0,a.useState)([]),[f,j]=(0,a.useState)([]),[b,y]=(0,a.useState)([]),[v,w]=(0,a.useState)(!1),[S,C]=(0,a.useState)(null),[k,I]=(0,a.useState)({}),[P,E]=(0,a.useState)(null),[O,F]=(0,a.useState)(new Set);(0,a.useEffect)(()=>{if(!t&&!e){x.push("/login");return}if(!t&&e&&!e.isBasic){x.push("/unauthorized");return}},[e,t,x]),(0,a.useEffect)(()=>{!u||d||r||(console.log("Dashboard: Found localStorage data, starting migration"),m())},[u,d,r,m]),(0,a.useEffect)(()=>{console.log("Dashboard: useEffect triggered - user:",!!e,"isBasic:",null==e?void 0:e.isBasic,"loading:",t),e&&e.isBasic?(console.log("Dashboard: User authenticated and authorized, fetching data"),A()):console.log("Dashboard: User not authenticated or not authorized:",{user:!!e,isBasic:null==e?void 0:e.isBasic,loading:t})},[e]),(0,a.useEffect)(()=>{let e=()=>{E(c.VC.getAutoRefreshStatus())};e();let t=setInterval(e,1e3);return()=>clearInterval(t)},[]),(0,a.useEffect)(()=>{if(h.length>0||f.length>0){console.log("Dashboard: Processing data - projects:",h.length,"invoices:",f.length),console.log("Dashboard: User state:",{user:!!e,isBasic:null==e?void 0:e.isBasic,loading:t});let r=(0,i.K0)(h);I(r);let s=(0,i.ab)(h,f,r);console.log("Dashboard: Processed billing data:",s.length),console.log("Dashboard: First processed item:",s[0]),console.log("Dashboard: Projections initialized:",Object.keys(r).length),y(s)}else console.log("Dashboard: No projects or invoices to process"),console.log("Dashboard: Projects length:",h.length),console.log("Dashboard: Invoices length:",f.length)},[h,f,e,t]);let A=async()=>{console.log("Dashboard: Starting fetchData"),console.log("Dashboard: User state during fetch:",{user:!!e,isBasic:null==e?void 0:e.isBasic,loading:t}),w(!0);try{let[e,t]=await Promise.all([(0,c.bl)(),(0,c.WM)()]);console.log("Dashboard: API responses - projects:",null==e?void 0:e.length,"invoices:",null==t?void 0:t.length),g(e||[]),j(t||[]),C({fromCache:!1,changes:null})}catch(e){console.error("Error fetching data:",e),g([]),j([])}finally{w(!1)}};return r?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Migrating data to database..."}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"This may take a few moments"})]})}):t?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Checking authentication..."})]})}):e&&e.isBasic?v?(0,s.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,s.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading data..."})]})}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,s.jsx)(p,{onRefresh:()=>{A()},onForceRefresh:()=>{A()},cacheInfo:S,autoRefreshStatus:P}),(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsx)(N,{billingData:b,closedProjects:O}),(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Billing Overview"}),(0,s.jsx)(T,{billingData:b,closedProjects:O})]})}),(0,s.jsx)("div",{className:"mt-8",children:(0,s.jsx)(q,{billingData:b,projections:k,onUpdateProjections:e=>{I(e)},closedProjects:O,onClosedProjectsChange:F,useDB:!0})})]})]}):null}},90483:function(e,t,r){"use strict";r.d(t,{AuthProvider:function(){return g},a:function(){return f}});var s=r(57437),a=r(2265),o=r(96244);let l="72ed6933-6bc6-430e-a75a-cb5d2e1c20e1",n="e4748cdc-321b-4db0-bc36-141b121a9117";l&&n||(console.warn("Azure AD environment variables are not set. Authentication will not work."),console.warn("Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file"));let i={auth:{clientId:l||"dummy-client-id",authority:"https://login.microsoftonline.com/".concat(n||"dummy-tenant-id"),redirectUri:window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}},c=new o.Lx(i),d={scopes:["User.Read"]};async function u(){try{if(!l||!n)throw Error("Azure AD environment variables are not configured. Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file");return await c.loginRedirect(d),null}catch(e){throw console.error("Sign in error:",e),e}}async function m(){try{await c.logoutPopup()}catch(e){console.error("Sign out error:",e)}}async function x(){try{let e=c.getActiveAccount();if(!e)return null;return{id:e.localAccountId,name:e.name||"",email:e.username||"",isAdmin:!0,isBasic:!0}}catch(e){return console.error("Get auth user error:",e),null}}let h=(0,a.createContext)(void 0);function g(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[l,n]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{await c.initialize();let e=await c.handleRedirectPromise();e&&(console.log("Redirect response received:",e),c.setActiveAccount(e.account));let t=await x();o(t)}catch(e){console.error("Auth initialization error:",e)}finally{n(!1)}})()},[]);let i=async()=>{try{n(!0),await u()}catch(e){console.error("Sign in error:",e),n(!1)}},d=async()=>{try{n(!0),await m(),o(null)}catch(e){console.error("Sign out error:",e)}finally{n(!1)}};return(0,s.jsx)(h.Provider,{value:{user:r,loading:l,signIn:i,signOut:d},children:t})}function f(){let e=(0,a.useContext)(h);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},58091:function(e,t,r){"use strict";r.d(t,{MigrationProvider:function(){return n},c:function(){return i}});var s=r(57437),a=r(2265),o=r(69064);let l=(0,a.createContext)(void 0);function n(e){let{children:t}=e,[r,n]=(0,a.useState)(!1),[i,c]=(0,a.useState)(!1),[d,u]=(0,a.useState)(!1);(0,a.useEffect)(()=>{(()=>{try{let e=localStorage.getItem("dataMigrated");if("true"===e){c(!0),u(!1);return}let t=localStorage.getItem("monthlyProjections")||localStorage.getItem("signedFees")||localStorage.getItem("asrFees")||localStorage.getItem("monthlyStatuses")||localStorage.getItem("monthlyComments")||localStorage.getItem("closedProjects")||localStorage.getItem("projectAssignments")||localStorage.getItem("projectManagers");u(!!t)}catch(e){console.error("Error checking migration status:",e)}})()},[]);let m=async()=>{if(!r&&!i){n(!0);try{console.log("Starting client-side migration...");let e=JSON.parse(localStorage.getItem("monthlyProjections")||"{}"),t=JSON.parse(localStorage.getItem("monthlyStatuses")||"{}"),r=JSON.parse(localStorage.getItem("monthlyComments")||"{}"),s=JSON.parse(localStorage.getItem("signedFees")||"{}"),a=JSON.parse(localStorage.getItem("asrFees")||"{}"),l=JSON.parse(localStorage.getItem("closedProjects")||"[]"),n=JSON.parse(localStorage.getItem("projectAssignments")||"{}"),i=JSON.parse(localStorage.getItem("projectManagers")||"[]"),d=[];if(Object.keys(e).length>0)for(let[t,r]of Object.entries(e))for(let[e,s]of Object.entries(r))d.push(fetch("/api/projections",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:t,month:e,value:s})}));if(Object.keys(t).length>0)for(let[e,r]of Object.entries(t))for(let[t,s]of Object.entries(r))d.push(fetch("/api/statuses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,month:t,status:s})}));if(Object.keys(r).length>0)for(let[e,t]of Object.entries(r))for(let[r,s]of Object.entries(t))d.push(fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,month:r,comment:s})}));if(Object.keys(s).length>0)for(let[e,t]of Object.entries(s))d.push(fetch("/api/signed-fees",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,value:t})}));if(Object.keys(a).length>0)for(let[e,t]of Object.entries(a))d.push(fetch("/api/asr-fees",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,value:t})}));if(l.length>0)for(let e of l)d.push(fetch("/api/closed-projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})}));if(Object.keys(n).length>0)for(let[e,t]of Object.entries(n))d.push(fetch("/api/project-assignments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,managerId:t})}));if(i.length>0)for(let e of i)d.push(fetch("/api/project-managers",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}));if(d.length>0){let e=(await Promise.allSettled(d)).filter(e=>"rejected"===e.status);if(e.length>0)throw console.error("Some migrations failed:",e),e.some(e=>{var t,r,s,a,o,l;return"rejected"===e.status&&((null===(r=e.reason)||void 0===r?void 0:null===(t=r.message)||void 0===t?void 0:t.includes("Failed to fetch"))||(null===(a=e.reason)||void 0===a?void 0:null===(s=a.message)||void 0===s?void 0:s.includes("connection"))||(null===(l=e.reason)||void 0===l?void 0:null===(o=l.message)||void 0===o?void 0:o.includes("timeout")))})?o.ZP.error("Migration failed: Check database connections"):o.ZP.error("Migration failed: Some data could not be migrated"),Error("Migration failed");console.log("Migration completed successfully"),o.ZP.success("Data migrated to database successfully")}localStorage.removeItem("monthlyProjections"),localStorage.removeItem("monthlyStatuses"),localStorage.removeItem("monthlyComments"),localStorage.removeItem("signedFees"),localStorage.removeItem("asrFees"),localStorage.removeItem("closedProjects"),localStorage.removeItem("projectAssignments"),localStorage.removeItem("projectManagers"),localStorage.setItem("dataMigrated","true"),c(!0),u(!1)}catch(e){console.error("Migration failed:",e),o.ZP.error("Failed to migrate data to database")}finally{n(!1)}}};return(0,s.jsx)(l.Provider,{value:{isMigrating:r,isMigrated:i,hasLocalData:d,migrateData:m},children:t})}function i(){let e=(0,a.useContext)(l);if(void 0===e)throw Error("useMigration must be used within a MigrationProvider");return e}}},function(e){e.O(0,[64,244,648,755,86,483,837,971,117,744],function(){return e(e.s=78929)}),_N_E=e.O()}]);