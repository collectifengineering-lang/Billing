(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{48721:function(e,s,t){Promise.resolve().then(t.bind(t,77103))},77103:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return O}});var r=t(57437),a=t(2265),l=t(27648),i=t(70525),n=t(3085),c=t(21047),d=t(32660),o=t(46221),x=t(95252),m=t(48664),u=t(58896),h=t(95805),j=t(98420),f=t(65302),p=t(63639),v=t(45131),g=t(94508);let y=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,g.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...a})});y.displayName="Card";let N=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,g.cn)("flex flex-col space-y-1.5 p-6",t),...a})});N.displayName="CardHeader";let b=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("h3",{ref:s,className:(0,g.cn)("text-2xl font-semibold leading-none tracking-tight",t),...a})});b.displayName="CardTitle";let w=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("p",{ref:s,className:(0,g.cn)("text-sm text-muted-foreground",t),...a})});w.displayName="CardDescription";let A=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,g.cn)("p-6 pt-0",t),...a})});A.displayName="CardContent",a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)("div",{ref:s,className:(0,g.cn)("flex items-center p-6 pt-0",t),...a})}).displayName="CardFooter";var P=t(43105);let C=P.fC,E=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(P.aV,{ref:s,className:(0,g.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",t),...a})});E.displayName=P.aV.displayName;let D=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(P.xz,{ref:s,className:(0,g.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",t),...a})});D.displayName=P.xz.displayName;let _=a.forwardRef((e,s)=>{let{className:t,...a}=e;return(0,r.jsx)(P.VY,{ref:s,className:(0,g.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",t),...a})});_.displayName=P.VY.displayName;let I=(0,t(90535).j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function S(e){let{className:s,variant:t,...a}=e;return(0,r.jsx)("div",{className:(0,g.cn)(I({variant:t}),s),...a})}var R=t(60610);let k=a.forwardRef((e,s)=>{let{className:t,value:a,...l}=e;return(0,r.jsx)(R.fC,{ref:s,className:(0,g.cn)("relative h-4 w-full overflow-hidden rounded-full bg-secondary",t),...l,children:(0,r.jsx)(R.z$,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:"translateX(-".concat(100-(a||0),"%)")}})})});k.displayName=R.fC.displayName;var M=t(17486);function H(){let[e,s]=(0,a.useState)(null),[t,g]=(0,a.useState)(null),[P,I]=(0,a.useState)([]),[R,M]=(0,a.useState)(""),[H,O]=(0,a.useState)(!0),[T,B]=(0,a.useState)(!1);(0,a.useEffect)(()=>{F(),Z()},[]),(0,a.useEffect)(()=>{R?L(R):g(null)},[R]);let F=async()=>{try{O(!0);let e=await fetch("/api/dashboard");if(!e.ok)throw Error("Failed to fetch dashboard data");let t=await e.json();s(t)}catch(e){console.error("Error fetching dashboard data:",e)}finally{O(!1)}},Z=async()=>{try{let e=await fetch("/api/projects");if(!e.ok)throw Error("Failed to fetch projects");let s=await e.json();I(s.data||[])}catch(e){console.error("Error fetching projects:",e)}},L=async e=>{try{B(!0);let s=await fetch("/api/dashboard/project/".concat(e));if(!s.ok)throw Error("Failed to fetch project metrics");let t=await s.json();g(t)}catch(e){console.error("Error fetching project metrics:",e)}finally{B(!1)}},Y=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),U=e=>"".concat((100*e).toFixed(1),"%");return H?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading dashboard..."})]})}):e?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"flex items-center space-x-4",children:(0,r.jsxs)(l.default,{href:"/",className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900",children:[(0,r.jsx)(d.Z,{className:"h-4 w-4 mr-1"}),"Back to Dashboard"]})}),(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mt-2",children:"Financial Dashboard"}),(0,r.jsx)("p",{className:"mt-2 text-gray-600",children:"Comprehensive financial metrics and performance indicators"})]}),(0,r.jsx)("div",{className:"flex space-x-3",children:(0,r.jsxs)(S,{variant:"outline",className:"flex items-center",children:[(0,r.jsx)(o.Z,{className:"h-4 w-4 mr-1"}),"Financial Analytics"]})})]})}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("label",{htmlFor:"project-select",className:"text-sm font-medium text-gray-700",children:"Select Project:"}),(0,r.jsxs)("select",{id:"project-select",value:R,onChange:e=>M(e.target.value),className:"block w-80 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[(0,r.jsx)("option",{value:"",children:"All Projects (Company Overview)"}),P.map(e=>(0,r.jsxs)("option",{value:e.project_id,children:[e.project_name," - ",e.customer_name]},e.project_id))]}),T&&(0,r.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Loading project data..."]})]})}),(0,r.jsxs)(C,{defaultValue:"overview",className:"space-y-6",children:[(0,r.jsxs)(E,{className:"grid w-full grid-cols-5",children:[(0,r.jsx)(D,{value:"overview",children:"Overview"}),(0,r.jsx)(D,{value:"profitability",children:"Profitability"}),(0,r.jsx)(D,{value:"cashflow",children:"Cashflow"}),(0,r.jsx)(D,{value:"forecasting",children:"Forecasting"}),R&&(0,r.jsx)(D,{value:"project",children:"Project Details"})]}),(0,r.jsxs)(_,{value:"overview",className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(b,{className:"text-sm font-medium",children:"YTD Profit"}),(0,r.jsx)(x.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(A,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:Y(e.ytdProfit)}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["vs ",Y(e.lastYearYtdProfit)," last year"]})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(b,{className:"text-sm font-medium",children:"Gross Margin"}),(0,r.jsx)(m.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(A,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:U(e.currentYearGrossMargin)}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["vs ",U(e.lastYearGrossMargin)," last year"]})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(b,{className:"text-sm font-medium",children:"Utilization Rate"}),(0,r.jsx)(u.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(A,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:U(e.utilizationRate)}),(0,r.jsx)(k,{value:100*e.utilizationRate,className:"mt-2"})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(b,{className:"text-sm font-medium",children:"Active Projects"}),(0,r.jsx)(h.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(A,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:e.totalActiveProjects}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[e.totalEmployees," employees"]})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Multipliers"}),(0,r.jsx)(w,{children:"Project multipliers by year"})]}),(0,r.jsxs)(A,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Current Year"}),(0,r.jsxs)(S,{variant:"default",children:[e.currentYearMultiplier.toFixed(1),"x"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Last Year"}),(0,r.jsxs)(S,{variant:"secondary",children:[e.lastYearMultiplier.toFixed(1),"x"]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Two Years Ago"}),(0,r.jsxs)(S,{variant:"outline",children:[e.twoYearsAgoMultiplier.toFixed(1),"x"]})]})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Overhead Rates"}),(0,r.jsx)(w,{children:"Overhead rates by year"})]}),(0,r.jsxs)(A,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Current Year"}),(0,r.jsx)(S,{variant:"default",children:U(e.currentYearOverhead)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Last Year"}),(0,r.jsx)(S,{variant:"secondary",children:U(e.lastYearOverhead)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Two Years Ago"}),(0,r.jsx)(S,{variant:"outline",children:U(e.twoYearsAgoOverhead)})]})]})]})]})]}),(0,r.jsx)(_,{value:"profitability",className:"space-y-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Profit Metrics"}),(0,r.jsx)(w,{children:"Year-to-date profitability analysis"})]}),(0,r.jsxs)(A,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"YTD Operating Income"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(e.ytdOperatingIncome)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Last Year YTD Operating Income"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(e.lastYearYtdOperatingIncome)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Revenue per Employee"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(e.currentYearRevenuePerEmployee)})]})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Client Retention"}),(0,r.jsx)(w,{children:"Client retention and project metrics"})]}),(0,r.jsxs)(A,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Client Retention Rate"}),(0,r.jsx)(S,{variant:"default",children:U(e.clientRetentionRate)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Average Project Size"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(e.averageProjectSize)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Average Billing Rate"}),(0,r.jsxs)("span",{className:"font-semibold",children:[Y(e.averageBillingRate),"/hr"]})]})]})]})]})}),(0,r.jsx)(_,{value:"cashflow",className:"space-y-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Cashflow Overview"}),(0,r.jsx)(w,{children:"Current cashflow status"})]}),(0,r.jsxs)(A,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Current Cashflow"}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"font-semibold",children:Y(e.currentCashflow)}),(e=>{switch(e){case"up":return(0,r.jsx)(i.Z,{className:"h-4 w-4 text-green-600"});case"down":return(0,r.jsx)(n.Z,{className:"h-4 w-4 text-red-600"});default:return(0,r.jsx)(c.Z,{className:"h-4 w-4 text-gray-600"})}})(e.cashflowTrend)]})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Previous Month"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(e.previousMonthCashflow)})]})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Invoice Status"}),(0,r.jsx)(w,{children:"Outstanding invoices and payment metrics"})]}),(0,r.jsxs)(A,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Overdue Invoices"}),(0,r.jsx)("span",{className:"font-semibold text-red-600",children:Y(e.overdueInvoiceValue)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Total Outstanding"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(e.totalOutstandingInvoices)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{children:"Avg Days to Payment"}),(0,r.jsxs)("span",{className:"font-semibold",children:[e.averageDaysToPayment," days"]})]})]})]})]})}),(0,r.jsx)(_,{value:"forecasting",className:"space-y-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Trailing 12 Months"}),(0,r.jsx)(w,{children:"Revenue and profit trends"})]}),(0,r.jsx)(A,{children:(0,r.jsx)("div",{className:"space-y-2",children:e.trailing12Months.slice(-6).map((e,s)=>(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,r.jsx)("span",{children:e.month}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("span",{children:Y(e.revenue)}),(0,r.jsx)(S,{variant:e.profitMargin>.2?"default":"secondary",children:U(e.profitMargin)})]})]},s))})})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"6-Month Forecast"}),(0,r.jsx)(w,{children:"Projected revenue and expenses"})]}),(0,r.jsx)(A,{children:(0,r.jsx)("div",{className:"space-y-2",children:e.forecast.map((e,s)=>(0,r.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,r.jsx)("span",{children:e.month}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,r.jsx)("span",{children:Y(e.projectedRevenue)}),(0,r.jsx)(S,{variant:"outline",children:Y(e.projectedProfit)})]})]},s))})})]})]})}),R&&t&&(0,r.jsxs)(_,{value:"project",className:"space-y-6",children:[(0,r.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:t.projectName}),(0,r.jsx)("p",{className:"text-gray-600",children:t.customerName}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,r.jsx)(S,{variant:"active"===t.status?"default":"secondary",children:t.status}),(0,r.jsxs)("span",{className:"text-sm text-gray-500",children:[new Date(t.startDate).toLocaleDateString(),t.endDate&&" - ".concat(new Date(t.endDate).toLocaleDateString())]})]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:Y(t.totalBudget)}),(0,r.jsx)("div",{className:"text-sm text-gray-500",children:"Total Budget"})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(b,{className:"text-sm font-medium",children:"Current Multiplier"}),(0,r.jsx)(j.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(A,{children:[(0,r.jsxs)("div",{className:"text-2xl font-bold",children:[t.currentMultiplier.toFixed(1),"x"]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:["improving"===t.profitabilityTrend&&"↗ Improving","declining"===t.profitabilityTrend&&"↘ Declining","stable"===t.profitabilityTrend&&"→ Stable"]})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(b,{className:"text-sm font-medium",children:"Efficiency"}),(0,r.jsx)(u.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(A,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:U(t.efficiency)}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[t.billableHours,"h billable / ",t.totalHours,"h total"]})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(b,{className:"text-sm font-medium",children:"Budget Utilization"}),(0,r.jsx)(m.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,r.jsxs)(A,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:U(t.budgetUtilization/100)}),(0,r.jsx)(k,{value:t.budgetUtilization,className:"mt-2"})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,r.jsx)(b,{className:"text-sm font-medium",children:"Risk Level"}),"low"===t.riskLevel&&(0,r.jsx)(f.Z,{className:"h-4 w-4 text-green-600"}),"medium"===t.riskLevel&&(0,r.jsx)(p.Z,{className:"h-4 w-4 text-yellow-600"}),"high"===t.riskLevel&&(0,r.jsx)(v.Z,{className:"h-4 w-4 text-red-600"})]}),(0,r.jsxs)(A,{children:[(0,r.jsx)("div",{className:"text-2xl font-bold capitalize",children:t.riskLevel}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground",children:[t.schedulePerformance,"% schedule performance"]})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Financial Summary"}),(0,r.jsx)(w,{children:"Cash vs Accrual basis"})]}),(0,r.jsxs)(A,{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Cash Basis"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Total Collected"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(t.cashBasis.totalCollected)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Outstanding"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(t.cashBasis.outstandingReceivables)})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Accrual Basis"}),(0,r.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Total Earned"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(t.accrualBasis.totalEarned)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Work in Progress"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(t.accrualBasis.workInProgress)})]})]})]})]}),(0,r.jsxs)("div",{className:"pt-4 border-t",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"font-semibold",children:"Gross Profit"}),(0,r.jsx)("span",{className:"text-lg font-bold text-green-600",children:Y(t.grossProfit)})]}),(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("span",{className:"text-sm text-gray-600",children:"Profit Margin"}),(0,r.jsx)("span",{className:"text-sm font-semibold",children:U(t.profitMargin)})]})]})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Employee Analysis"}),(0,r.jsx)(w,{children:"Hours and efficiency by employee"})]}),(0,r.jsx)(A,{children:(0,r.jsx)("div",{className:"space-y-3",children:t.employeeBreakdown.map((e,s)=>(0,r.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"font-semibold text-sm",children:e.employeeName}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[e.billableHours,"h billable / ",e.totalHours,"h total"]})]}),(0,r.jsxs)("div",{className:"text-right",children:[(0,r.jsx)("div",{className:"font-semibold",children:Y(e.billableValue)}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:[U(e.efficiency)," efficient"]})]})]},s))})})]})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Project Phases"}),(0,r.jsx)(w,{children:"Architectural/Engineering phase breakdown"})]}),(0,r.jsx)(A,{children:(0,r.jsx)("div",{className:"space-y-4",children:t.phases.map((e,s)=>(0,r.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,r.jsx)("h4",{className:"font-semibold",children:e.phaseName}),(0,r.jsxs)(S,{variant:100===e.completion?"default":"secondary",children:[e.completion,"% Complete"]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Budget:"}),(0,r.jsx)("div",{className:"font-semibold",children:Y(e.budget)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Actual Cost:"}),(0,r.jsx)("div",{className:"font-semibold",children:Y(e.actualCost)})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Hours:"}),(0,r.jsxs)("div",{className:"font-semibold",children:[e.hours,"h"]})]})]}),(0,r.jsx)(k,{value:e.completion,className:"mt-2"})]},s))})})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Change Orders"}),(0,r.jsx)(w,{children:"Additional scope and value"})]}),(0,r.jsx)(A,{children:(0,r.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:t.changeOrders.count}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Total Changes"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold",children:Y(t.changeOrders.totalValue)}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Total Value"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-green-600",children:Y(t.changeOrders.approvedValue)}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Approved"})]}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:Y(t.changeOrders.pendingValue)}),(0,r.jsx)("div",{className:"text-sm text-gray-600",children:"Pending"})]})]})})]}),(0,r.jsxs)(y,{children:[(0,r.jsxs)(N,{children:[(0,r.jsx)(b,{children:"Project Forecasting"}),(0,r.jsx)(w,{children:"Projected completion and final metrics"})]}),(0,r.jsx)(A,{children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold mb-3",children:"Projected Completion"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Target Date:"}),(0,r.jsx)("span",{className:"font-semibold",children:new Date(t.projectedCompletion).toLocaleDateString()})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Projected Final Cost:"}),(0,r.jsx)("span",{className:"font-semibold",children:Y(t.projectedFinalCost)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Projected Profit:"}),(0,r.jsx)("span",{className:"font-semibold text-green-600",children:Y(t.projectedProfit)})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{children:"Projected Margin:"}),(0,r.jsx)("span",{className:"font-semibold",children:U(t.projectedMargin)})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h4",{className:"font-semibold mb-3",children:"Historical Multipliers"}),(0,r.jsx)("div",{className:"space-y-2",children:t.historicalMultipliers.map((e,s)=>(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("div",{className:"font-semibold",children:[e.multiplier.toFixed(1),"x"]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:e.notes})]}),(0,r.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.date).toLocaleDateString()})]},s))})]})]})})]})]})]})]})}):(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Financial Dashboard"}),(0,r.jsx)("p",{className:"text-gray-600",children:"Failed to load dashboard data"})]})})}function O(){return(0,r.jsx)(M.Z,{children:(0,r.jsx)(H,{})})}},17486:function(e,s,t){"use strict";t.d(s,{Z:function(){return n}});var r=t(57437),a=t(90483),l=t(99376),i=t(2265);function n(e){let{children:s}=e,{user:t,loading:n}=(0,a.a)(),c=(0,l.useRouter)();return((0,i.useEffect)(()=>{n||t&&t.isAdmin||c.push("/unauthorized")},[t,n,c]),n)?(0,r.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900"}),(0,r.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):t&&t.isAdmin?(0,r.jsx)(r.Fragment,{children:s}):null}},90483:function(e,s,t){"use strict";t.d(s,{AuthProvider:function(){return f},a:function(){return p}});var r=t(57437),a=t(2265),l=t(96244),i=t(40257);let n="72ed6933-6bc6-430e-a75a-cb5d2e1c20e1",c="e4748cdc-321b-4db0-bc36-141b121a9117";n&&c||(console.warn("Azure AD environment variables are not set. Authentication will not work."),console.warn("Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file"));let d={auth:{clientId:n||"dummy-client-id",authority:"https://login.microsoftonline.com/".concat(c||"dummy-tenant-id"),redirectUri:window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}},o=new l.Lx(d),x={scopes:["User.Read","Directory.Read.All"]};async function m(){try{if(!n||!c)throw Error("Azure AD environment variables are not configured. Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file");return await o.loginRedirect(x),null}catch(e){throw console.error("Sign in error:",e),e}}async function u(){try{await o.logoutPopup()}catch(e){console.error("Sign out error:",e)}}async function h(){try{var e,s,t,r,a;let l=o.getActiveAccount();if(!l)return null;let n=await o.acquireTokenSilent({scopes:["User.Read","Directory.Read.All"]}),c=await fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(n.accessToken)}});if(!c.ok)throw Error("Failed to fetch user details");let d=await c.json(),x=(null===(e=i.env.NEXT_PUBLIC_ADMIN_EMAILS)||void 0===e?void 0:e.split(","))||[],m=x.includes(d.mail)||x.includes(d.userPrincipalName)||(null===(s=d.mail)||void 0===s?void 0:s.endsWith("@collectif.nyc"))||(null===(t=d.mail)||void 0===t?void 0:t.endsWith("@yourcompany.com"));return console.log("Auth Debug:",{userEmail:d.mail,userPrincipalName:d.userPrincipalName,adminEmails:x,isAdmin:m,adminEmailsIncludes:x.includes(d.mail),adminEmailsIncludesPrincipal:x.includes(d.userPrincipalName),endsWithCollectif:null===(r=d.mail)||void 0===r?void 0:r.endsWith("@collectif.nyc"),endsWithLegacy:null===(a=d.mail)||void 0===a?void 0:a.endsWith("@yourcompany.com"),envVar:i.env.NEXT_PUBLIC_ADMIN_EMAILS}),{id:l.localAccountId,name:l.name||"",email:l.username||"",isAdmin:m,isBasic:!0}}catch(s){console.error("Get auth user error:",s);let e=o.getActiveAccount();return console.log("Auth Fallback Debug:",{accountEmail:null==e?void 0:e.username,accountName:null==e?void 0:e.name,isAdmin:!1}),{id:(null==e?void 0:e.localAccountId)||"",name:(null==e?void 0:e.name)||"",email:(null==e?void 0:e.username)||"",isAdmin:!1,isBasic:!0}}}let j=(0,a.createContext)(void 0);function f(e){let{children:s}=e,[t,l]=(0,a.useState)(null),[i,n]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{await o.initialize();let e=await o.handleRedirectPromise();e&&(console.log("Redirect response received:",e),o.setActiveAccount(e.account));let s=await h();l(s)}catch(e){console.error("Auth initialization error:",e)}finally{n(!1)}})()},[]);let c=async()=>{try{n(!0),await m()}catch(e){console.error("Sign in error:",e),n(!1)}},d=async()=>{try{n(!0),await u(),l(null)}catch(e){console.error("Sign out error:",e)}finally{n(!1)}};return(0,r.jsx)(j.Provider,{value:{user:t,loading:i,signIn:c,signOut:d},children:s})}function p(){let e=(0,a.useContext)(j);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},94508:function(e,s,t){"use strict";t.d(s,{K0:function(){return N},UF:function(){return u},_2:function(){return g},ab:function(){return h},az:function(){return y},bh:function(){return p},bx:function(){return w},cn:function(){return o},fc:function(){return j},ji:function(){return m},sJ:function(){return b},sP:function(){return A},xG:function(){return f}});var r=t(31559),a=t(13657),l=t(61069),i=t(55463),n=t(14613),c=t(61994),d=t(53335);function o(){for(var e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return(0,d.m6)((0,c.W)(s))}function x(e,s){let t=[],n=(0,r.Z)(e),c=(0,a.Z)(s);for(;n<=c;)t.push((0,l.Z)(n,"yyyy-MM")),n=(0,i.Z)(n,1);return t}function m(){let e=new Date(2022,0,1),s=new Date;return x(e,(0,i.Z)(s,24))}function u(){let e=new Date;return x((0,n.Z)(e,12),(0,i.Z)(e,12))}function h(e,s,t){let r=s||[],a=t||{},i=m();return(e||[]).map(e=>{let s=r.filter(s=>s.project_id===e.project_id),t=i.map(t=>{var r,i,n;let c=s.filter(e=>(0,l.Z)(new Date(e.date),"yyyy-MM")===t),d=c.reduce((e,s)=>e+s.billed_amount,0),o=c.reduce((e,s)=>e+s.unbilled_amount,0),x=(null===(n=a[e.project_id])||void 0===n?void 0:null===(i=n.months)||void 0===i?void 0:null===(r=i[t])||void 0===r?void 0:r.value)||0;return{month:t,billed:d,unbilled:o,projected:x,actual:d+o}}),n=t.reduce((e,s)=>e+s.billed,0),c=t.reduce((e,s)=>e+s.unbilled,0),d=t.reduce((e,s)=>e+s.projected,0);return{projectId:e.project_id,projectName:e.project_name,customerName:e.customer_name,signedFee:void 0,monthlyData:t,totalBilled:n,totalUnbilled:c,totalProjected:d}})}function j(e,s,t,r){if(!e||!Array.isArray(e))return{totalProjects:0,totalBilled:0,totalUnbilled:0,totalProjected:0,activeProjects:0,totalHours:0,billableHours:0,nonBillableHours:0,averageHourlyRate:0,totalTimeValue:0,efficiency:0,averageHoursPerProject:0,topPerformingProjects:[]};let a=e.length,l=s?s.size:0,i=t||g("monthlyProjections")||{},n=r||g("monthlyStatuses")||{},c=new Date().getFullYear().toString(),d=0;Object.keys(i).forEach(e=>{let s=i[e],t=n[e];s&&t&&Object.keys(s).forEach(e=>{e.startsWith(c)&&"Billed"===t[e]&&(d+=s[e]||0)})});let o=new Date().toISOString().slice(0,7),x=0;Object.keys(i).forEach(e=>{let s=i[e],t=n[e];s&&t&&Object.keys(s).forEach(e=>{e>=o&&"Billed"!==t[e]&&(x+=s[e]||0)})});let m=0;Object.keys(i).forEach(e=>{let s=i[e];s&&Object.keys(s).forEach(e=>{e>=o&&(m+=s[e]||0)})});let u=0,h=0,j=0,f=0,p=0,v=[];e.forEach(e=>{if(e.clockifyData){let s=e.clockifyData;if(u+=s.totalHours,h+=s.billableHours,j+=s.nonBillableHours,f+=s.billableAmount,s.totalHours>0){let t=s.billableHours/s.totalHours;v.push({projectId:e.projectId,efficiency:t,hours:s.totalHours}),p++}}});let y=p>0?f/h:0,N=u>0?h/u:0,b=p>0?u/p:0,w=v.sort((e,s)=>s.efficiency*s.hours-e.efficiency*e.hours).slice(0,5).map(e=>e.projectId);return{totalProjects:a,totalBilled:d,totalUnbilled:x,totalProjected:m,activeProjects:a-l,totalHours:u,billableHours:h,nonBillableHours:j,averageHourlyRate:y,totalTimeValue:f,efficiency:N,averageHoursPerProject:b,topPerformingProjects:w}}function f(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}function p(e){let[s,t]=e.split("-"),r=new Date(parseInt(s),parseInt(t)-1);return(0,l.Z)(r,"MMM yyyy")}function v(){try{let e="__localStorage_test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}function g(e){if(!v())return console.warn("localStorage is not available"),null;try{let s=localStorage.getItem(e);return s?JSON.parse(s):null}catch(s){return console.error("Error reading from localStorage key '".concat(e,"':"),s),null}}function y(e,s){if(!v())return console.warn("localStorage is not available"),!1;try{return localStorage.setItem(e,JSON.stringify(s)),!0}catch(s){return console.error("Error writing to localStorage key '".concat(e,"':"),s),!1}}function N(e){let s=m(),t={};return(e||[]).forEach(e=>{t[e.project_id]={months:{},asrFee:0},s.forEach(s=>{let r=s>(0,l.Z)(new Date,"yyyy-MM");t[e.project_id].months[s]={value:0,isEditable:r,isProjected:r}})}),t}function b(e,s){return e.map(e=>{let t=s.find(s=>s.projectId===e.projectId||s.projectName.toLowerCase().includes(e.projectName.toLowerCase()));if(t){let s=function(e){let s=e.totalHours>0?e.billableHours/e.totalHours:0,t=e.billableHours>0?e.billableAmount/e.billableHours:0;return{projectId:e.projectId,projectName:e.projectName,totalHours:e.totalHours,billableHours:e.billableHours,nonBillableHours:e.nonBillableHours,hourlyRate:t,totalValue:e.billableAmount,efficiency:s,period:e.period}}(t);return{...e,clockifyData:t,totalHours:t.totalHours,billableHours:t.billableHours,nonBillableHours:t.nonBillableHours,hourlyRate:s.hourlyRate,efficiency:s.efficiency}}return e})}function w(e){let s=Math.floor(e);return"".concat(s,"h ").concat(Math.round((e-s)*60),"m")}function A(e){return"".concat((100*e).toFixed(1),"%")}}},function(e){e.O(0,[649,648,82,358,971,117,744],function(){return e(e.s=48721)}),_N_E=e.O()}]);