(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{48721:function(e,s,l){Promise.resolve().then(l.bind(l,69963))},69963:function(e,s,l){"use strict";l.r(s),l.d(s,{default:function(){return S}});var t=l(57437),a=l(2265),n=l(27648),r=l(70525),i=l(39763);let c=(0,i.Z)("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]),o=(0,i.Z)("Minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var d=l(32660),x=l(46221),h=l(69076),m=l(45131),u=l(63639),j=l(95252);let f=(0,i.Z)("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);var v=l(58896),p=l(95805),g=l(98420),b=l(65302),y=l(66070),N=l(12339),w=l(35974),k=l(32759),A=l(17486);function P(){var e,s,l,i,A,P,S,C,D,Z,E,O,T,I,U,M,R;let[F,Y]=(0,a.useState)(null),[_,B]=(0,a.useState)(null),[L,z]=(0,a.useState)([]),[H,V]=(0,a.useState)(""),[q,J]=(0,a.useState)(!0),[G,X]=(0,a.useState)(!1),[W,Q]=(0,a.useState)(null),[K,$]=(0,a.useState)(new Set),ee=(0,a.useRef)(""),es=(0,a.useRef)(null),el=async()=>{try{let e=localStorage.getItem("closedProjects");if(e){let s=JSON.parse(e);if(Array.isArray(s)&&s.length>0){for(let e of(console.log("Syncing localStorage closed projects with database..."),s))try{await fetch("/api/closed-projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})})}catch(s){console.error("Failed to sync project ".concat(e,":"),s)}console.log("LocalStorage sync completed")}}}catch(e){console.error("Error syncing localStorage with database:",e)}};(0,a.useEffect)(()=>{(async()=>{try{Q(null),await Promise.all([et(),ea()]),await ec(),await el()}catch(e){console.error("Failed to initialize dashboard:",e),Q("Failed to initialize dashboard. Please refresh the page.")}})()},[]),(0,a.useEffect)(()=>(es.current&&clearTimeout(es.current),console.log("Project selection changed:",H,"Current ref:",ee.current),es.current=setTimeout(()=>{H&&H!==ee.current?(console.log("Fetching project metrics for:",H),ee.current=H,en(H)):H||(console.log("Clearing project metrics"),ee.current="",B(null))},300),()=>{es.current&&clearTimeout(es.current),ee.current=""}),[H]);let et=async()=>{try{console.log("\uD83D\uDD04 Starting dashboard data fetch..."),J(!0),Q(null);let e=new AbortController,s=setTimeout(()=>e.abort(),3e4),l=await fetch("/api/dashboard",{signal:e.signal});if(clearTimeout(s),!l.ok)throw Error("HTTP ".concat(l.status,": ").concat(l.statusText));let t=await l.json();console.log("✅ Dashboard data received:",t),Y(t)}catch(e){console.error("❌ Error fetching dashboard data:",e),"AbortError"===e.name?Q("Dashboard data request timed out. Please try again."):Q("Failed to load dashboard data. Please check your connection and try again.")}finally{console.log("\uD83C\uDFC1 Dashboard data fetch completed, setting loading to false"),J(!1)}},ea=async()=>{try{var e;console.log("\uD83D\uDD04 Starting projects fetch...");let s=await fetch("/api/projects");if(!s.ok)throw Error("HTTP ".concat(s.status,": ").concat(s.statusText));let l=await s.json();console.log("✅ Projects received:",(null===(e=l.data)||void 0===e?void 0:e.length)||0,"projects"),z(l.data||[])}catch(e){console.error("❌ Error fetching projects:",e),Q("Failed to load projects. Please check your connection and try again.")}},en=async e=>{if(console.log("fetchProjectMetrics called with:",e,"Loading:",G,"Current ref:",ee.current),G||_&&_.projectId===e){console.log("Skipping request - already loading or same project");return}if(ee.current!==e){console.log("Skipping request - project ID mismatch");return}try{X(!0),Q(null),console.log("Making API request for project:",e);let s=await fetch("/api/dashboard/project/".concat(e));if(!s.ok){let e=await s.json().catch(()=>({}));throw Error(e.error||"HTTP ".concat(s.status,": ").concat(s.statusText))}let l=await s.json();ee.current===e?(console.log("Setting project metrics for:",e),B(l)):console.log("Project changed, not setting metrics")}catch(s){console.error("Error fetching project metrics:",s),ee.current===e&&(Q("Failed to load project metrics. Please try selecting a different project."),B({projectId:e,projectName:"Unknown Project",customerName:"Unknown Customer",status:"unknown",startDate:new Date().toISOString().split("T")[0],totalBudget:0,totalBilled:0,totalUnbilled:0,totalCollected:0,outstandingAmount:0,profitMargin:0,grossProfit:0,currentMultiplier:0,historicalMultipliers:[],totalHours:0,billableHours:0,nonBillableHours:0,efficiency:0,employeeBreakdown:[],timeEntries:[],cashBasis:{totalCollected:0,outstandingReceivables:0,totalRevenue:0},accrualBasis:{totalEarned:0,totalExpenses:0,netIncome:0,workInProgress:0},budgetUtilization:0,schedulePerformance:0,profitabilityTrend:"stable",riskLevel:"low",changeOrders:{count:0,totalValue:0,approvedValue:0,pendingValue:0},phases:[],projectedCompletion:new Date().toISOString().split("T")[0],projectedFinalCost:0,projectedProfit:0,projectedMargin:0}))}finally{ee.current===e&&(console.log("Setting loading to false for project:",e),X(!1))}},er=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),ei=e=>"".concat((100*e).toFixed(1),"%"),ec=async()=>{try{let e=await fetch("/api/closed-projects");if(e.ok){let s=await e.json();if(Array.isArray(s)){$(new Set(s)),localStorage.setItem("closedProjects",JSON.stringify(s));return}}let s=localStorage.getItem("closedProjects");if(s){let e=JSON.parse(s);$(new Set(e))}}catch(e){console.error("Error loading closed projects:",e);try{let e=localStorage.getItem("closedProjects");if(e){let s=JSON.parse(e);$(new Set(s))}}catch(e){console.error("Error loading from localStorage:",e)}}},eo=async e=>{try{if(!(await fetch("/api/closed-projects",{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})})).ok)throw Error("Failed to remove project from database");let s=new Set(K);s.delete(e),$(s),localStorage.setItem("closedProjects",JSON.stringify(Array.from(s)));let l=new CustomEvent("projectStatusChanged",{detail:{projectId:e,status:"reopened",closedProjects:s}});window.dispatchEvent(l),console.log("Project ".concat(e," reopened"))}catch(s){console.error("Error reopening project:",s);try{let s=new Set(K);s.delete(e),$(s),localStorage.setItem("closedProjects",JSON.stringify(Array.from(s)));let l=new CustomEvent("projectStatusChanged",{detail:{projectId:e,status:"reopened",closedProjects:s}});window.dispatchEvent(l)}catch(e){console.error("Fallback error:",e)}}},ed=async e=>{try{if(!(await fetch("/api/closed-projects",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e})})).ok)throw Error("Failed to add project to database");let s=new Set(K);s.add(e),$(s),localStorage.setItem("closedProjects",JSON.stringify(Array.from(s)));let l=new CustomEvent("projectStatusChanged",{detail:{projectId:e,status:"closed",closedProjects:s}});window.dispatchEvent(l),console.log("Project ".concat(e," closed"))}catch(s){console.error("Error closing project:",s);try{let s=new Set(K);s.add(e),$(s),localStorage.setItem("closedProjects",JSON.stringify(Array.from(s)));let l=new CustomEvent("projectStatusChanged",{detail:{projectId:e,status:"closed",closedProjects:s}});window.dispatchEvent(l)}catch(e){console.error("Fallback error:",e)}}};return W?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-red-900 mb-4",children:"Dashboard Error"}),(0,t.jsx)("p",{className:"text-red-600 mb-4",children:W}),(0,t.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Refresh Page"})]})}):q?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center max-w-md",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Loading Dashboard"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Fetching financial data from Zoho and Clockify..."}),(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4 text-left",children:[(0,t.jsx)("p",{className:"text-sm text-blue-800 mb-2",children:(0,t.jsx)("strong",{children:"What's happening:"})}),(0,t.jsxs)("ul",{className:"text-sm text-blue-700 space-y-1",children:[(0,t.jsx)("li",{children:"• Connecting to Zoho Books API"}),(0,t.jsx)("li",{children:"• Fetching financial metrics (may take 10-20 seconds)"}),(0,t.jsx)("li",{children:"• Loading project data"}),(0,t.jsx)("li",{children:"• Calculating performance indicators"})]}),(0,t.jsx)("p",{className:"text-xs text-blue-600 mt-3",children:"This process includes rate limiting to respect API limits."})]}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 text-sm",children:"Refresh if stuck"})})]})}):F?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsx)("div",{className:"mb-8",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex items-center space-x-4",children:(0,t.jsxs)(n.default,{href:"/",className:"inline-flex items-center text-sm text-gray-600 hover:text-gray-900",children:[(0,t.jsx)(d.Z,{className:"h-4 w-4 mr-1"}),"Back to Home"]})}),(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mt-2",children:"Financial Dashboard"}),(0,t.jsx)("p",{className:"mt-2 text-gray-600",children:"Comprehensive financial metrics and performance indicators"})]}),(0,t.jsx)("div",{className:"flex space-x-3",children:(0,t.jsxs)(w.C,{variant:"outline",className:"flex items-center",children:[(0,t.jsx)(x.Z,{className:"h-4 w-4 mr-1"}),"Financial Analytics"]})})]})}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("label",{htmlFor:"project-select",className:"text-sm font-medium text-gray-700",children:"Select Project:"}),(0,t.jsxs)("select",{id:"project-select",value:H,onChange:e=>{try{let s=e.target.value;console.log("Project selection changed to:",s),s!==H&&V(s)}catch(e){console.error("Error in project selection change:",e),V(""),B(null),ee.current=""}},className:"block w-80 rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 sm:text-sm",children:[(0,t.jsx)("option",{value:"",children:"All Projects (Company Overview)"}),(0,t.jsx)("optgroup",{label:"Active Projects",children:Array.isArray(L)&&L.filter(e=>!K.has((null==e?void 0:e.project_id)||"")).map(e=>(0,t.jsxs)("option",{value:(null==e?void 0:e.project_id)||"",children:[(null==e?void 0:e.project_name)||"Unknown Project"," - ",(null==e?void 0:e.customer_name)||"Unknown Customer"]},(null==e?void 0:e.project_id)||"unknown"))}),Array.isArray(L)&&L.filter(e=>K.has((null==e?void 0:e.project_id)||"")).length>0&&(0,t.jsx)("optgroup",{label:"Closed Projects",children:Array.isArray(L)&&L.filter(e=>K.has((null==e?void 0:e.project_id)||"")).map(e=>(0,t.jsxs)("option",{value:(null==e?void 0:e.project_id)||"",children:[(null==e?void 0:e.project_name)||"Unknown Project"," - ",(null==e?void 0:e.customer_name)||"Unknown Customer"," (Closed)"]},(null==e?void 0:e.project_id)||"unknown"))})]}),G&&(0,t.jsxs)("div",{className:"flex items-center text-sm text-gray-500",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600 mr-2"}),"Loading project data..."]})]}),H&&(0,t.jsxs)("div",{className:"mt-3 flex items-center space-x-3",children:[K.has(H)?(0,t.jsxs)("button",{onClick:()=>eo(H),className:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors duration-200",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4 mr-2"}),"Reopen Project"]}):(0,t.jsxs)("button",{onClick:()=>ed(H),className:"inline-flex items-center px-3 py-2 border border-gray-300 text-sm leading-4 font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors duration-200",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4 mr-2"}),"Close Project"]}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:["Status: ",K.has(H)?"Closed":"Active"]})]})]}),W&&(0,t.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-md",children:(0,t.jsxs)("div",{className:"flex",children:[(0,t.jsx)("div",{className:"flex-shrink-0",children:(0,t.jsx)(u.Z,{className:"h-5 w-5 text-red-400"})}),(0,t.jsxs)("div",{className:"ml-3",children:[(0,t.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Dashboard Error"}),(0,t.jsx)("div",{className:"mt-2 text-sm text-red-700",children:(0,t.jsx)("p",{children:W})}),(0,t.jsx)("div",{className:"mt-4",children:(0,t.jsx)("button",{onClick:()=>{Q(null),window.location.reload()},className:"bg-red-100 text-red-800 px-3 py-2 rounded-md text-sm font-medium hover:bg-red-200",children:"Retry"})})]})]})}),(0,t.jsxs)(N.mQ,{defaultValue:"overview",className:"space-y-6",children:[(0,t.jsxs)(N.dr,{className:"grid w-full grid-cols-6",children:[(0,t.jsx)(N.SP,{value:"overview",children:"Overview"}),(0,t.jsx)(N.SP,{value:"profitability",children:"Profitability"}),(0,t.jsx)(N.SP,{value:"cashflow",children:"Cashflow"}),(0,t.jsx)(N.SP,{value:"forecasting",children:"Forecasting"}),(0,t.jsx)(N.SP,{value:"financial-data",children:"Financial Data"}),H&&(0,t.jsx)(N.SP,{value:"project",children:"Project Details"})]}),(0,t.jsxs)(N.nU,{value:"overview",className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(y.ll,{className:"text-sm font-medium",children:"YTD Profit"}),(0,t.jsx)(j.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(y.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:er((null==F?void 0:F.ytdProfit)||0)}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["vs ",er((null==F?void 0:F.lastYearYtdProfit)||0)," last year"]})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(y.ll,{className:"text-sm font-medium",children:"Gross Margin"}),(0,t.jsx)(f,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(y.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:ei((null==F?void 0:F.currentYearGrossMargin)||0)}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:["vs ",ei((null==F?void 0:F.lastYearGrossMargin)||0)," last year"]})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(y.ll,{className:"text-sm font-medium",children:"Utilization Rate"}),(0,t.jsx)(v.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(y.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:ei((null==F?void 0:F.utilizationRate)||0)}),(0,t.jsx)(k.E,{value:100*((null==F?void 0:F.utilizationRate)||0),className:"mt-2"})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(y.ll,{className:"text-sm font-medium",children:"Active Projects"}),(0,t.jsx)(p.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(y.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:(null==F?void 0:F.totalActiveProjects)||0}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(null==F?void 0:F.totalEmployees)||0," employees"]})]})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Project Status Overview"}),(0,t.jsx)(y.SZ,{children:"Active and closed projects"})]}),(0,t.jsxs)(y.aY,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-gray-700",children:"Active Projects"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:Array.isArray(L)?L.filter(e=>!K.has((null==e?void 0:e.project_id)||"")).length:0}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Currently in progress"})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-gray-700",children:"Closed Projects"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-red-600",children:K.size}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:"Completed or on hold"})]})]}),K.size>0&&(0,t.jsxs)("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[(0,t.jsx)("h5",{className:"font-medium text-sm text-gray-700 mb-2",children:"Recently Closed Projects"}),(0,t.jsx)("div",{className:"space-y-2",children:Array.isArray(L)&&L.filter(e=>K.has((null==e?void 0:e.project_id)||"")).slice(0,3).map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,t.jsx)("span",{className:"text-gray-600",children:(null==e?void 0:e.project_name)||"Unknown Project"}),(0,t.jsx)("button",{onClick:()=>eo((null==e?void 0:e.project_id)||""),className:"text-blue-600 hover:text-blue-800 text-xs font-medium",children:"Reopen"})]},null==e?void 0:e.project_id))})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Multipliers"}),(0,t.jsx)(y.SZ,{children:"Project multipliers by year"})]}),(0,t.jsxs)(y.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Current Year"}),(0,t.jsxs)(w.C,{variant:"default",children:[(null==F?void 0:F.currentYearMultiplier.toFixed(1))||"N/A","x"]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Last Year"}),(0,t.jsxs)(w.C,{variant:"secondary",children:[(null==F?void 0:F.lastYearMultiplier.toFixed(1))||"N/A","x"]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Two Years Ago"}),(0,t.jsxs)(w.C,{variant:"outline",children:[(null==F?void 0:F.twoYearsAgoMultiplier.toFixed(1))||"N/A","x"]})]})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Overhead Rates"}),(0,t.jsx)(y.SZ,{children:"Overhead rates by year"})]}),(0,t.jsxs)(y.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Current Year"}),(0,t.jsx)(w.C,{variant:"default",children:ei((null==F?void 0:F.currentYearOverhead)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Last Year"}),(0,t.jsx)(w.C,{variant:"secondary",children:ei((null==F?void 0:F.lastYearOverhead)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Two Years Ago"}),(0,t.jsx)(w.C,{variant:"outline",children:ei((null==F?void 0:F.twoYearsAgoOverhead)||0)})]})]})]})]})]}),(0,t.jsx)(N.nU,{value:"profitability",className:"space-y-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Profit Metrics"}),(0,t.jsx)(y.SZ,{children:"Year-to-date profitability analysis"})]}),(0,t.jsxs)(y.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"YTD Operating Income"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==F?void 0:F.ytdOperatingIncome)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Last Year YTD Operating Income"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==F?void 0:F.lastYearYtdOperatingIncome)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Revenue per Employee"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==F?void 0:F.currentYearRevenuePerEmployee)||0)})]})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Client Retention"}),(0,t.jsx)(y.SZ,{children:"Client retention and project metrics"})]}),(0,t.jsxs)(y.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Client Retention Rate"}),(0,t.jsx)(w.C,{variant:"default",children:ei((null==F?void 0:F.clientRetentionRate)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Average Project Size"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==F?void 0:F.averageProjectSize)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Average Billing Rate"}),(0,t.jsxs)("span",{className:"font-semibold",children:[er((null==F?void 0:F.averageBillingRate)||0),"/hr"]})]})]})]})]})}),(0,t.jsx)(N.nU,{value:"cashflow",className:"space-y-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Cashflow Overview"}),(0,t.jsx)(y.SZ,{children:"Current cashflow status"})]}),(0,t.jsxs)(y.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Current Cashflow"}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("span",{className:"font-semibold",children:er((null==F?void 0:F.currentCashflow)||0)}),(e=>{switch(e){case"up":return(0,t.jsx)(r.Z,{className:"h-4 w-4 text-green-600"});case"down":return(0,t.jsx)(c,{className:"h-4 w-4 text-red-600"});default:return(0,t.jsx)(o,{className:"h-4 w-4 text-gray-600"})}})((null==F?void 0:F.cashflowTrend)||"stable")]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Previous Month"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==F?void 0:F.previousMonthCashflow)||0)})]})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Invoice Status"}),(0,t.jsx)(y.SZ,{children:"Outstanding invoices and payment metrics"})]}),(0,t.jsxs)(y.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Overdue Invoices"}),(0,t.jsx)("span",{className:"font-semibold text-red-600",children:er((null==F?void 0:F.overdueInvoiceValue)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Total Outstanding"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==F?void 0:F.totalOutstandingInvoices)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{children:"Avg Days to Payment"}),(0,t.jsxs)("span",{className:"font-semibold",children:[(null==F?void 0:F.averageDaysToPayment)||0," days"]})]})]})]})]})}),(0,t.jsx)(N.nU,{value:"forecasting",className:"space-y-6",children:(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Trailing 12 Months"}),(0,t.jsx)(y.SZ,{children:"Revenue and profit trends"})]}),(0,t.jsx)(y.aY,{children:(0,t.jsx)("div",{className:"space-y-2",children:null==F?void 0:null===(e=F.trailing12Months)||void 0===e?void 0:e.slice(-6).map((e,s)=>(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,t.jsx)("span",{children:e.month}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("span",{children:er(e.revenue)}),(0,t.jsx)(w.C,{variant:e.profitMargin>.2?"default":"secondary",children:ei(e.profitMargin)})]})]},s))})})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"6-Month Forecast"}),(0,t.jsx)(y.SZ,{children:"Projected revenue and expenses"})]}),(0,t.jsx)(y.aY,{children:(0,t.jsx)("div",{className:"space-y-2",children:null==F?void 0:null===(s=F.forecast)||void 0===s?void 0:s.map((e,s)=>(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,t.jsx)("span",{children:e.month}),(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("span",{children:er(e.projectedRevenue)}),(0,t.jsx)(w.C,{variant:"outline",children:er(e.projectedProfit)})]})]},s))})})]})]})}),(0,t.jsx)(N.nU,{value:"financial-data",className:"space-y-6",children:(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Zoho Financial Data Integration"}),(0,t.jsx)(y.SZ,{children:"Test and verify the connection to Zoho Books for accurate financial metrics"})]}),(0,t.jsx)(y.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("button",{onClick:async()=>{try{Q(null);let e=await fetch("/api/financial-data"),s=await e.json();if(s.success)console.log("Financial data test result:",s),alert("Financial data test completed!\n\nSuccessful endpoints: ".concat(s.summary.successfulEndpoints,"/").concat(s.summary.totalEndpoints,"\nErrors: ").concat(s.summary.failedEndpoints,"\n\nCheck browser console for detailed results."));else throw Error(s.error)}catch(e){console.error("Financial data test failed:",e),Q("Financial data test failed: ".concat(e instanceof Error?e.message:"Unknown error"))}},className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Test Zoho Financial Integration"}),(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Click to test all Zoho financial endpoints and verify data accuracy"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Current Data Sources"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"YTD Profit:"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==F?void 0:F.ytdProfit)?"✅ Real Zoho Data":"❌ Mock Data"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Cash Flow:"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==F?void 0:F.currentCashflow)&&0!==F.currentCashflow?"✅ Real Zoho Data":"❌ Mock Data"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Revenue:"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==F?void 0:null===(i=F.trailing12Months)||void 0===i?void 0:null===(l=i[0])||void 0===l?void 0:l.revenue)?"✅ Real Zoho Data":"❌ Mock Data"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Expenses:"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==F?void 0:null===(P=F.trailing12Months)||void 0===P?void 0:null===(A=P[0])||void 0===A?void 0:A.expenses)?"✅ Real Zoho Data":"❌ Mock Data"})]})]})]}),(0,t.jsxs)("div",{className:"p-4 bg-gray-50 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Integration Status"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Zoho API:"}),(0,t.jsx)("span",{className:"font-semibold text-green-600",children:"✅ Connected"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Financial Reports:"}),(0,t.jsx)("span",{className:"font-semibold text-blue-600",children:"\uD83D\uDD04 Testing Required"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Data Accuracy:"}),(0,t.jsx)("span",{className:"font-semibold text-yellow-600",children:"⚠️ Verify Required"})]})]})]})]}),(0,t.jsxs)("div",{className:"p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-blue-800 mb-2",children:"How to Verify Data Accuracy"}),(0,t.jsxs)("div",{className:"text-sm text-blue-700 space-y-1",children:[(0,t.jsxs)("p",{children:["1. ",(0,t.jsx)("strong",{children:'Click "Test Zoho Financial Integration"'})," above"]}),(0,t.jsxs)("p",{children:["2. ",(0,t.jsx)("strong",{children:"Check browser console"})," for detailed API responses"]}),(0,t.jsxs)("p",{children:["3. ",(0,t.jsx)("strong",{children:"Compare dashboard metrics"})," with your Zoho Books reports"]}),(0,t.jsxs)("p",{children:["4. ",(0,t.jsx)("strong",{children:"Verify YTD Profit"})," matches your P&L statement"]}),(0,t.jsxs)("p",{children:["5. ",(0,t.jsx)("strong",{children:"Check Cash Flow"})," matches your cash flow statement"]})]})]}),W&&(0,t.jsxs)("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-red-800 mb-2",children:"Integration Error"}),(0,t.jsx)("p",{className:"text-sm text-red-700",children:W})]})]})})]})})}),H&&_&&(0,t.jsxs)(N.nU,{value:"project",className:"space-y-6",children:[(0,t.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:(null==_?void 0:_.projectName)||"Unknown Project"}),(0,t.jsx)("p",{className:"text-gray-600",children:(null==_?void 0:_.customerName)||"Unknown Customer"}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 mt-2",children:[(0,t.jsx)(w.C,{variant:K.has(H)?"secondary":"default",className:K.has(H)?"bg-red-100 text-red-800 border-red-200":"",children:K.has(H)?"Closed":"Active"}),(0,t.jsxs)("span",{className:"text-sm text-gray-500",children:[(null==_?void 0:_.startDate)?new Date(_.startDate).toLocaleDateString():"Unknown Date",(null==_?void 0:_.endDate)&&" - ".concat(new Date(_.endDate).toLocaleDateString())]})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-gray-900",children:er((null==_?void 0:_.totalBudget)||0)}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Total Budget"})]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(y.ll,{className:"text-sm font-medium",children:"Current Multiplier"}),(0,t.jsx)(g.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(y.aY,{children:[(0,t.jsxs)("div",{className:"text-2xl font-bold",children:[((null==_?void 0:_.currentMultiplier)||0).toFixed(1),"x"]}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(null==_?void 0:_.profitabilityTrend)==="improving"&&"↗ Improving",(null==_?void 0:_.profitabilityTrend)==="declining"&&"↘ Declining",(null==_?void 0:_.profitabilityTrend)==="stable"&&"→ Stable"]})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(y.ll,{className:"text-sm font-medium",children:"Efficiency"}),(0,t.jsx)(v.Z,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(y.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:ei((null==_?void 0:_.efficiency)||0)}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(null==_?void 0:_.billableHours)||0,"h billable / ",(null==_?void 0:_.totalHours)||0,"h total"]})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(y.ll,{className:"text-sm font-medium",children:"Budget Utilization"}),(0,t.jsx)(f,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(y.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:ei(((null==_?void 0:_.budgetUtilization)||0)/100)}),(0,t.jsx)(k.E,{value:(null==_?void 0:_.budgetUtilization)||0,className:"mt-2"})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(y.ll,{className:"text-sm font-medium",children:"Risk Level"}),(null==_?void 0:_.riskLevel)==="low"&&(0,t.jsx)(b.Z,{className:"h-4 w-4 text-green-600"}),(null==_?void 0:_.riskLevel)==="medium"&&(0,t.jsx)(u.Z,{className:"h-4 w-4 text-yellow-600"}),(null==_?void 0:_.riskLevel)==="high"&&(0,t.jsx)(m.Z,{className:"h-4 w-4 text-red-600"})]}),(0,t.jsxs)(y.aY,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold capitalize",children:(null==_?void 0:_.riskLevel)||"unknown"}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground",children:[(null==_?void 0:_.schedulePerformance)||0,"% schedule performance"]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Financial Summary"}),(0,t.jsx)(y.SZ,{children:"Cash vs Accrual basis"})]}),(0,t.jsxs)(y.aY,{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Cash Basis"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Total Collected"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==_?void 0:null===(S=_.cashBasis)||void 0===S?void 0:S.totalCollected)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Outstanding"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==_?void 0:null===(C=_.cashBasis)||void 0===C?void 0:C.outstandingReceivables)||0)})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Accrual Basis"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Total Earned"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==_?void 0:null===(D=_.accrualBasis)||void 0===D?void 0:D.totalEarned)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Work in Progress"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==_?void 0:null===(Z=_.accrualBasis)||void 0===Z?void 0:Z.workInProgress)||0)})]})]})]})]}),(0,t.jsxs)("div",{className:"pt-4 border-t",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Gross Profit"}),(0,t.jsx)("span",{className:"text-lg font-bold text-green-600",children:er((null==_?void 0:_.grossProfit)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Profit Margin"}),(0,t.jsx)("span",{className:"text-sm font-semibold",children:ei((null==_?void 0:_.profitMargin)||0)})]})]})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Employee Analysis"}),(0,t.jsx)(y.SZ,{children:"Hours and efficiency by employee"})]}),(0,t.jsx)(y.aY,{children:(0,t.jsxs)("div",{className:"space-y-3",children:[null==_?void 0:null===(E=_.employeeBreakdown)||void 0===E?void 0:E.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"font-semibold text-sm",children:(null==e?void 0:e.employeeName)||"Unknown Employee"}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[(null==e?void 0:e.billableHours)||0,"h billable / ",(null==e?void 0:e.totalHours)||0,"h total"]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("div",{className:"font-semibold",children:er((null==e?void 0:e.billableValue)||0)}),(0,t.jsxs)("div",{className:"text-xs text-gray-500",children:[ei((null==e?void 0:e.efficiency)||0)," efficient"]})]})]},s)),(!(null==_?void 0:_.employeeBreakdown)||0===_.employeeBreakdown.length)&&(0,t.jsx)("div",{className:"text-center text-gray-500 py-4",children:"No employee data available"})]})})]})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Project Phases"}),(0,t.jsx)(y.SZ,{children:"Architectural/Engineering phase breakdown"})]}),(0,t.jsx)(y.aY,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[null==_?void 0:null===(O=_.phases)||void 0===O?void 0:O.map((e,s)=>(0,t.jsxs)("div",{className:"border rounded-lg p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h4",{className:"font-semibold",children:(null==e?void 0:e.phaseName)||"Unknown Phase"}),(0,t.jsxs)(w.C,{variant:100===((null==e?void 0:e.completion)||0)?"default":"secondary",children:[(null==e?void 0:e.completion)||0,"% Complete"]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-sm",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Budget:"}),(0,t.jsx)("div",{className:"font-semibold",children:er((null==e?void 0:e.budget)||0)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Actual Cost:"}),(0,t.jsx)("div",{className:"font-semibold",children:er((null==e?void 0:e.actualCost)||0)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-gray-600",children:"Hours:"}),(0,t.jsxs)("div",{className:"font-semibold",children:[(null==e?void 0:e.hours)||0,"h"]})]})]}),(0,t.jsx)(k.E,{value:(null==e?void 0:e.completion)||0,className:"mt-2"})]},s)),(!(null==_?void 0:_.phases)||0===_.phases.length)&&(0,t.jsx)("div",{className:"text-center text-gray-500 py-4",children:"No phase data available"})]})})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Change Orders"}),(0,t.jsx)(y.SZ,{children:"Additional scope and value"})]}),(0,t.jsx)(y.aY,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:(null==_?void 0:null===(T=_.changeOrders)||void 0===T?void 0:T.count)||0}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Total Changes"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:er((null==_?void 0:null===(I=_.changeOrders)||void 0===I?void 0:I.totalValue)||0)}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Total Value"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-green-600",children:er((null==_?void 0:null===(U=_.changeOrders)||void 0===U?void 0:U.approvedValue)||0)}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Approved"})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"text-2xl font-bold text-yellow-600",children:er((null==_?void 0:null===(M=_.changeOrders)||void 0===M?void 0:M.pendingValue)||0)}),(0,t.jsx)("div",{className:"text-sm text-gray-600",children:"Pending"})]})]})})]}),(0,t.jsxs)(y.Zb,{children:[(0,t.jsxs)(y.Ol,{children:[(0,t.jsx)(y.ll,{children:"Project Forecasting"}),(0,t.jsx)(y.SZ,{children:"Projected completion and final metrics"})]}),(0,t.jsx)(y.aY,{children:(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold mb-3",children:"Projected Completion"}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Target Date:"}),(0,t.jsx)("span",{className:"font-semibold",children:(null==_?void 0:_.projectedCompletion)?new Date(_.projectedCompletion).toLocaleDateString():"Unknown Date"})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Projected Final Cost:"}),(0,t.jsx)("span",{className:"font-semibold",children:er((null==_?void 0:_.projectedFinalCost)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Projected Profit:"}),(0,t.jsx)("span",{className:"font-semibold text-green-600",children:er((null==_?void 0:_.projectedProfit)||0)})]}),(0,t.jsxs)("div",{className:"flex justify-between",children:[(0,t.jsx)("span",{children:"Projected Margin:"}),(0,t.jsx)("span",{className:"font-semibold",children:ei((null==_?void 0:_.projectedMargin)||0)})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-semibold mb-3",children:"Historical Multipliers"}),(0,t.jsxs)("div",{className:"space-y-2",children:[null==_?void 0:null===(R=_.historicalMultipliers)||void 0===R?void 0:R.map((e,s)=>(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"font-semibold",children:[((null==e?void 0:e.multiplier)||0).toFixed(1),"x"]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:(null==e?void 0:e.notes)||"No notes"})]}),(0,t.jsx)("div",{className:"text-xs text-gray-500",children:(null==e?void 0:e.date)?new Date(e.date).toLocaleDateString():"Unknown Date"})]},s)),(!(null==_?void 0:_.historicalMultipliers)||0===_.historicalMultipliers.length)&&(0,t.jsx)("div",{className:"text-center text-gray-500 py-2",children:"No historical multiplier data available"})]})]})]})})]})]})]})]})}):(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Financial Dashboard"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Failed to load dashboard data"})]})})}function S(){return(0,t.jsx)(A.Z,{children:(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsxs)("div",{className:"relative mb-12",children:[(0,t.jsx)("div",{className:"absolute top-0 left-0",children:(0,t.jsx)(n.default,{href:"/",className:"inline-flex items-center justify-center w-12 h-12 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border border-gray-200 dark:border-slate-700 rounded-full hover:bg-white dark:hover:bg-slate-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:(0,t.jsx)(d.Z,{className:"h-6 w-6 text-gray-600 dark:text-gray-300"})})}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-4",children:"Financial Dashboard"}),(0,t.jsx)("p",{className:"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto",children:"Comprehensive financial insights, profitability analysis, and performance metrics"})]})]}),(0,t.jsx)(P,{})]})})})}},17486:function(e,s,l){"use strict";l.d(s,{Z:function(){return i}});var t=l(57437),a=l(90483),n=l(99376),r=l(2265);function i(e){let{children:s}=e,{user:l,loading:i}=(0,a.a)(),c=(0,n.useRouter)();return((0,r.useEffect)(()=>{console.log("AdminOnly Debug:",{loading:i,user:l?{id:l.id,email:l.email,isAdmin:l.isAdmin,isBasic:l.isBasic}:null,shouldRedirect:!i&&(!l||!l.isAdmin)}),i||l&&l.isAdmin||(console.log("Redirecting to unauthorized page"),c.push("/unauthorized"))},[l,i,c]),i)?(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-indigo-900 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-xl text-gray-600 dark:text-gray-300",children:"Loading..."})]})}):l&&l.isAdmin?(console.log("AdminOnly: User is admin, rendering children"),(0,t.jsx)(t.Fragment,{children:s})):(console.log("AdminOnly: User not admin, returning null"),null)}},90483:function(e,s,l){"use strict";l.d(s,{AuthProvider:function(){return f},a:function(){return v}});var t=l(57437),a=l(2265),n=l(96244);let r="72ed6933-6bc6-430e-a75a-cb5d2e1c20e1",i="e4748cdc-321b-4db0-bc36-141b121a9117";r&&i||(console.warn("Azure AD environment variables are not set. Authentication will not work."),console.warn("Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file"));let c={auth:{clientId:r||"dummy-client-id",authority:"https://login.microsoftonline.com/".concat(i||"dummy-tenant-id"),redirectUri:window.location.origin},cache:{cacheLocation:"sessionStorage",storeAuthStateInCookie:!1}},o=new n.Lx(c),d={scopes:["User.Read","Directory.Read.All"]};function x(e){if(!e)return console.warn("checkAdminStatus: No user email provided"),!1;try{var s;if((((s="jonathan@collectif.nyc,Rafael@collectif.nyc",void 0===s)?void 0:s.split(",").map(e=>e.trim()))||[]).includes(e))return console.log("checkAdminStatus: User is admin via NEXT_PUBLIC_ADMIN_EMAILS"),!0}catch(e){console.warn("checkAdminStatus: Error checking NEXT_PUBLIC_ADMIN_EMAILS:",e)}if(e.endsWith("@collectif.nyc"))return console.log("checkAdminStatus: User is admin via @collectif.nyc domain"),!0;try{if(localStorage.getItem("adminOverride")===e)return console.log("checkAdminStatus: User is admin via localStorage override"),!0}catch(e){console.warn("checkAdminStatus: Error checking localStorage override:",e)}for(let s of[/^admin@/i,/^administrator@/i,/^superuser@/i,/^root@/i])if(s.test(e))return console.log("checkAdminStatus: User is admin via pattern match:",s),!0;return console.log("checkAdminStatus: User is not admin:",e),!1}async function h(){try{if(!r||!i)throw Error("Azure AD environment variables are not configured. Please set NEXT_PUBLIC_AZURE_AD_CLIENT_ID and NEXT_PUBLIC_AZURE_AD_TENANT_ID in your .env.local file");return await o.loginRedirect(d),null}catch(e){throw console.error("Sign in error:",e),e}}async function m(){try{await o.logoutPopup()}catch(e){console.error("Sign out error:",e)}}async function u(){try{let e=o.getActiveAccount();if(!e)return console.log("getAuthUser: No active account found"),null;let s=null;try{let e=await o.acquireTokenSilent({scopes:["User.Read","Directory.Read.All"]}),l=await fetch("https://graph.microsoft.com/v1.0/me",{headers:{Authorization:"Bearer ".concat(e.accessToken)}});if(!l.ok)throw Error("Failed to fetch user details from Graph API");s=await l.json(),console.log("getAuthUser: Successfully fetched user data from Graph API")}catch(l){console.warn("getAuthUser: Graph API failed, using fallback data:",l),s={mail:e.username,userPrincipalName:e.username,displayName:e.name}}let l=s.mail||s.userPrincipalName||e.username,t=x(l);return console.log("getAuthUser Debug:",{userEmail:l,accountName:e.name,accountId:e.localAccountId,isAdmin:t,adminEmails:"jonathan@collectif.nyc,Rafael@collectif.nyc",envVarAccessible:!0}),{id:e.localAccountId,name:s.displayName||e.name||"",email:l||"",isAdmin:t,isBasic:!0}}catch(e){console.error("getAuthUser error:",e);try{let e=o.getActiveAccount();if(!e)return console.log("getAuthUser: No account available for fallback"),null;let s=e.username,l=x(s);return console.log("getAuthUser Fallback Debug:",{accountEmail:s,accountName:e.name,isAdmin:l}),{id:e.localAccountId||"fallback-user",name:e.name||"Unknown User",email:s||"",isAdmin:l,isBasic:!0}}catch(e){return console.error("getAuthUser: Fallback also failed:",e),null}}}let j=(0,a.createContext)(void 0);function f(e){let{children:s}=e,[l,n]=(0,a.useState)(null),[r,i]=(0,a.useState)(!0);(0,a.useEffect)(()=>{(async()=>{try{await o.initialize();let e=await o.handleRedirectPromise();e&&(console.log("Redirect response received:",e),o.setActiveAccount(e.account));let s=await u();n(s)}catch(e){console.error("Auth initialization error:",e)}finally{i(!1)}})()},[]);let c=async()=>{try{i(!0),await h()}catch(e){console.error("Sign in error:",e),i(!1)}},d=async()=>{try{i(!0),await m(),n(null)}catch(e){console.error("Sign out error:",e)}finally{i(!1)}};return(0,t.jsx)(j.Provider,{value:{user:l,loading:r,signIn:c,signOut:d},children:s})}function v(){let e=(0,a.useContext)(j);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},32660:function(e,s,l){"use strict";l.d(s,{Z:function(){return t}});let t=(0,l(39763).Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},98420:function(e,s,l){"use strict";l.d(s,{Z:function(){return t}});let t=(0,l(39763).Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},69076:function(e,s,l){"use strict";l.d(s,{Z:function(){return t}});let t=(0,l(39763).Z)("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]])},45131:function(e,s,l){"use strict";l.d(s,{Z:function(){return t}});let t=(0,l(39763).Z)("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]])},99376:function(e,s,l){"use strict";var t=l(35475);l.o(t,"useRouter")&&l.d(s,{useRouter:function(){return t.useRouter}})}},function(e){e.O(0,[451,244,961,788,417,971,117,744],function(){return e(e.s=48721)}),_N_E=e.O()}]);