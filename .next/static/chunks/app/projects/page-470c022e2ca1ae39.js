(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[895],{80051:function(e,t,o){Promise.resolve().then(o.bind(o,5176))},5176:function(e,t,o){"use strict";o.r(t),o.d(t,{default:function(){return _}});var s=o(57437),r=o(2265),a=o(69064),n=o(56475),i=o(70525),l=o(91723),c=o(32660),d=o(69076),u=o(92735),h=o(73247),m=o(95252),g=o(83464),p=o(45441),f=o.n(p),x=o(40257);let v=e=>"object"==typeof e&&null!==e&&"response"in e;class b{_startAutoRefresh(){this.autoRefreshTimer&&clearInterval(this.autoRefreshTimer),this.autoRefreshTimer=setInterval(async()=>{try{console.log("Auto-refreshing Zoho token (45-minute interval)..."),this.lastRefreshTime=Date.now(),await this.forceRefreshToken(),console.log("Auto-refresh completed successfully")}catch(e){console.error("Auto-refresh failed:",e)}},this.AUTO_REFRESH_INTERVAL),this.lastRefreshTime=Date.now(),console.log("Automatic Zoho token refresh started (every 45 minutes)")}_stopAutoRefresh(){this.autoRefreshTimer&&(clearInterval(this.autoRefreshTimer),this.autoRefreshTimer=null,console.log("Automatic Zoho token refresh stopped"))}async getAccessToken(){try{let e=Date.now(),t=this.tokenExpiry-e;if(this.accessToken&&t>this.TOKEN_REFRESH_BUFFER&&"true"!==x.env.ZOHO_FORCE_REFRESH)return console.log("\uD83D\uDD10 Using cached token (expires in ".concat(Math.round(t/6e4)," minutes)")),this.accessToken;this.accessToken&&t>0?console.log("⚠️ Token expires soon (".concat(Math.round(t/6e4)," minutes), refreshing proactively")):this.accessToken?console.log("\uD83D\uDD04 Token expired, refreshing..."):console.log("\uD83C\uDD95 No token available, obtaining new one..."),console.log("Token expired or missing, refreshing..."),this.accessToken=null,this.tokenExpiry=0,this.refreshPromise||(this.refreshPromise=this._performTokenRefreshWithBackoff());let o=await this.refreshPromise;return this.refreshPromise=null,o}catch(a){if(console.error("Error refreshing Zoho access token:",a),g.Z.isAxiosError(a)){var e,t,o,s,r;console.error("Axios error details:",{status:v(a)?null===(e=a.response)||void 0===e?void 0:e.status:void 0,statusText:v(a)?null===(t=a.response)||void 0===t?void 0:t.statusText:void 0,data:v(a)?null===(o=a.response)||void 0===o?void 0:o.data:void 0,message:a.message,headers:v(a)?null===(s=a.response)||void 0===s?void 0:s.headers:void 0}),v(a)&&(null===(r=a.response)||void 0===r?void 0:r.headers)&&console.error("Rate limit headers:",{"X-Rate-Limit":a.response.headers["x-rate-limit"],"X-Rate-Limit-Remaining":a.response.headers["x-rate-limit-remaining"],"X-Rate-Limit-Reset":a.response.headers["x-rate-limit-reset"],"Retry-After":a.response.headers["retry-after"]})}if(this.cachedAccessToken)return console.warn("Falling back to cached access token due to refresh failure"),this.cachedAccessToken;throw Error("Failed to authenticate with Zoho: ".concat(a instanceof Error?a.message:"Unknown error"))}}async _performTokenRefreshWithBackoff(){for(let s=1;s<=5;s++)try{let e=new URLSearchParams;e.append("refresh_token","1000.4bf26c4881dfba83aae32546453d662d.a9353e91362a18c457b5cbec86b10ed2"),e.append("client_id","1000.8RL8WMTDXS0WIP2EJF2XUS6NDSLQEP"),e.append("client_secret","8a7ee3c04f0a0d860dd215c4449deab9bf15d1d00b"),e.append("grant_type","refresh_token");let t=await g.Z.post("".concat(this.ACCOUNTS_BASE,"/oauth/v2/token"),e,{headers:{"Content-Type":"application/x-www-form-urlencoded"},timeout:15e3});if(!t.data.access_token)throw Error("No access token received from Zoho");this.accessToken=t.data.access_token,this.tokenExpiry=Date.now()+1e3*t.data.expires_in,this.lastRefreshTime=Date.now(),this.cachedAccessToken=t.data.access_token,console.log("Token refreshed successfully. Expires in ".concat(Math.round(t.data.expires_in/60)," minutes")),console.log("Zoho token refresh response:",t.data),console.log("\uD83D\uDD10 Token cached: access_token=".concat(this.accessToken.substring(0,10),"..., expires_in=").concat(t.data.expires_in,"s, expiry=").concat(new Date(this.tokenExpiry).toISOString()));try{let e=await this.checkTokenScopes(this.accessToken);console.log("Zoho granted scopes:",(null==e?void 0:e.scope)||"unknown"),"string"!=typeof(null==e?void 0:e.scope)||e.scope.includes("ZohoBooks.reports.READ")||console.warn("⚠️ Missing ZohoBooks.reports.READ scope. Regenerate token.")}catch(e){console.error("Zoho token scope verification failed:",null==e?void 0:e.message)}return this.accessToken}catch(i){var e,t,o;let r=g.Z.isAxiosError(i),a=r&&v(i)?null===(e=i.response)||void 0===e?void 0:e.status:void 0,n=r&&v(i)?null===(o=i.response)||void 0===o?void 0:null===(t=o.data)||void 0===t?void 0:t.error_description:void 0;if(400===a&&"string"==typeof n&&n.toLowerCase().includes("too many requests")){let e=this.BASE_DELAY*Math.pow(2,s-1)+Math.floor(1e3*Math.random());console.warn("Zoho token refresh rate-limited (attempt ".concat(s,"/").concat(5,"). Waiting ").concat(e,"ms before retry.")),await new Promise(t=>setTimeout(t,e));continue}if(5===s)throw console.error("Zoho token refresh failed after ".concat(5," attempts:"),i),Error("Zoho token refresh rate-limited. Check daily API limits or token validity.");throw i}throw Error("Zoho token refresh failed after maximum retries")}async refreshAccessToken(){try{console.log("Refreshing Zoho access token...");let e=new URLSearchParams;e.append("refresh_token","1000.4bf26c4881dfba83aae32546453d662d.a9353e91362a18c457b5cbec86b10ed2"),e.append("client_id","1000.8RL8WMTDXS0WIP2EJF2XUS6NDSLQEP"),e.append("client_secret","8a7ee3c04f0a0d860dd215c4449deab9bf15d1d00b"),e.append("grant_type","refresh_token");let t=await g.Z.post("".concat(this.ACCOUNTS_BASE,"/oauth/v2/token"),e,{headers:{"Content-Type":"application/x-www-form-urlencoded"}});return this.accessToken=t.data.access_token,this.tokenExpiry=Date.now()+1e3*t.data.expires_in,this.cachedAccessToken=t.data.access_token,console.log("Token refreshed successfully. Expires in ".concat(Math.round(t.data.expires_in/60)," minutes")),console.log("\uD83D\uDD10 Token cached: access_token=".concat(this.accessToken.substring(0,10),"..., expires_in=").concat(t.data.expires_in,"s, expiry=").concat(new Date(this.tokenExpiry).toISOString())),this.accessToken}catch(e){throw console.error("Error refreshing Zoho access token:",e),Error("Failed to authenticate with Zoho")}}async makeRequest(e){return this.rateLimiter(async()=>{var t,o,s,r,a,n,i,l,c,d,u,h,m,p,f,x,b,y,j,w,k,_,N,E,A,C;try{await this.applyRateLimit();let s=await this.getAccessToken();if(this.requestCount++,console.log("\uD83D\uDCCA Zoho API call #".concat(this.requestCount," to: ").concat(e)),!s||"undefined"===s)throw Error("Invalid or missing access token");!this.organizationValidated&&e.startsWith("reports/")&&await this.validateOrganization(s),console.info("Making Zoho API request to: ".concat(e)),console.info("Token (first 10 chars): ".concat(null!==(t=null==s?void 0:s.substring(0,10))&&void 0!==t?t:"N/A","..."));let r=new AbortController,a=setTimeout(()=>r.abort(),15e3);try{let t=await g.Z.get("".concat(this.API_BASE,"/books/v3/").concat(e),{headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"},params:{organization_id:"652094923"},timeout:15e3,signal:r.signal});return clearTimeout(a),this.retryCount=0,this.requestCount++,this.lastRequestTime=Date.now(),console.info("Zoho API request successful: ".concat(e)),t.data}catch(t){if(clearTimeout(a),"ECONNABORTED"===t.code||(null===(o=t.message)||void 0===o?void 0:o.includes("timeout")))throw Error("Zoho API request timed out for ".concat(e));throw t}}catch(t){if(v(t)&&(null===(s=t.response)||void 0===s?void 0:s.status)===400&&(null===(n=t.response)||void 0===n?void 0:null===(a=n.data)||void 0===a?void 0:null===(r=a.error_description)||void 0===r?void 0:r.includes("too many requests"))){if(console.warn("Zoho rate limit hit, implementing exponential backoff..."),await this.handleRateLimit(),this.retryCount<this.MAX_RETRIES)return this.retryCount++,console.info("Retrying request after rate limit backoff (attempt ".concat(this.retryCount,")")),this.makeRequest(e);throw Error("Zoho API rate limit exceeded after maximum retries. Please try again later.")}if(v(t)&&(null===(i=t.response)||void 0===i?void 0:i.status)===429){if(console.warn("Zoho 429 rate limit hit, implementing exponential backoff..."),await this.handleRateLimit(),this.retryCount<this.MAX_RETRIES)return this.retryCount++,console.info("Retrying request after 429 backoff (attempt ".concat(this.retryCount,")")),this.makeRequest(e);throw Error("Zoho API rate limit exceeded after maximum retries. Please try again later.")}if(v(t)&&(null===(l=t.response)||void 0===l?void 0:l.status)===401){v(t)&&(null===(f=t.response)||void 0===f?void 0:null===(p=f.data)||void 0===p?void 0:p.code)===57&&console.error("Zoho API authorization error (code 57). Likely missing required scopes such as ZohoBooks.reports.READ."),console.info("Token expired, refreshing..."),this.accessToken=null,this.tokenExpiry=0;try{let t=await this.forceRefreshToken();if(!t||"undefined"===t)throw Error("Failed to obtain valid token after refresh");console.info("Retrying request with new token: ".concat(e));let o=await g.Z.get("".concat(this.API_BASE,"/books/v3/").concat(e),{headers:{Authorization:"Bearer ".concat(t),"Content-Type":"application/json"},params:{organization_id:"652094923"},timeout:15e3});return console.info("Request retry successful after token refresh"),o.data}catch(t){if(console.error("Failed to refresh token or retry request:",t),g.Z.isAxiosError(t)&&console.error("Token refresh Axios error details:",{status:v(t)?null===(E=t.response)||void 0===E?void 0:E.status:void 0,statusText:v(t)?null===(A=t.response)||void 0===A?void 0:A.statusText:void 0,data:v(t)?null===(C=t.response)||void 0===C?void 0:C.data:void 0,message:t.message,endpoint:e}),v(t)&&(null===(x=t.response)||void 0===x?void 0:x.status)===400&&(null===(j=t.response)||void 0===j?void 0:null===(y=j.data)||void 0===y?void 0:null===(b=y.error_description)||void 0===b?void 0:b.includes("too many requests")))throw Error("Zoho token refresh rate limited: ".concat(e,". Please wait before retrying."));if(v(t)&&(null===(w=t.response)||void 0===w?void 0:w.status)===400&&(null===(N=t.response)||void 0===N?void 0:null===(_=N.data)||void 0===_?void 0:null===(k=_.error_description)||void 0===k?void 0:k.includes("invalid")))throw Error("Zoho token refresh failed - invalid credentials: ".concat(e,". Check your OAuth configuration."));throw Error("Zoho API authentication failed after token refresh: ".concat(e,". Error: ").concat(t.message))}}throw console.error("Zoho API request failed for ".concat(e,":"),{status:v(t)?null===(c=t.response)||void 0===c?void 0:c.status:void 0,statusText:v(t)?null===(d=t.response)||void 0===d?void 0:d.statusText:void 0,data:v(t)?null===(u=t.response)||void 0===u?void 0:u.data:void 0,message:t.message}),v(t)&&(null===(m=t.response)||void 0===m?void 0:null===(h=m.data)||void 0===h?void 0:h.code)===57&&console.error("Zoho API authorization error (code 57). Verify organization_id and OAuth scopes (ZohoBooks.reports.READ)."),t}})}async checkTokenScopes(e){try{let t="".concat(this.ACCOUNTS_BASE,"/oauth/v2/tokeninfo?token=").concat(encodeURIComponent(e));return(await g.Z.get(t,{timeout:1e4})).data}catch(o){var t;let e=g.Z.isAxiosError(o)?(v(o)?null===(t=o.response)||void 0===t?void 0:t.data:void 0)||o.message:String(o);throw Error("string"==typeof e?e:JSON.stringify(e))}}async validateOrganization(e){var t,o,s;try{let o="652094923";if(!o){console.warn("ZOHO_ORGANIZATION_ID not set. Reports calls may fail.");return}let s="".concat(this.API_BASE,"/books/v3/organizations"),r=await g.Z.get(s,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"},timeout:15e3}),a=(null===(t=r.data)||void 0===t?void 0:t.organizations)||[];a.some(e=>String(e.organization_id)===String(o))?(this.organizationValidated=!0,console.log("Validated Zoho organization_id=".concat(o))):console.error("Provided organization_id=".concat(o," not found in Zoho account. Fetched organizations: ").concat(JSON.stringify(a)))}catch(e){console.error("Failed to validate Zoho organization:",{status:g.Z.isAxiosError(e)&&v(e)?null===(o=e.response)||void 0===o?void 0:o.status:void 0,data:g.Z.isAxiosError(e)&&v(e)?null===(s=e.response)||void 0===s?void 0:s.data:void 0,message:e.message})}}async applyRateLimit(){let e=Date.now();if(this.lastRequestTime>0){let t=e-this.lastRequestTime;if(t<this.MIN_REQUEST_INTERVAL){let e=this.MIN_REQUEST_INTERVAL-t;console.info("Rate limiting: waiting ".concat(e,"ms before next request")),await new Promise(t=>setTimeout(t,e))}}if(this.requestCount>=this.MAX_REQUESTS_PER_MINUTE){let t=e-this.lastRequestTime;if(t<6e4){let e=6e4-t;console.warn("Rate limiting: exceeded ".concat(this.MAX_REQUESTS_PER_MINUTE," requests per minute, waiting ").concat(e,"ms")),await new Promise(t=>setTimeout(t,e)),this.requestCount=0}else this.requestCount=0}}async handleRateLimit(){let e=this.BASE_DELAY*Math.pow(2,this.retryCount)+1e3*Math.random();console.warn("Rate limit backoff: waiting ".concat(e,"ms before retry (attempt ").concat(this.retryCount+1,")")),await new Promise(t=>setTimeout(t,e)),this.requestCount=0,this.lastRequestTime=0}async getProjects(){try{let t=[],o=1;for(;;){var e;let s=await this.makeRequest("projects?page=".concat(o,"&per_page=").concat(200)),r=(null===(e=s.projects)||void 0===e?void 0:e.map(e=>(1===o&&0===t.length&&console.log("Sample Zoho project data:",JSON.stringify(e,null,2)),{project_id:e.project_id,project_name:e.project_name||e.name||"",description:e.description||"",status:e.status||"active",start_date:e.start_date||"",end_date:e.end_date||"",budget_amount:e.budget_amount||0,rate_per_hour:e.rate_per_hour||0,customer_id:e.customer_id||"",customer_name:e.customer_name||"",signed_fee:void 0})))||[];if(t=t.concat(r),r.length<200)break;o++}return console.log("Fetched ".concat(t.length," projects from Zoho")),t}catch(e){return console.error("Error fetching projects:",e),[]}}async getProjectsWithRevenueBudget(){try{console.log("Fetching projects with revenue budget data...");let e=await this.getProjects(),t=e.filter(e=>{let t=e.signed_fee&&e.signed_fee>0;return t&&console.log("Project ".concat(e.project_name," has revenue budget: $").concat(e.signed_fee)),t});return console.log("Found ".concat(t.length," projects with revenue budget data")),e}catch(e){return console.error("Error fetching projects with revenue budget:",e),[]}}async debugProjectFields(){try{console.log("Debugging Zoho project fields...");let e=await this.makeRequest("projects?page=1&per_page=5");if(e.projects&&e.projects.length>0){console.log("Available fields in Zoho project response:");let t=e.projects[0];Object.keys(t).forEach(e=>{console.log("  ".concat(e,": ").concat(t[e]," (").concat(typeof t[e],")"))}),void 0!==t.revenue_budget?console.log("✅ Found revenue_budget field: ".concat(t.revenue_budget)):(console.log("❌ revenue_budget field not found in Zoho response"),console.log("Available budget-related fields:"),Object.keys(t).forEach(e=>{(e.toLowerCase().includes("budget")||e.toLowerCase().includes("revenue"))&&console.log("  ".concat(e,": ").concat(t[e]))}))}else console.log("No projects found in Zoho response")}catch(e){console.error("Error debugging project fields:",e)}}async getProjectsWithEstimates(){try{let e=await this.getProjects();return[...await Promise.all(e.slice(0,5).map(async e=>{try{let t=await this.getProjectEstimates(e.project_id),o=t.reduce((e,t)=>e+(t.total||0),0);return console.log("Project ".concat(e.project_name," estimates:"),t.length,"total amount:",o),{...e,signed_fee:e.signed_fee||o||0}}catch(t){return console.error("Error fetching estimates for project ".concat(e.project_id,":"),t),e}})),...e.slice(5)]}catch(e){return console.error("Error fetching projects with estimates:",e),[]}}async getProjectsWithInvoiceTotals(){try{let[e,t]=await Promise.all([this.getProjects(),this.getInvoices()]);return e.map(e=>{let o=t.filter(t=>t.project_id===e.project_id),s=o.reduce((e,t)=>e+t.amount,0);return console.log("Project ".concat(e.project_name," invoices:"),o.length,"total amount:",s),{...e,signed_fee:e.signed_fee||s||0}})}catch(e){return console.error("Error fetching projects with invoice totals:",e),[]}}async getInvoices(){try{console.log("\uD83D\uDCC4 Fetching invoices from Zoho...");let t=[],o=1,s=!0;for(;s;){var e;let r=await this.makeRequest("invoices?page=".concat(o,"&per_page=200")),a=r.invoices||[];if(t=t.concat(a),s=(null===(e=r.page_context)||void 0===e?void 0:e.has_more_page)||!1,o++,console.log("\uD83D\uDCC4 Fetched page ".concat(o-1,": ").concat(a.length," invoices (total so far: ").concat(t.length,")")),!s||0===a.length)break}console.log("✅ Total invoices fetched: ".concat(t.length));let r=t.map(e=>{let t=e.total||0,o=e.status||"unknown",s=0,r=0;return"paid"===o?(s=t,r=0):(s=0,r=t),{invoice_id:e.invoice_id,project_id:e.project_id,invoice_number:e.invoice_number,date:e.date,amount:t,status:o,billed_amount:s,unbilled_amount:r}})||[];if(console.log("\uD83D\uDCCA Zoho invoices processed: ".concat(r.length," total invoices")),r.length>0){let e=r.reduce((e,t)=>(e[t.status]=(e[t.status]||0)+1,e),{});console.log("\uD83D\uDCCB Invoice status breakdown:",e);let t=r.reduce((e,t)=>e+t.billed_amount,0),o=r.reduce((e,t)=>e+t.unbilled_amount,0);console.log("\uD83D\uDCB0 Invoice amount breakdown:",{totalBilled:t,totalUnbilled:o,totalAmount:t+o});let s=r[0];console.log("\uD83D\uDCC4 Sample invoice data:",{id:s.invoice_id,number:s.invoice_number,project:s.project_id,amount:s.amount,status:s.status,billed_amount:s.billed_amount,unbilled_amount:s.unbilled_amount})}return r}catch(e){return console.error("Error fetching invoices:",e),[]}}async getProjectInvoices(e){try{var t;let o=await this.makeRequest("projects/".concat(e,"/invoices"));return(null===(t=o.invoices)||void 0===t?void 0:t.map(e=>({invoice_id:e.invoice_id,project_id:e.project_id,invoice_number:e.invoice_number,date:e.date,amount:e.total,status:e.status,billed_amount:e.billed_amount||0,unbilled_amount:e.unbilled_amount||0})))||[]}catch(e){return console.error("Error fetching project invoices:",e),[]}}async getProjectDetails(e){try{let t=await this.makeRequest("projects/".concat(e));return console.log("Project ".concat(e," details:"),JSON.stringify(t,null,2)),t}catch(e){return console.error("Error fetching project details:",e),null}}async getProjectEstimates(e){try{let t=await this.makeRequest("projects/".concat(e,"/estimates"));return console.log("Project ".concat(e," estimates:"),JSON.stringify(t,null,2)),t.estimates||[]}catch(e){return console.error("Error fetching project estimates:",e),[]}}async getProjectContracts(e){try{let t=await this.makeRequest("projects/".concat(e,"/contracts"));return console.log("Project ".concat(e," contracts:"),JSON.stringify(t,null,2)),t.contracts||[]}catch(e){return console.error("Error fetching project contracts:",e),[]}}async getProfitAndLoss(e,t){try{console.info("\uD83D\uDCCA Fetching Zoho Profit & Loss for ".concat(e," to ").concat(t));let o=await this.makeRequest("reports/profitandloss?from_date=".concat(e,"&to_date=").concat(t)),s=JSON.stringify(o||{}).length,r=Object.keys(o||{}).length;return console.info("✅ Profit & Loss data fetched successfully (keys: ".concat(r,", bytes: ").concat(s,")")),o&&0!==r||console.warn("No data for reports/profitandloss. Verify organization ID, date range (2025-01-01 to 2025-08-13), or data in Zoho dashboard."),o}catch(e){return console.error("❌ Error fetching Profit & Loss:",e),console.warn("\uD83C\uDFAD Profit & Loss data unavailable, will use defaults"),null}}async getCashFlow(e,t){try{console.info("\uD83D\uDCB0 Fetching Zoho Cash Flow for ".concat(e," to ").concat(t));let o=await this.makeRequest("reports/cashflow?from_date=".concat(e,"&to_date=").concat(t)),s=JSON.stringify(o||{}).length,r=Object.keys(o||{}).length;return console.info("✅ Cash Flow data fetched successfully (keys: ".concat(r,", bytes: ").concat(s,")")),o&&0!==r||console.warn("No data for reports/cashflow. Verify organization ID, date range (2025-01-01 to 2025-08-13), or data in Zoho dashboard."),o}catch(e){return console.error("❌ Error fetching Cash Flow:",e),console.warn("\uD83C\uDFAD Cash Flow data unavailable, will use defaults"),null}}async getBalanceSheet(e){try{console.info("\uD83D\uDCC8 Fetching Zoho Balance Sheet for ".concat(e));let t=await this.makeRequest("reports/balancesheet?date=".concat(e)),o=JSON.stringify(t||{}).length,s=Object.keys(t||{}).length;return console.info("✅ Balance Sheet data fetched successfully (keys: ".concat(s,", bytes: ").concat(o,")")),t&&0!==s||console.warn("No data for reports/balancesheet. Verify organization ID, date range (2025-01-01 to 2025-08-13), or data in Zoho dashboard."),t}catch(e){return console.error("❌ Error fetching Balance Sheet:",e),console.warn("\uD83C\uDFAD Balance Sheet data unavailable, will use defaults"),null}}async getChartOfAccounts(){try{let e=await this.makeRequest("chartofaccounts");return console.log("Chart of Accounts data:",JSON.stringify(e,null,2)),e.chartofaccounts||[]}catch(e){return console.error("Error fetching Chart of Accounts:",e),[]}}async getJournalEntries(e,t){try{let o=await this.makeRequest("journalentries?from_date=".concat(e,"&to_date=").concat(t));return console.log("Journal Entries data:",JSON.stringify(o,null,2)),o.journalentries||[]}catch(e){return console.error("Error fetching Journal Entries:",e),[]}}async getFinancialMetrics(e,t){try{var o,s,r,a,n,i,l,c,d,u,h,m,g,p,f,x,b;console.info("\uD83D\uDCB0 Fetching Zoho financial metrics for ".concat(e," to ").concat(t));let[y,j,w]=await Promise.allSettled([this.getProfitAndLoss(e,t),this.getCashFlow(e,t),this.getBalanceSheet(t)]);if(console.info("\uD83D\uDCCA Financial reports raw response details:",{profitLoss:{status:y.status,bodyLength:"fulfilled"===y.status?JSON.stringify(y.value||{}).length:"N/A",hasData:"fulfilled"===y.status&&y.value&&Object.keys(y.value||{}).length>0},cashFlow:{status:j.status,bodyLength:"fulfilled"===j.status?JSON.stringify(j.value||{}).length:"N/A",hasData:"fulfilled"===j.status&&j.value&&Object.keys(j.value||{}).length>0},balanceSheet:{status:w.status,bodyLength:"fulfilled"===w.status?JSON.stringify(w.value||{}).length:"N/A",hasData:"fulfilled"===w.status&&w.value&&Object.keys(w.value||{}).length>0}}),"rejected"===y.status){let e=y.reason;v(e)&&(null===(c=e.response)||void 0===c?void 0:c.status)===404?console.warn("⚠️ Profit & Loss returned 404 - Invalid endpoint - check Zoho API docs"):console.warn("⚠️ Profit & Loss data failed:",y.reason)}if("rejected"===j.status){let e=j.reason;v(e)&&(null===(d=e.response)||void 0===d?void 0:d.status)===404?console.warn("⚠️ Cash Flow returned 404 - Invalid endpoint - check Zoho API docs"):console.warn("⚠️ Cash Flow data failed:",j.reason)}if("rejected"===w.status){let e=w.reason;v(e)&&(null===(u=e.response)||void 0===u?void 0:u.status)===404?console.warn("⚠️ Balance Sheet returned 404 - Invalid endpoint - check Zoho API docs"):console.warn("⚠️ Balance Sheet data failed:",w.reason)}let k=0,_=0,N=0;if("fulfilled"===y.status&&y.value){let e=y.value;k=(null===(h=e.revenue)||void 0===h?void 0:h.total)||e.revenue||(null===(m=e.income)||void 0===m?void 0:m.total)||e.income||(null===(g=e.sales)||void 0===g?void 0:g.total)||e.sales||0,_=(null===(p=e.expenses)||void 0===p?void 0:p.total)||e.expenses||(null===(f=e.cost_of_goods_sold)||void 0===f?void 0:f.total)||e.cost_of_goods_sold||0,N=(null===(x=e.operating_expenses)||void 0===x?void 0:x.total)||e.operating_expenses||(null===(b=e.admin_expenses)||void 0===b?void 0:b.total)||e.admin_expenses||0,console.log("\uD83D\uDCCA P&L data structure analysis:",{hasRevenue:!!e.revenue,hasExpenses:!!e.expenses,hasOperatingExpenses:!!e.operating_expenses,revenueValue:k,expensesValue:_,operatingExpensesValue:N,allKeys:Object.keys(e)})}let E=k-_,A=E-N,C=E-N,R="fulfilled"===j.status&&(null===(o=j.value)||void 0===o?void 0:o.net_cash_flow)||0,T="fulfilled"===w.status&&(null===(r=w.value)||void 0===r?void 0:null===(s=r.current_assets)||void 0===s?void 0:s.accounts_receivable)||0,D="fulfilled"===w.status&&(null===(n=w.value)||void 0===n?void 0:null===(a=n.current_liabilities)||void 0===a?void 0:a.accounts_payable)||0,S="fulfilled"===w.status&&(null===(l=w.value)||void 0===l?void 0:null===(i=l.current_assets)||void 0===i?void 0:i.cash_and_bank)||0;return console.info("\uD83D\uDCCA Financial metrics data sources:",{profitLoss:"fulfilled"===y.status?"✅":"❌",cashFlow:"fulfilled"===j.status?"✅":"❌",balanceSheet:"fulfilled"===w.status?"✅":"❌"}),{revenue:k,expenses:_,grossProfit:E,netProfit:A,operatingIncome:C,cashFlow:R,accountsReceivable:T,accountsPayable:D,cashBalance:S}}catch(e){return console.error("❌ Error fetching financial metrics:",e),console.warn("\uD83C\uDFAD Returning default financial metrics due to API failure"),{revenue:0,expenses:0,grossProfit:0,netProfit:0,operatingIncome:0,cashFlow:0,accountsReceivable:0,accountsPayable:0,cashBalance:0}}}async forceRefreshToken(){return this.accessToken=null,this.tokenExpiry=0,this.lastRefreshTime=Date.now(),await this.getAccessToken()}getTokenStatus(){let e=Date.now();return{hasToken:!!this.accessToken,expiresIn:this.tokenExpiry-e,isExpired:e>=this.tokenExpiry}}getAutoRefreshStatus(){let e=Date.now()-this.lastRefreshTime,t=Math.max(0,this.AUTO_REFRESH_INTERVAL-e);return{isActive:!!this.autoRefreshTimer,nextRefreshIn:t}}enableAutoRefresh(){this._startAutoRefresh()}disableAutoRefresh(){this._stopAutoRefresh()}getStatus(){return{...this.getTokenStatus(),autoRefresh:this.getAutoRefreshStatus()}}constructor(){this.accessToken=null,this.tokenExpiry=0,this.refreshPromise=null,this.TOKEN_REFRESH_BUFFER=6e5,this.autoRefreshTimer=null,this.AUTO_REFRESH_INTERVAL=27e5,this.lastRefreshTime=0,this.ACCOUNTS_BASE=x.env.ZOHO_ACCOUNTS_BASE||"https://accounts.zoho.com",this.API_BASE=x.env.ZOHO_API_BASE||"https://www.zohoapis.com",this.organizationValidated=!1,this.requestCount=0,this.lastRequestTime=0,this.MAX_REQUESTS_PER_MINUTE=80,this.MIN_REQUEST_INTERVAL=2e3,this.retryCount=0,this.MAX_RETRIES=5,this.BASE_DELAY=5e3,this.cachedAccessToken=null,this.rateLimiter=f()(50),this._startAutoRefresh(),console.log("Zoho API base: ".concat(this.API_BASE," | Accounts base: ").concat(this.ACCOUNTS_BASE))}}new b;let y=async()=>{try{console.log("Client: Fetching projects from API");let e=await fetch("/api/projects"),t=await e.json();if(t.success)return console.log("Client: Successfully fetched",t.count,"projects"),t.data;throw console.error("Client: API returned error:",t.error),Error(t.error)}catch(e){throw console.error("Client: Error fetching projects:",e),e}},j=async()=>{try{console.log("Client: Fetching invoices from API");let e=await fetch("/api/invoices"),t=await e.json();if(t.success)return console.log("Client: Successfully fetched",t.count,"invoices"),t.data;throw console.error("Client: API returned error:",t.error),Error(t.error)}catch(e){throw console.error("Client: Error fetching invoices:",e),e}};var w=o(94508),k=o(27648);function _(){let[e,t]=(0,r.useState)([]),[o,g]=(0,r.useState)(new Set),[p,f]=(0,r.useState)(!0),[x,v]=(0,r.useState)(""),[b,_]=(0,r.useState)("all"),[N,E]=(0,r.useState)("projectName"),[A,C]=(0,r.useState)("asc");(0,r.useEffect)(()=>{R(),T();let e=e=>{let{projectId:o,status:s,closedProjects:r}=e.detail;console.log("ProjectsPage: Received project status change:",{projectId:o,status:s,newClosedProjects:r}),r&&(g(r),t(e=>e.map(e=>e.projectId===o?{...e,status:"closed"===s?"closed":"active"}:e)))};return window.addEventListener("projectStatusChanged",e),()=>{window.removeEventListener("projectStatusChanged",e)}},[]);let R=async()=>{try{f(!0),console.log("ProjectsPage: Starting fetchProjectsData");let[e,s]=await Promise.all([y(),j()]);if(console.log("ProjectsPage: API responses - projects:",null==e?void 0:e.length,"invoices:",null==s?void 0:s.length),e&&s){let r=(0,w.K0)(e),a=(0,w.ab)(e,s,r,o).map(e=>({projectId:e.projectId,projectName:e.projectName,customerName:e.customerName,status:e.status||"active",totalBilled:e.totalBilled,totalUnbilled:e.totalUnbilled,totalProjected:e.totalProjected}));t(a),console.log("ProjectsPage: Processed",a.length,"project summaries")}else a.Am.error("Failed to fetch projects data")}catch(e){console.error("Error fetching projects:",e),a.Am.error("Failed to fetch projects")}finally{f(!1)}},T=async()=>{try{let e=await fetch("/api/project-statuses");if(e.ok){let t=await e.json();if("object"==typeof t&&null!==t){let e=Object.entries(t).filter(e=>{let[t,o]=e;return"closed"===o}).map(e=>{let[t,o]=e;return t});g(new Set(e)),console.log("ProjectsPage: Loaded project statuses from database:",t)}}else console.warn("Failed to fetch project statuses from database, using empty set"),g(new Set)}catch(e){console.error("Error loading project statuses from database:",e),g(new Set)}},D=async e=>{try{if((await fetch("/api/project-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,status:"active"})})).ok){let s=new Set(o);s.delete(e),g(s),t(t=>t.map(t=>t.projectId===e?{...t,status:"active"}:t)),window.dispatchEvent(new CustomEvent("projectStatusChanged",{detail:{projectId:e,status:"reopened",closedProjects:s}})),a.Am.success("Project reopened successfully")}else throw Error("Failed to reopen project")}catch(e){console.error("Error reopening project:",e),a.Am.error("Failed to reopen project")}},S=async e=>{try{if((await fetch("/api/project-status",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({projectId:e,status:"closed"})})).ok){let s=new Set(o);s.add(e),g(s),t(t=>t.map(t=>t.projectId===e?{...t,status:"closed"}:t)),window.dispatchEvent(new CustomEvent("projectStatusChanged",{detail:{projectId:e,status:"closed",closedProjects:s}})),a.Am.success("Project closed successfully")}else throw Error("Failed to close project")}catch(e){console.error("Error closing project:",e),a.Am.error("Failed to close project")}},P=e.filter(e=>{let t=e.projectName.toLowerCase().includes(x.toLowerCase())||e.customerName.toLowerCase().includes(x.toLowerCase()),o="all"===b||e.status===b;return t&&o}).sort((e,t)=>{let o=e[N],s=t[N];if("string"==typeof o&&"string"==typeof s){let e=o.localeCompare(s);return"asc"===A?e:-e}return"number"==typeof o&&"number"==typeof s?"asc"===A?o-s:s-o:0}),Z=e=>{N===e?C("asc"===A?"desc":"asc"):(E(e),C("asc"))},I=e=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:0,maximumFractionDigits:0}).format(e),F=e=>{switch(e){case"closed":return"bg-gray-100 text-gray-800 border-gray-300";case"active":return"bg-green-100 text-green-800 border-green-300";default:return"bg-blue-100 text-blue-800 border-blue-300"}},O=e=>{switch(e){case"closed":return(0,s.jsx)(n.Z,{className:"w-4 h-4"});case"active":return(0,s.jsx)(i.Z,{className:"w-4 h-4"});default:return(0,s.jsx)(l.Z,{className:"w-4 h-4"})}};return p?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsxs)("div",{className:"text-center max-w-md",children:[(0,s.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-2 border-blue-600 mx-auto mb-4"}),(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"Loading Projects"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-4",children:"Fetching project data from Zoho and calculating projections..."}),(0,s.jsxs)("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4 text-left",children:[(0,s.jsx)("p",{className:"text-sm text-blue-800 dark:text-blue-200 mb-2",children:(0,s.jsx)("strong",{children:"What's happening:"})}),(0,s.jsxs)("ul",{className:"text-sm text-blue-700 dark:text-blue-300 space-y-1",children:[(0,s.jsx)("li",{children:"• Connecting to Zoho Books API"}),(0,s.jsx)("li",{children:"• Loading project information"}),(0,s.jsx)("li",{children:"• Calculating billing projections"}),(0,s.jsx)("li",{children:"• Processing invoice data"})]})]})]})})}):(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-900 dark:via-slate-800 dark:to-slate-900",children:(0,s.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,s.jsxs)("div",{className:"relative mb-12",children:[(0,s.jsx)("div",{className:"absolute top-0 left-0",children:(0,s.jsx)(k.default,{href:"/",className:"inline-flex items-center justify-center w-12 h-12 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border border-gray-200 dark:border-slate-700 rounded-full hover:bg-white dark:hover:bg-slate-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:(0,s.jsx)(c.Z,{className:"h-6 w-6 text-gray-600 dark:text-gray-300"})})}),(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("h1",{className:"text-4xl md:text-5xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-indigo-600 bg-clip-text text-transparent mb-4",children:"Projects Dashboard"}),(0,s.jsx)("p",{className:"text-xl text-gray-600 dark:text-gray-300 max-w-3xl mx-auto",children:"Comprehensive project overview with billing analysis and status management"})]}),(0,s.jsxs)("div",{className:"absolute top-0 right-0 flex space-x-3",children:[(0,s.jsxs)("button",{onClick:R,className:"inline-flex items-center px-4 py-2 bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm border border-gray-200 dark:border-slate-700 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-white dark:hover:bg-slate-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:[(0,s.jsx)(d.Z,{className:"h-4 w-4 mr-2"}),"Refresh"]}),(0,s.jsxs)("button",{className:"inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200 shadow-lg hover:shadow-xl",children:[(0,s.jsx)(u.Z,{className:"h-4 w-4 mr-2"}),"Export"]})]})]}),(0,s.jsx)("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-xl border border-gray-200/50 dark:border-slate-700/50 p-6 mb-8",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(h.Z,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5"}),(0,s.jsx)("input",{type:"text",placeholder:"Search projects or customers...",value:x,onChange:e=>v(e.target.value),className:"w-full pl-10 pr-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400"})]})}),(0,s.jsx)("div",{className:"flex gap-2",children:(0,s.jsxs)("select",{value:b,onChange:e=>_(e.target.value),className:"px-4 py-3 border border-gray-300 dark:border-slate-600 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-slate-700 text-gray-900 dark:text-gray-100",children:[(0,s.jsx)("option",{value:"all",children:"All Statuses"}),(0,s.jsx)("option",{value:"active",children:"Active"}),(0,s.jsx)("option",{value:"closed",children:"Closed"})]})})]})}),(0,s.jsxs)("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-xl border border-gray-200/50 dark:border-slate-700/50 overflow-hidden mb-8",children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gradient-to-r from-gray-50 to-blue-50 dark:from-slate-700 dark:to-slate-800",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors duration-200",onClick:()=>Z("projectName"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{children:"Project"}),"projectName"===N&&(0,s.jsx)("span",{className:"text-blue-500",children:"asc"===A?"↑":"↓"})]})}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors duration-200",onClick:()=>Z("customerName"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{children:"Customer"}),"customerName"===N&&(0,s.jsx)("span",{className:"text-blue-500",children:"asc"===A?"↑":"↓"})]})}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors duration-200",onClick:()=>Z("status"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{children:"Status"}),"status"===N&&(0,s.jsx)("span",{className:"text-blue-500",children:"asc"===A?"↑":"↓"})]})}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors duration-200",onClick:()=>Z("totalBilled"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{children:"Billed"}),"totalBilled"===N&&(0,s.jsx)("span",{className:"text-blue-500",children:"asc"===A?"↑":"↓"})]})}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors duration-200",onClick:()=>Z("totalUnbilled"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{children:"Unbilled"}),"totalUnbilled"===N&&(0,s.jsx)("span",{className:"text-blue-500",children:"asc"===A?"↑":"↓"})]})}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors duration-200",onClick:()=>Z("totalProjected"),children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("span",{children:"Projected"}),"totalProjected"===N&&(0,s.jsx)("span",{className:"text-blue-500",children:"asc"===A?"↑":"↓"})]})}),(0,s.jsx)("th",{scope:"col",className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 dark:text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"divide-y divide-gray-200 dark:divide-slate-700",children:P.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-50/50 dark:hover:bg-slate-700/50 transition-colors duration-200",children:[(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("div",{className:"max-w-xs",children:(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-gray-100 break-words leading-relaxed",children:e.projectName})})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsx)("div",{className:"max-w-xs",children:(0,s.jsx)("div",{className:"text-sm text-gray-900 dark:text-gray-100 break-words leading-relaxed",children:e.customerName})})}),(0,s.jsx)("td",{className:"px-6 py-4",children:(0,s.jsxs)("span",{className:"inline-flex items-center px-3 py-1.5 rounded-full text-xs font-medium border transition-all duration-200 ".concat(F(e.status)),children:[O(e.status),(0,s.jsx)("span",{className:"ml-2",children:e.status})]})}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-100 font-medium",children:I(e.totalBilled)}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-100 font-medium",children:I(e.totalUnbilled)}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm text-gray-900 dark:text-gray-100 font-medium",children:I(e.totalProjected)}),(0,s.jsx)("td",{className:"px-6 py-4 text-sm font-medium",children:"closed"===e.status?(0,s.jsx)("button",{onClick:()=>D(e.projectId),className:"text-blue-600 hover:text-blue-800 hover:bg-blue-50 dark:hover:bg-blue-900/20 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200",children:"Reopen"}):(0,s.jsx)("button",{onClick:()=>S(e.projectId),className:"text-gray-600 hover:text-gray-800 hover:bg-gray-50 dark:hover:bg-gray-900/20 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200",children:"Close"})})]},e.projectId))})]})}),0===P.length&&(0,s.jsxs)("div",{className:"text-center py-16",children:[(0,s.jsx)("div",{className:"text-gray-400 dark:text-gray-500 mb-4",children:(0,s.jsx)(h.Z,{className:"w-16 h-16 mx-auto"})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No projects found"}),(0,s.jsx)("p",{className:"text-gray-500 dark:text-gray-400",children:x||"all"!==b?"Try adjusting your search or filters":"No projects have been added yet"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[(0,s.jsx)("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-xl border border-gray-200/50 dark:border-slate-700/50 p-6 hover:shadow-2xl transition-all duration-300",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-green-500 to-emerald-500 rounded-xl flex items-center justify-center",children:(0,s.jsx)(i.Z,{className:"w-6 h-6 text-white"})})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Projects"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.length})]})]})}),(0,s.jsx)("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-xl border border-gray-200/50 dark:border-slate-700/50 p-6 hover:shadow-2xl transition-all duration-300",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-blue-500 to-indigo-500 rounded-xl flex items-center justify-center",children:(0,s.jsx)(m.Z,{className:"w-6 h-6 text-white"})})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Billed"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:I(e.reduce((e,t)=>e+t.totalBilled,0))})]})]})}),(0,s.jsx)("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-xl border border-gray-200/50 dark:border-slate-700/50 p-6 hover:shadow-2xl transition-all duration-300",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-yellow-500 to-orange-500 rounded-xl flex items-center justify-center",children:(0,s.jsx)(l.Z,{className:"w-6 h-6 text-white"})})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total Unbilled"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:I(e.reduce((e,t)=>e+t.totalUnbilled,0))})]})]})}),(0,s.jsx)("div",{className:"bg-white/80 dark:bg-slate-800/80 backdrop-blur-sm rounded-2xl shadow-xl border border-gray-200/50 dark:border-slate-700/50 p-6 hover:shadow-2xl transition-all duration-300",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"flex-shrink-0",children:(0,s.jsx)("div",{className:"w-12 h-12 bg-gradient-to-r from-gray-500 to-slate-500 rounded-xl flex items-center justify-center",children:(0,s.jsx)(n.Z,{className:"w-6 h-6 text-white"})})}),(0,s.jsxs)("div",{className:"ml-4",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Closed Projects"}),(0,s.jsx)("p",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:e.filter(e=>"closed"===e.status).length})]})]})})]})]})})}},94508:function(e,t,o){"use strict";o.d(t,{K0:function(){return x},UF:function(){return m},ab:function(){return g},bh:function(){return f},cn:function(){return d},ji:function(){return h},xG:function(){return p}});var s=o(31559),r=o(13657),a=o(61069),n=o(55463),i=o(14613),l=o(61994),c=o(53335);function d(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];return(0,c.m6)((0,l.W)(t))}function u(e,t){let o=[],i=(0,s.Z)(e),l=(0,r.Z)(t);for(;i<=l;)o.push((0,a.Z)(i,"yyyy-MM")),i=(0,n.Z)(i,1);return o}function h(){let e=new Date(2022,0,1),t=new Date;return u(e,(0,n.Z)(t,24))}function m(){let e=new Date;return u((0,i.Z)(e,12),(0,n.Z)(e,12))}function g(e,t,o,s){let r=e||[],n=o||{};if(0===r.length)return[];let i=h(),l=new Map;return(t||[]).forEach(e=>{let t=e.project_id;l.has(t)||l.set(t,[]),l.get(t).push(e)}),r.map(e=>{let t=l.get(e.project_id)||[],o=new Map;t.forEach(e=>{let t=(0,a.Z)(new Date(e.date),"yyyy-MM"),s=o.get(t)||{billed:0,unbilled:0};s.billed+=e.billed_amount,s.unbilled+=e.unbilled_amount,o.set(t,s)});let r=i.map(t=>{var s,r,a;let i=o.get(t)||{billed:0,unbilled:0},l=(null===(a=n[e.project_id])||void 0===a?void 0:null===(r=a.months)||void 0===r?void 0:null===(s=r[t])||void 0===s?void 0:s.value)||0,c=i.billed+i.unbilled;return{month:t,billed:i.billed,unbilled:i.unbilled,projected:l,actual:c}}),c=r.reduce((e,t)=>e+t.billed,0),d=r.reduce((e,t)=>e+t.unbilled,0),u=r.reduce((e,t)=>e+t.projected,0),h=!!s&&s.has(e.project_id);return{projectId:e.project_id,projectName:e.project_name,customerName:e.customer_name,signedFee:void 0,monthlyData:r,totalBilled:c,totalUnbilled:d,totalProjected:u,status:h?"closed":"active",isClosed:h}})}function p(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}function f(e){let[t,o]=e.split("-"),s=new Date(parseInt(t),parseInt(o)-1);return(0,a.Z)(s,"MMM yyyy")}function x(e){let t=h(),o={};return(e||[]).forEach(e=>{o[e.project_id]={months:{},asrFee:0},t.forEach(t=>{let s=t>(0,a.Z)(new Date,"yyyy-MM");o[e.project_id].months[t]={value:0,isEditable:s,isProjected:s}})}),o}}},function(e){e.O(0,[451,64,961,565,971,117,744],function(){return e(e.s=80051)}),_N_E=e.O()}]);