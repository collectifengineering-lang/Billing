"use strict";(()=>{var e={};e.id=9072,e.ids=[9072],e.modules={53524:e=>{e.exports=require("@prisma/client")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},81644:(e,t,a)=>{a.r(t),a.d(t,{originalPathname:()=>h,patchFetch:()=>w,requestAsyncStorage:()=>y,routeModule:()=>m,serverHooks:()=>f,staticGenerationAsyncStorage:()=>_});var r={};a.r(r),a.d(r,{GET:()=>u,POST:()=>p,dynamic:()=>d});var o=a(49303),n=a(88716),s=a(60670),c=a(87070),i=a(9487),l=a(24544);let d="force-dynamic";async function u(e){try{let{searchParams:t}=new URL(e.url),a=t.get("projectId");if(!a)return c.NextResponse.json({error:"Project ID is required"},{status:400});if(!await (0,l.Xp)())return c.NextResponse.json({status:"active"});let r=await i.Z.projects.findUnique({where:{id:a},select:{status:!0}});return c.NextResponse.json({projectId:a,status:r?.status||"active"})}catch(e){if(console.error("Error fetching project status:",e),e instanceof Error&&(e.message?.includes("does not exist")||"code"in e&&"P2021"===e.code))return c.NextResponse.json({status:"active"});return c.NextResponse.json({error:"Failed to fetch project status",message:e instanceof Error?e.message:"Unknown error"},{status:500})}}async function p(e){let{projectId:t,status:a}=await e.json();if(!t||!a)return c.NextResponse.json({error:"Project ID and status are required"},{status:400});if(!["active","closed","completed","on-hold"].includes(a))return c.NextResponse.json({error:"Invalid status. Must be: active, closed, completed, or on-hold"},{status:400});try{await (0,l.Xp)()||console.log("Tables do not exist yet, but Prisma Accelerate will create them on first insert");let e=await i.Z.projects.upsert({where:{id:t},update:{status:a,updatedAt:new Date},create:{id:t,name:`Project ${t}`,status:a,createdAt:new Date,updatedAt:new Date}});return c.NextResponse.json({success:!0,projectId:e.id,status:e.status})}catch(e){if(console.error("Error updating project status:",e),e instanceof Error&&(e.message?.includes("does not exist")||"code"in e&&"P2021"===e.code)){console.log("Table does not exist, attempting to create schema...");try{await i.Z.projects.create({data:{id:"__test__",name:"Test Project",status:"active",createdAt:new Date,updatedAt:new Date}}),await i.Z.projects.deleteMany({where:{id:"__test__"}});let e=await i.Z.projects.upsert({where:{id:t},update:{status:a,updatedAt:new Date},create:{id:t,name:`Project ${t}`,status:a,createdAt:new Date,updatedAt:new Date}});return c.NextResponse.json({success:!0,projectId:e.id,status:e.status})}catch(e){return console.error("Failed to create table:",e),c.NextResponse.json({error:"Database schema not ready. Please run database setup first."},{status:500})}}return c.NextResponse.json({error:"Failed to update project status"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/project-status/route",pathname:"/api/project-status",filename:"route",bundlePath:"app/api/project-status/route"},resolvedPagePath:"C:\\Users\\Jonathan\\Desktop\\Billing\\app\\api\\project-status\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:_,serverHooks:f}=m,h="/api/project-status/route";function w(){return(0,s.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:_})}},24544:(e,t,a)=>{a.d(t,{DD:()=>p,K7:()=>i,XA:()=>u,Xp:()=>o,Y0:()=>m,_B:()=>r.Z,eC:()=>l,eK:()=>n,jv:()=>d,lA:()=>c,te:()=>s});var r=a(9487);async function o(){try{return await r.Z.$connect(),console.log("Database connection successful"),await r.Z.projection.findFirst(),console.log("Database schema already exists"),!0}catch(e){if(console.error("Database connection or schema check failed:",e),e.message?.includes("ENOTFOUND")||e.message?.includes("ECONNREFUSED"))return console.error("‚ùå Database connection failed - check your DATABASE_URL"),console.error("   Current DATABASE_URL:",process.env.DATABASE_URL?"Set":"Not set"),!1;if("P2021"===e.code||e.message?.includes("does not exist"))try{return console.log("Tables do not exist, attempting to create schema..."),await r.Z.projection.create({data:{projectId:"__test__",month:"__test__",value:0}}),await r.Z.projection.deleteMany({where:{projectId:"__test__",month:"__test__"}}),console.log("Database schema created successfully"),!0}catch(e){return console.error("Failed to create database schema:",e),!1}return console.log("Tables do not exist, but Prisma Accelerate will create them automatically"),console.log("Note: With Prisma Accelerate, tables are created automatically when you first insert data"),!1}finally{await r.Z.$disconnect()}}async function n(){try{if(console.log("Creating database schema..."),await o())return console.log("Database schema creation completed successfully"),!0;return console.error("Database schema creation failed"),!1}catch(e){return console.error("Database schema creation failed:",e),!1}}async function s(e){try{let t=await r.Z.bamboohr_config.upsert({where:{subdomain:e.subdomain},update:{api_key:e.apiKey,webhook_secret:e.webhookSecret,is_active:!0,last_sync:new Date,updated_at:new Date},create:{subdomain:e.subdomain,api_key:e.apiKey,webhook_secret:e.webhookSecret,is_active:!0,last_sync:new Date,created_at:new Date,updated_at:new Date}});return console.log(`BambooHR config saved for subdomain: ${e.subdomain}`),t}catch(e){throw console.error("Error saving BambooHR config:",e),e}}async function c(e){try{console.log(`üîÑ Attempting to upsert employee:`,JSON.stringify(e,null,2));let t=await r.Z.employees.upsert({where:{id:e.id},update:{name:e.name,email:e.email,status:e.status,department:e.department,position:e.position,hire_date:e.hireDate||null,termination_date:e.terminationDate,updated_at:new Date},create:{id:e.id,name:e.name,email:e.email,status:e.status,department:e.department,position:e.position,hire_date:e.hireDate||null,termination_date:e.terminationDate,created_at:new Date,updated_at:new Date}});return console.log(`‚úÖ Employee saved: ${e.name} (${e.id})`),t}catch(t){if(console.error("‚ùå Error saving employee:",t),"P2025"===t.code){console.log(`üîÑ Record not found, attempting to create employee: ${e.name} (${e.id})`);try{let t=await r.Z.employees.create({data:{id:e.id,name:e.name,email:e.email,status:e.status,department:e.department,position:e.position,hire_date:e.hireDate||null,termination_date:e.terminationDate,created_at:new Date,updated_at:new Date}});return console.log(`‚úÖ Employee created: ${e.name} (${e.id})`),t}catch(e){throw console.error("‚ùå Error creating employee:",e),e}}throw t}}async function i(e){try{console.log(`üîÑ Attempting to upsert employee salary:`,JSON.stringify(e,null,2));let t=await r.Z.employee_salaries.upsert({where:{employee_id_effective_date:{employee_id:e.employeeId,effective_date:e.effectiveDate}},update:{end_date:e.endDate,annual_salary:e.annualSalary,hourly_rate:e.hourlyRate,currency:e.currency,notes:e.notes,source:e.source,updated_at:new Date},create:{employee_id:e.employeeId,effective_date:e.effectiveDate,end_date:e.endDate,annual_salary:e.annualSalary,hourly_rate:e.hourlyRate,currency:e.currency||"USD",notes:e.notes,source:e.source||"bamboohr",created_at:new Date,updated_at:new Date}});return console.log(`‚úÖ Employee salary saved for ${e.employeeId} effective ${e.effectiveDate}`),t}catch(t){if(console.error("‚ùå Error saving employee salary:",t),"P2025"===t.code){console.log(`üîÑ Record not found, attempting to create employee salary for ${e.employeeId} effective ${e.effectiveDate}`);try{let t=await r.Z.employee_salaries.create({data:{employee_id:e.employeeId,effective_date:e.effectiveDate,end_date:e.endDate,annual_salary:e.annualSalary,hourly_rate:e.hourlyRate,currency:e.currency||"USD",notes:e.notes,source:e.source||"bamboohr",created_at:new Date,updated_at:new Date}});return console.log(`‚úÖ Employee salary created for ${e.employeeId} effective ${e.effectiveDate}`),t}catch(e){throw console.error("‚ùå Error creating employee salary:",e),e}}throw t}}async function l(e){try{let t=await r.Z.project_multipliers.upsert({where:{project_id_effective_date:{project_id:e.projectId,effective_date:e.effectiveDate}},update:{project_name:e.projectName,multiplier:e.multiplier,end_date:e.endDate,notes:e.notes,updated_at:new Date},create:{project_id:e.projectId,project_name:e.projectName,multiplier:e.multiplier,effective_date:e.effectiveDate,end_date:e.endDate,notes:e.notes,created_at:new Date,updated_at:new Date}});return console.log(`Project multiplier saved for ${e.projectName} effective ${e.effectiveDate}`),t}catch(e){throw console.error("Error saving project multiplier:",e),e}}async function d(e){try{let t=await r.Z.employee_time_entries.upsert({where:{employee_id_project_id_date:{employee_id:e.employeeId,project_id:e.projectId,date:e.date}},update:{employee_name:e.employeeName,project_name:e.projectName,hours:e.hours,billable_hours:e.billableHours,non_billable_hours:e.nonBillableHours,hourly_rate:e.hourlyRate,project_multiplier:e.projectMultiplier,total_cost:e.totalCost,billable_value:e.billableValue,efficiency:e.efficiency,description:e.description,tags:e.tags,updated_at:new Date},create:{employee_id:e.employeeId,employee_name:e.employeeName,project_id:e.projectId,project_name:e.projectName,date:e.date,hours:e.hours,billable_hours:e.billableHours,non_billable_hours:e.nonBillableHours,hourly_rate:e.hourlyRate,project_multiplier:e.projectMultiplier,total_cost:e.totalCost,billable_value:e.billableValue,efficiency:e.efficiency,description:e.description,tags:e.tags,created_at:new Date,updated_at:new Date}});return console.log(`Time entry saved for ${e.employeeName} on ${e.date}`),t}catch(e){throw console.error("Error saving time entry:",e),e}}async function u(){try{return await r.Z.employees.findMany()}catch(e){throw console.error("Error getting all employees:",e),e}}async function p(){try{return await r.Z.employee_salaries.findMany()}catch(e){throw console.error("Error getting all employee salaries:",e),e}}async function m(){try{return await r.Z.project_multipliers.findMany()}catch(e){throw console.error("Error getting all project multipliers:",e),e}}},9487:(e,t,a)=>{a.d(t,{Z:()=>o});var r=a(53524);let o=globalThis.prisma??new r.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[9276,5972],()=>a(81644));module.exports=r})();