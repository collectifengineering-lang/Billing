"use strict";(()=>{var e={};e.id=437,e.ids=[437],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},15859:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>k,patchFetch:()=>m,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>y,staticGenerationAsyncStorage:()=>h});var o={};r.r(o),r.d(o,{POST:()=>u});var i=r(49303),s=r(88716),a=r(60670),n=r(87070),c=r(80928),l=r(88403);async function u(e){try{let{action:t,data:r}=await e.json();switch(t){case"process-time-entries":{let{clockifyEntries:e,clockifyUsers:t,projects:o}=r,i=await (0,c.Lk)(e,t,o);return n.NextResponse.json({employeeTimeEntries:i})}case"project-profitability":{let{projectId:e,startDate:t,endDate:o,employeeTimeEntries:i,revenue:s}=r,a=await (0,c.XI)(e,t,o,i,s);return n.NextResponse.json({report:a})}case"employee-profitability":{let{employeeId:e,startDate:t,endDate:o,employeeTimeEntries:i}=r,s=await (0,c.To)(e,t,o,i);return n.NextResponse.json({report:s})}case"full-analysis":{let e=await l.e1.getUser(),t=await l.e1.getProjects(),o=await l.e1.getAllTimeEntries(r.startDate,r.endDate),i=await (0,c.Lk)(o,[e],t),s=[];for(let e of t)if(i.filter(t=>t.projectId===e.id).length>0){let t=r.projectRevenues?.[e.id]||0,o=await (0,c.XI)(e.id,r.startDate,r.endDate,i,t);s.push(o)}return n.NextResponse.json({timeEntries:i,projectReports:s,summary:{totalProjects:s.length,totalHours:i.reduce((e,t)=>e+t.hours,0),totalCost:i.reduce((e,t)=>e+t.totalCost,0),totalRevenue:s.reduce((e,t)=>e+t.totalRevenue,0),totalProfit:s.reduce((e,t)=>e+t.grossProfit,0)}})}default:return n.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){return console.error("Error in profitability analysis:",e),n.NextResponse.json({error:e.message},{status:500})}}let p=new i.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/payroll/profitability/route",pathname:"/api/payroll/profitability",filename:"route",bundlePath:"app/api/payroll/profitability/route"},resolvedPagePath:"C:\\Users\\Jonathan\\Desktop\\Billing\\app\\api\\payroll\\profitability\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:y}=p,k="/api/payroll/profitability/route";function m(){return(0,a.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:h})}},88403:(e,t,r)=>{r.d(t,{ZP:()=>s,e1:()=>i,wu:()=>a});class o{constructor(){this.apiKey=null,this.workspaceId=null,this.baseUrl="https://api.clockify.me/api/v1",this._isConfigured=!1,this.apiKey=process.env.CLOCKIFY_API_KEY||null,this.workspaceId=process.env.CLOCKIFY_WORKSPACE_ID||null,this.apiKey&&"your_clockify_api_key_here"!==this.apiKey&&this.workspaceId&&"your_clockify_workspace_id_here"!==this.workspaceId?(this._isConfigured=!0,console.log("Clockify service initialized with valid credentials")):(this._isConfigured=!1,console.warn("Clockify service initialized without valid credentials - will use mock data"),console.warn("Please set CLOCKIFY_API_KEY and CLOCKIFY_WORKSPACE_ID in your environment variables"))}getHeaders(){if(!this.apiKey)throw Error("Clockify API key not configured");return{"X-Api-Key":this.apiKey,"Content-Type":"application/json"}}async makeRequest(e,t){if(!this._isConfigured)throw Error("Clockify service not properly configured");try{let r=new URL(`${this.baseUrl}${e}`);t&&Object.keys(t).forEach(e=>{void 0!==t[e]&&null!==t[e]&&r.searchParams.append(e,t[e])});let o=await fetch(r.toString(),{method:"GET",headers:this.getHeaders()});if(401===o.status)throw Error("Clockify API authentication failed - check your API key");if(403===o.status)throw Error("Clockify API access forbidden - check your workspace ID and permissions");if(429===o.status)throw Error("Clockify API rate limit exceeded - try again later");if(!o.ok)throw Error(`Clockify API error: ${o.status} ${o.statusText}`);return await o.json()}catch(e){if(e instanceof Error)throw e;throw Error(`Clockify API request failed: ${e}`)}}isConfigured(){return this._isConfigured}getConfigurationStatus(){return{configured:this._isConfigured,hasApiKey:!!(this.apiKey&&"your_clockify_api_key_here"!==this.apiKey),hasWorkspaceId:!!(this.workspaceId&&"your_clockify_workspace_id_here"!==this.workspaceId)}}getConfigStatus(){return this.getConfigurationStatus()}setWorkspaceId(e){this.workspaceId=e,this.apiKey&&"your_clockify_api_key_here"!==this.apiKey&&(this._isConfigured=!0)}async getUser(){try{return await this.makeRequest("/user")}catch(e){return console.error("Failed to get Clockify user:",e),{id:"mock-user-id",name:"Mock User",email:"user@example.com",status:"ACTIVE"}}}async getWorkspaces(){try{return await this.makeRequest("/workspaces")}catch(e){return console.error("Failed to get Clockify workspaces:",e),[{id:"mock-workspace-id",name:"Mock Workspace",hourlyRate:{amount:100,currency:"USD"}}]}}async getProjects(){try{if(!this.workspaceId)throw Error("Workspace ID not configured");return await this.makeRequest(`/workspaces/${this.workspaceId}/projects`)}catch(e){return console.error("Failed to get Clockify projects:",e),[{id:"mock-project-1",name:"Mock Project 1",clientId:"mock-client-1",clientName:"Mock Client 1",status:"ACTIVE",billable:!0,hourlyRate:{amount:150,currency:"USD"}},{id:"mock-project-2",name:"Mock Project 2",clientId:"mock-client-2",clientName:"Mock Client 2",status:"ACTIVE",billable:!0,hourlyRate:{amount:175,currency:"USD"}}]}}async getTimeEntries(e,t,r){try{if(!this.workspaceId)throw Error("Workspace ID not configured");return await this.makeRequest(`/workspaces/${this.workspaceId}/projects/${e}/time-entries`,{start:t,end:r})}catch(e){return console.error("Failed to get Clockify time entries:",e),[{id:"mock-time-entry-1",description:"Mock work session",timeInterval:{start:t,end:r,duration:"PT2H30M"},billable:!0,userId:"mock-user-id",userName:"Mock User"}]}}async getAllTimeEntries(e,t){try{if(!this.workspaceId)throw Error("Workspace ID not configured");return await this.makeRequest(`/workspaces/${this.workspaceId}/time-entries`,{start:e,end:t})}catch(r){return console.error("Failed to get all Clockify time entries:",r),[{id:"mock-time-entry-1",description:"Mock work session",timeInterval:{start:e,end:t,duration:"PT8H0M"},billable:!0,userId:"mock-user-id",userName:"Mock User",projectId:"mock-project-1",projectName:"Mock Project 1"}]}}async getUsers(){try{if(!this.workspaceId)throw Error("Workspace ID not configured");return await this.makeRequest(`/workspaces/${this.workspaceId}/users`)}catch(e){return console.error("Failed to get Clockify users:",e),[{id:"mock-user-1",name:"Mock User 1",email:"user1@example.com",status:"ACTIVE",hourlyRate:{amount:100,currency:"USD"}},{id:"mock-user-2",name:"Mock User 2",email:"user2@example.com",status:"ACTIVE",hourlyRate:{amount:120,currency:"USD"}}]}}async getProjectTimeReport(e,t,r){try{if(!this.workspaceId)throw Error("Workspace ID not configured");let o=await this.getTimeEntries(e,t,r),i=await this.getProjects().then(t=>t.find(t=>t.id===e));if(!i)throw Error("Project not found");let s=o.reduce((e,t)=>{let r=t.timeInterval.duration,o=this.parseDuration(r);return e+o},0),a=o.filter(e=>e.billable).reduce((e,t)=>{let r=t.timeInterval.duration,o=this.parseDuration(r);return e+o},0),n=s-a;return{projectId:e,projectName:i.name,totalHours:s,billableHours:a,nonBillableHours:n,totalAmount:s*(i.hourlyRate?.amount||0),billableAmount:a*(i.hourlyRate?.amount||0),nonBillableAmount:n*(i.hourlyRate?.amount||0),entries:o,period:{start:t,end:r}}}catch(e){return console.error("Failed to get project time report:",e),null}}async getAllProjectsTimeSummary(e,t){try{if(!this.workspaceId)throw Error("Workspace ID not configured");let r=await this.getProjects(),o=[];for(let i of r){let r=await this.getProjectTimeReport(i.id,e,t);r&&o.push(r)}return o}catch(e){return console.error("Failed to get all projects time summary:",e),[]}}parseDuration(e){let t=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);return t?parseInt(t[1]||"0")+parseInt(t[2]||"0")/60+parseInt(t[3]||"0")/3600:0}}let i=new o,s=i,a=async(e,t)=>{try{return await i.getAllProjectsTimeSummary(e,t)}catch(e){return console.error("Error fetching Clockify time summaries:",e),[]}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[276,972,928],()=>r(15859));module.exports=o})();