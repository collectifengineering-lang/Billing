"use strict";(()=>{var e={};e.id=437,e.ids=[437],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},15859:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>m});var s={};r.r(s),r.d(s,{POST:()=>c});var o=r(49303),a=r(88716),i=r(60670),n=r(87070),l=r(80928),p=r(88403);async function c(e){try{let{action:t,data:r}=await e.json();switch(t){case"process-time-entries":{let{clockifyEntries:e,clockifyUsers:t,projects:s}=r,o=await (0,l.Lk)(e,t,s);return n.NextResponse.json({employeeTimeEntries:o})}case"project-profitability":{let{projectId:e,startDate:t,endDate:s,employeeTimeEntries:o,revenue:a}=r,i=await (0,l.XI)(e,t,s,o,a);return n.NextResponse.json({report:i})}case"employee-profitability":{let{employeeId:e,startDate:t,endDate:s,employeeTimeEntries:o}=r,a=await (0,l.To)(e,t,s,o);return n.NextResponse.json({report:a})}case"full-analysis":{let e=await p.e1.getUser(),t=await p.e1.getProjects(),s=await p.e1.getAllTimeEntries(r.startDate,r.endDate),o=await (0,l.Lk)(s,[e],t),a=[];for(let e of t)if(o.filter(t=>t.projectId===e.id).length>0){let t=r.projectRevenues?.[e.id]||0,s=await (0,l.XI)(e.id,r.startDate,r.endDate,o,t);a.push(s)}return n.NextResponse.json({timeEntries:o,projectReports:a,summary:{totalProjects:a.length,totalHours:o.reduce((e,t)=>e+t.hours,0),totalCost:o.reduce((e,t)=>e+t.totalCost,0),totalRevenue:a.reduce((e,t)=>e+t.totalRevenue,0),totalProfit:a.reduce((e,t)=>e+t.grossProfit,0)}})}default:return n.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){return console.error("Error in profitability analysis:",e),n.NextResponse.json({error:e.message},{status:500})}}let u=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/payroll/profitability/route",pathname:"/api/payroll/profitability",filename:"route",bundlePath:"app/api/payroll/profitability/route"},resolvedPagePath:"C:\\Users\\Jonathan\\Desktop\\Billing\\app\\api\\payroll\\profitability\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:m,serverHooks:h}=u,y="/api/payroll/profitability/route";function g(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:m})}},88403:(e,t,r)=>{r.d(t,{e1:()=>a,wu:()=>i});var s=r(29712);class o{constructor(){this.apiKey="OTg4NTg3YjMtMmQzYS00ZWE1LThiOTctZmY4NDAwYzRiZjZj",this.workspaceId=null,this.baseUrl="https://api.clockify.me/api/v1",console.log("Clockify service initialized with API key")}getHeaders(){return{"X-Api-Key":this.apiKey,"Content-Type":"application/json"}}async makeRequest(e,t){try{return(await s.Z.get(`${this.baseUrl}${e}`,{headers:this.getHeaders(),params:t})).data}catch(e){throw console.error("Clockify API error:",e.response?.data||e.message),Error(`Clockify API error: ${e.response?.data?.message||e.message}`)}}async getUser(){return this.makeRequest("/user")}async getWorkspaces(){return this.makeRequest("/workspaces")}async getProjects(e){if(!(e||this.workspaceId)){let e=await this.getWorkspaces();if(e.length>0)this.workspaceId=e[0].id,console.log(`Using workspace: ${e[0].name} (${e[0].id})`);else throw Error("No workspaces found")}return this.makeRequest(`/workspaces/${this.workspaceId}/projects`)}async getProjectTimeEntries(e,t,r,s){let o=s||this.workspaceId;if(!o)throw Error("Workspace ID not configured");let a={};return t&&(a.start=t),r&&(a.end=r),this.makeRequest(`/workspaces/${o}/projects/${e}/time-entries`,a)}async getUserTimeEntries(e,t,r,s){let o=s||this.workspaceId;if(!o)throw Error("Workspace ID not configured");let a={};return t&&(a.start=t),r&&(a.end=r),this.makeRequest(`/workspaces/${o}/user/${e}/time-entries`,a)}async getAllTimeEntries(e,t,r){let s=r||this.workspaceId;if(!s)throw Error("Workspace ID not configured");let o={};return e&&(o.start=e),t&&(o.end=t),this.makeRequest(`/workspaces/${s}/time-entries`,o)}async getProjectTimeReport(e,t,r,s){let o=await this.getProjectTimeEntries(e,t,r,s),a=await this.getProjectById(e,s),i=0,n=0,l=0,p=0,c=0,u=0;return o.forEach(e=>{let t=this.parseDuration(e.timeInterval.duration)/36e5;i+=t,e.billable?(n+=t,c+=e.costRate?.amount||0):(l+=t,u+=e.costRate?.amount||0),p+=e.costRate?.amount||0}),{projectId:e,projectName:a?.name||"Unknown Project",totalHours:i,billableHours:n,nonBillableHours:l,totalAmount:p,billableAmount:c,nonBillableAmount:u,entries:o,period:{start:t,end:r}}}async getProjectById(e,t){let r=t||this.workspaceId;if(!r)throw Error("Workspace ID not configured");try{return await this.makeRequest(`/workspaces/${r}/projects/${e}`)}catch(t){return console.error(`Project ${e} not found`),null}}async getProjectTimeSummary(e,t,r,s){let o=await this.getProjectTimeReport(e,t,r,s);return{projectId:o.projectId,projectName:o.projectName,totalHours:o.totalHours,billableHours:o.billableHours,nonBillableHours:o.nonBillableHours,totalAmount:o.totalAmount,billableAmount:o.billableAmount,nonBillableAmount:o.nonBillableAmount,period:o.period}}async getAllProjectsTimeSummary(e,t,r){let s=await this.getProjects(r),o=[];for(let a of s)try{let s=await this.getProjectTimeSummary(a.id,e,t,r);o.push(s)}catch(e){console.error(`Error getting summary for project ${a.id}:`,e)}return o}parseDuration(e){let t=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);return t?(3600*parseInt(t[1]||"0")+60*parseInt(t[2]||"0")+parseInt(t[3]||"0"))*1e3:0}isConfigured(){return!!this.apiKey}getConfigStatus(){return{apiKey:!!this.apiKey,workspaceId:!!this.workspaceId,configured:this.isConfigured()}}setWorkspaceId(e){this.workspaceId=e}}let a=new o,i=async(e,t)=>{try{return await a.getAllProjectsTimeSummary(e,t)}catch(e){return console.error("Error fetching Clockify time summaries:",e),[]}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[276,972,712,928],()=>r(15859));module.exports=s})();