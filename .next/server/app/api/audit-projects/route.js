"use strict";(()=>{var e={};e.id=6722,e.ids=[6722],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},11649:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>f,patchFetch:()=>y,requestAsyncStorage:()=>u,routeModule:()=>d,serverHooks:()=>m,staticGenerationAsyncStorage:()=>p});var r={};o.r(r),o.d(r,{GET:()=>h,dynamic:()=>l});var c=o(49303),a=o(88716),i=o(60670),s=o(87070),n=o(58489);let l="force-dynamic";async function h(e){try{console.info("\uD83D\uDD0D Starting project mapping audit...");let e=await n.gG.syncProjects(),t=e.mappings.filter(e=>"orphaned"===e.status),o=e.mappings.filter(e=>"clockify-only"===e.status),r=e.mappings.filter(e=>"zoho-only"===e.status),c=e.mappings.filter(e=>e.archived),a=e.mappings.filter(e=>"synced"===e.status&&e.clockifyName!==e.zohoName).map(e=>({clockifyId:e.clockifyId,clockifyName:e.clockifyName,zohoId:e.zohoId,zohoName:e.zohoName,suggestion:"Consider renaming one to match the other for consistency"})),i={summary:{totalProjects:e.totalProjects,syncedProjects:e.syncedProjects,clockifyOnlyProjects:e.clockifyOnlyProjects,zohoOnlyProjects:e.zohoOnlyProjects,orphanedProjects:e.orphanedProjects,archivedProjects:e.archivedProjects,namingInconsistencies:a.length},orphanedProjects:t.map(e=>({id:e.clockifyId||e.zohoId,name:e.name,source:e.clockifyId?"clockify":"zoho",archived:e.archived,suggestion:e.archived?"Archived project - can be safely ignored or cleaned up":"Create corresponding project in the other system or mark as archived"})),clockifyOnlyProjects:o.map(e=>({clockifyId:e.clockifyId,name:e.clockifyName,archived:e.archived,suggestion:"Create corresponding project in Zoho or mark as archived"})),zohoOnlyProjects:r.map(e=>({zohoId:e.zohoId,name:e.zohoName,archived:e.archived,suggestion:"Create corresponding project in Clockify or mark as inactive"})),archivedProjects:c.map(e=>({id:e.clockifyId||e.zohoId,name:e.name,source:e.clockifyId?e.zohoId?"both":"clockify":"zoho",suggestion:"Consider filtering out from reports to reduce noise"})),namingInconsistencies:a,timestamp:e.timestamp};return console.info("âœ… Project audit complete:",{total:i.summary.totalProjects,synced:i.summary.syncedProjects,orphaned:i.summary.orphanedProjects,inconsistencies:i.summary.namingInconsistencies}),s.NextResponse.json({success:!0,data:i})}catch(e){return console.error("âŒ Error in project audit:",e),s.NextResponse.json({success:!1,error:"Failed to audit project mappings",message:e.message||"An unexpected error occurred"},{status:500})}}let d=new c.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/audit-projects/route",pathname:"/api/audit-projects",filename:"route",bundlePath:"app/api/audit-projects/route"},resolvedPagePath:"C:\\Users\\Jonathan\\Desktop\\Billing\\app\\api\\audit-projects\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:u,staticGenerationAsyncStorage:p,serverHooks:m}=d,f="/api/audit-projects/route";function y(){return(0,i.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:p})}},58489:(e,t,o)=>{o.d(t,{gG:()=>i,lu:()=>s});var r=o(88403),c=o(87707);class a{async syncProjects(){console.info("\uD83D\uDD04 Starting project synchronization...");try{let[e,t]=await Promise.allSettled([r.e1.getProjects(),c.VC.getProjects()]),o="fulfilled"===e.status?e.value:[],a="fulfilled"===t.status?t.value:[];console.info(`ðŸ“Š Fetched ${o.length} Clockify projects and ${a.length} Zoho projects`),this.clockifyProjectsCache.clear(),this.zohoProjectsCache.clear(),o.forEach(e=>{this.clockifyProjectsCache.set(e.id,e)}),a.forEach(e=>{this.zohoProjectsCache.set(e.project_id,e)});let i=this.createProjectMappings(o,a);this.mappingCache.clear(),i.forEach(e=>{let t=e.clockifyId||e.zohoId||e.name;this.mappingCache.set(t,e)}),this.lastSyncTime=new Date;let s={totalProjects:i.length,syncedProjects:i.filter(e=>"synced"===e.status).length,clockifyOnlyProjects:i.filter(e=>"clockify-only"===e.status).length,zohoOnlyProjects:i.filter(e=>"zoho-only"===e.status).length,orphanedProjects:i.filter(e=>"orphaned"===e.status).length,archivedProjects:i.filter(e=>e.archived).length,mappings:i,timestamp:new Date};return console.info("âœ… Project synchronization complete:",{total:s.totalProjects,synced:s.syncedProjects,clockifyOnly:s.clockifyOnlyProjects,zohoOnly:s.zohoOnlyProjects,orphaned:s.orphanedProjects,archived:s.archivedProjects}),s}catch(e){throw console.error("âŒ Error synchronizing projects:",e),e}}createProjectMappings(e,t){let o=[],r=new Set;return e.forEach(e=>{let c=this.normalizeName(e.name),a=t.find(e=>{if(r.has(e.project_id))return!1;let t=this.normalizeName(e.project_name);return this.areNamesMatching(c,t)});a?(r.add(a.project_id),o.push({clockifyId:e.id,clockifyName:e.name,zohoId:a.project_id,zohoName:a.project_name,name:e.name,status:"synced",archived:e.archived||!1,lastSyncedAt:new Date})):o.push({clockifyId:e.id,clockifyName:e.name,name:e.name,status:e.archived?"orphaned":"clockify-only",archived:e.archived||!1,lastSyncedAt:new Date})}),t.forEach(e=>{if(!r.has(e.project_id)){let t=e.status?.toLowerCase()==="inactive"||e.status?.toLowerCase()==="closed";o.push({zohoId:e.project_id,zohoName:e.project_name,name:e.project_name,status:t?"orphaned":"zoho-only",archived:t,lastSyncedAt:new Date})}}),o}normalizeName(e){return e?e.toLowerCase().trim().replace(/[^\w\s]/g,"").replace(/\s+/g," "):""}areNamesMatching(e,t){return!!(e===t||e.includes(t)||t.includes(e))||this.calculateSimilarity(e,t)>.8}calculateSimilarity(e,t){let o=e.length>t.length?e:t,r=e.length>t.length?t:e;if(0===o.length)return 1;let c=this.levenshteinDistance(o,r);return(o.length-c)/o.length}levenshteinDistance(e,t){let o=[];for(let e=0;e<=t.length;e++)o[e]=[e];for(let t=0;t<=e.length;t++)o[0][t]=t;for(let r=1;r<=t.length;r++)for(let c=1;c<=e.length;c++)t.charAt(r-1)===e.charAt(c-1)?o[r][c]=o[r-1][c-1]:o[r][c]=Math.min(o[r-1][c-1]+1,o[r][c-1]+1,o[r-1][c]+1);return o[t.length][e.length]}async getProjectDetails(e,t){try{if(this.isCacheStale()&&(console.debug("\uD83D\uDCDD Cache is stale, refreshing project data..."),await this.syncProjects()),"clockify"===t||!t){let t=this.clockifyProjectsCache.get(e);if(t)return console.debug(`âœ… Found project in Clockify cache: ${t.name}`),this.convertClockifyToProjectDetails(t)}if("zoho"===t||!t){let t=this.zohoProjectsCache.get(e);if(t)return console.debug(`âœ… Found project in Zoho cache: ${t.project_name}`),this.convertZohoToProjectDetails(t)}let o=this.mappingCache.get(e);if(o){if(console.debug(`ðŸ“‹ Found project in mapping cache: ${o.name}`),o.clockifyId&&o.clockifyId!==e){let e=this.clockifyProjectsCache.get(o.clockifyId);if(e)return console.debug(`âœ… Found alternate project in Clockify: ${e.name}`),this.convertClockifyToProjectDetails(e)}if(o.zohoId&&o.zohoId!==e){let e=this.zohoProjectsCache.get(o.zohoId);if(e)return console.debug(`âœ… Found alternate project in Zoho: ${e.project_name}`),this.convertZohoToProjectDetails(e)}}return console.debug(`ðŸ” Project ${e} not in cache, fetching on-demand...`),await this.fetchProjectOnDemand(e,t)}catch(t){return console.debug(`âš ï¸ Could not get project details for ${e}:`,t),null}}async fetchProjectOnDemand(e,t){try{if("clockify"===t||!t)try{let t=(await r.e1.getProjects()).find(t=>t.id===e);if(t)return console.debug(`âœ… Fetched project from Clockify on-demand: ${t.name}`),this.clockifyProjectsCache.set(t.id,t),this.convertClockifyToProjectDetails(t)}catch(e){console.debug("âš ï¸ Clockify on-demand fetch failed:",e)}if("zoho"===t||!t)try{let t=(await c.VC.getProjects()).find(t=>t.project_id===e);if(t)return console.debug(`âœ… Fetched project from Zoho on-demand: ${t.project_name}`),this.zohoProjectsCache.set(t.project_id,t),this.convertZohoToProjectDetails(t)}catch(e){console.debug("âš ï¸ Zoho on-demand fetch failed:",e)}return console.debug(`âš ï¸ Could not fetch project ${e} from any source`),null}catch(e){return console.error("âŒ Error fetching project on-demand:",e),null}}convertClockifyToProjectDetails(e){return{id:e.id,name:e.name,clientName:e.clientName,billable:e.billable,archived:e.archived,source:"clockify",hourlyRate:"object"==typeof e.hourlyRate?e.hourlyRate.amount:e.hourlyRate,color:e.color}}convertZohoToProjectDetails(e){return{id:e.project_id,name:e.project_name,clientName:e.customer_name,billable:!0,archived:e.status?.toLowerCase()==="inactive"||e.status?.toLowerCase()==="closed",source:"zoho",projectId:e.project_id,customerId:e.customer_id,customerName:e.customer_name,signedFee:e.signed_fee}}isCacheStale(){return!this.lastSyncTime||Date.now()-this.lastSyncTime.getTime()>this.CACHE_TTL}getMappings(){return Array.from(this.mappingCache.values())}getOrphanedProjects(){return Array.from(this.mappingCache.values()).filter(e=>"orphaned"===e.status)}getClockifyOnlyProjects(){return Array.from(this.mappingCache.values()).filter(e=>"clockify-only"===e.status)}getZohoOnlyProjects(){return Array.from(this.mappingCache.values()).filter(e=>"zoho-only"===e.status)}clearCache(){this.mappingCache.clear(),this.clockifyProjectsCache.clear(),this.zohoProjectsCache.clear(),this.lastSyncTime=null,console.info("\uD83E\uDDF9 Project mapping cache cleared")}constructor(){this.mappingCache=new Map,this.clockifyProjectsCache=new Map,this.zohoProjectsCache=new Map,this.lastSyncTime=null,this.CACHE_TTL=3e5}}let i=new a;async function s(e,t){return await i.getProjectDetails(e,t)}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[9276,5972,8918,8403,7707],()=>o(11649));module.exports=r})();