"use strict";(()=>{var e={};e.id=7030,e.ids=[7030],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},54468:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>b,patchFetch:()=>j,requestAsyncStorage:()=>g,routeModule:()=>h,serverHooks:()=>y,staticGenerationAsyncStorage:()=>f});var o={};r.r(o),r.d(o,{GET:()=>p});var a=r(49303),i=r(88716),n=r(60670),l=r(87070),s=r(87707),u=r(88403);async function p(e,{params:t}){try{let e=t.projectId,r=u.ZP.getConfigurationStatus();console.log("Clockify service configuration for project metrics:",r);let o=null;try{o=(await s.VC.getProjects()).find(t=>t.project_id===e)}catch(e){return console.error("Failed to fetch projects from Zoho:",e),l.NextResponse.json({error:"Failed to fetch project data from Zoho"},{status:500})}if(!o)return l.NextResponse.json({error:"Project not found"},{status:404});let a=[],i=[],n=0,p=0;try{if(r.configured)try{let t=await u.ZP.getWorkspaces();if(0===t.length)throw Error("No workspaces available");let r=await u.ZP.getUsers(t[0].id),o=await u.ZP.getTimeEntries(e,new Date(Date.now()-31536e6).toISOString(),new Date().toISOString());a=r.map(e=>{let t=o.filter(t=>t.userId===e.id),r=t.reduce((e,t)=>{let r=t.timeInterval?.duration||"PT0H";return e+c(r)},0),a=t.filter(e=>e.billable).reduce((e,t)=>{let r=t.timeInterval?.duration||"PT0H";return e+c(r)},0),i=t.length>0?"object"==typeof t[0]?.hourlyRate?t[0].hourlyRate.amount:t[0]?.hourlyRate||150:150;return{employeeId:e.id,employeeName:e.name,totalHours:r,billableHours:a,hourlyRate:i,totalCost:r*i,billableValue:a*i,efficiency:r>0?a/r:0}}),n=(i=o.map(e=>({date:e.timeInterval?.start||new Date().toISOString(),employeeName:e.userName||"Unknown User",hours:c(e.timeInterval?.duration||"PT0H"),billableHours:e.billable?c(e.timeInterval?.duration||"PT0H"):0,description:e.description||"No description",hourlyRate:"object"==typeof e.hourlyRate?e.hourlyRate.amount:e.hourlyRate||150,totalValue:c(e.timeInterval?.duration||"PT0H")*("object"==typeof e.hourlyRate?e.hourlyRate.amount:e.hourlyRate||150)}))).reduce((e,t)=>e+t.hours,0),p=i.reduce((e,t)=>e+t.billableHours,0)}catch(e){console.warn("Failed to fetch Clockify data for project, using mock data:",e),a=d(),i=m(),n=120,p=96}else console.log("Clockify not configured - using mock data for project metrics"),a=d(),i=m(),n=120,p=96}catch(e){console.warn("Error processing employee/time data, using defaults:",e),a=d(),i=m(),n=120,p=96}let h=n>0?p/n:0,g=n-p,f=o.budget_amount||5e4,y=.6*f,b=.4*f,j=.8*y,I=y-j,w=y/f*100,x=new Date(Date.now()+7776e6).toISOString().split("T")[0],v=1.1*f,P={projectId:e,projectName:o.project_name||"Unknown Project",customerName:o.customer_name||"Unknown Customer",status:o.status||"unknown",startDate:o.created_time?new Date(o.created_time).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],endDate:o.last_modified_time?new Date(o.last_modified_time).toISOString().split("T")[0]:void 0,totalBudget:f,totalBilled:y,totalUnbilled:b,totalCollected:j,outstandingAmount:I,profitMargin:.25,grossProfit:.25*f,currentMultiplier:2.8,historicalMultipliers:[{date:"2024-01-01",multiplier:2.6,notes:"Q1 2024"},{date:"2024-04-01",multiplier:2.7,notes:"Q2 2024"},{date:"2024-07-01",multiplier:2.8,notes:"Q3 2024"}],totalHours:n,billableHours:p,nonBillableHours:g,efficiency:h,employeeBreakdown:a,timeEntries:i,cashBasis:{totalCollected:j,outstandingReceivables:I,totalRevenue:j},accrualBasis:{totalEarned:y,totalExpenses:.75*y,netIncome:.25*y,workInProgress:b},budgetUtilization:w,schedulePerformance:85,profitabilityTrend:"improving",riskLevel:w>80?"medium":"low",changeOrders:{count:2,totalValue:5e3,approvedValue:3e3,pendingValue:2e3},phases:[{phaseName:"Design",budget:15e3,actualCost:12e3,hours:40,completion:100},{phaseName:"Engineering",budget:2e4,actualCost:18e3,hours:60,completion:90},{phaseName:"Construction Admin",budget:15e3,actualCost:8e3,hours:20,completion:50}],projectedCompletion:x,projectedFinalCost:v,projectedProfit:.25*v,projectedMargin:.25};return l.NextResponse.json(P)}catch(e){return console.error("Project metrics API error:",e),l.NextResponse.json({error:"Failed to generate project metrics"},{status:500})}}function c(e){if(!e)return 0;let t=e.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);return t?parseInt(t[1]||"0")+parseInt(t[2]||"0")/60+parseInt(t[3]||"0")/3600:0}function d(){return[{employeeId:"emp-1",employeeName:"John Smith",totalHours:40,billableHours:32,hourlyRate:150,totalCost:6e3,billableValue:4800,efficiency:.8},{employeeId:"emp-2",employeeName:"Jane Doe",totalHours:35,billableHours:28,hourlyRate:175,totalCost:6125,billableValue:4900,efficiency:.8},{employeeId:"emp-3",employeeName:"Mike Johnson",totalHours:45,billableHours:36,hourlyRate:125,totalCost:5625,billableValue:4500,efficiency:.8}]}function m(){let e=[],t=["John Smith","Jane Doe","Mike Johnson"],r=["Design review","Engineering calculations","Site visit","Client meeting","Documentation"];for(let o=0;o<20;o++){let o=new Date(Date.now()-2592e6*Math.random()),a=2+6*Math.random(),i=Math.random()>.2?a:0;e.push({date:o.toISOString(),employeeName:t[Math.floor(Math.random()*t.length)],hours:a,billableHours:i,description:r[Math.floor(Math.random()*r.length)],hourlyRate:150+50*Math.random(),totalValue:a*(150+50*Math.random())})}return e}let h=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/dashboard/project/[projectId]/route",pathname:"/api/dashboard/project/[projectId]",filename:"route",bundlePath:"app/api/dashboard/project/[projectId]/route"},resolvedPagePath:"C:\\Users\\Jonathan\\Desktop\\Billing\\app\\api\\dashboard\\project\\[projectId]\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:g,staticGenerationAsyncStorage:f,serverHooks:y}=h,b="/api/dashboard/project/[projectId]/route";function j(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:f})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972,8918,8403,7707],()=>r(54468));module.exports=o})();