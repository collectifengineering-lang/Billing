"use strict";(()=>{var e={};e.id=8857,e.ids=[8857],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},27790:e=>{e.exports=require("assert")},84770:e=>{e.exports=require("crypto")},17702:e=>{e.exports=require("events")},92048:e=>{e.exports=require("fs")},32615:e=>{e.exports=require("http")},35240:e=>{e.exports=require("https")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},76162:e=>{e.exports=require("stream")},74175:e=>{e.exports=require("tty")},17360:e=>{e.exports=require("url")},21764:e=>{e.exports=require("util")},71568:e=>{e.exports=require("zlib")},14585:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>y,routeModule:()=>p,serverHooks:()=>j,staticGenerationAsyncStorage:()=>f});var r={};o.r(r),o.d(r,{GET:()=>d,dynamic:()=>u});var c=o(49303),s=o(88716),n=o(60670),a=o(87070),i=o(58489),l=o(88403),h=o(87707);let u="force-dynamic";async function d(e){try{console.info("\uD83D\uDD0D Checking synchronization status...");let e=l.e1.isConfigured(),t=h.VC.getStatus(),o=await i.gG.syncProjects(),r=o.totalProjects,c=o.syncedProjects,s=o.orphanedProjects,n=o.archivedProjects,u=r-n,d=u>0?Math.round(c/u*100):100,p="healthy",y="All systems operational";e&&t.hasToken?d<80?(p="warning",y="Low sync rate - review orphaned projects"):s>10&&(p="warning",y="High number of orphaned projects"):(p="error",y="API configuration issues detected");let f={status:p,message:y,timestamp:new Date().toISOString(),services:{clockify:{configured:e,status:e?"operational":"not configured"},zoho:{configured:t.hasToken,tokenExpires:t.expiresIn>0?`in ${Math.round(t.expiresIn/6e4)} minutes`:"expired",status:t.hasToken&&!t.isExpired?"operational":"token expired or missing"}},synchronization:{totalProjects:r,syncedProjects:c,clockifyOnlyProjects:o.clockifyOnlyProjects,zohoOnlyProjects:o.zohoOnlyProjects,orphanedProjects:s,archivedProjects:n,healthScore:d,lastSyncedAt:o.timestamp},recommendations:function(e,t,o){let r=[];t||r.push("\uD83D\uDD27 Configure Clockify API credentials in environment variables"),(!o.hasToken||o.isExpired)&&r.push("\uD83D\uDD27 Refresh Zoho API token - check authentication configuration"),e.orphanedProjects>5&&r.push(`ðŸ“‹ Review ${e.orphanedProjects} orphaned projects - run audit: npm run audit:projects`),e.archivedProjects>20&&r.push(`ðŸ—„ï¸ Consider cleaning up ${e.archivedProjects} archived projects to reduce noise`);let c=e.totalProjects-e.archivedProjects;return(c>0?e.syncedProjects/c*100:100)<80&&r.push("âš ï¸ Low sync rate detected - create missing projects in Clockify or Zoho"),e.clockifyOnlyProjects>3&&r.push(`ðŸ“Š ${e.clockifyOnlyProjects} projects exist only in Clockify - consider syncing to Zoho`),e.zohoOnlyProjects>3&&r.push(`ðŸ“Š ${e.zohoOnlyProjects} projects exist only in Zoho - consider syncing to Clockify`),0===r.length&&r.push("âœ… No issues detected - system is healthy"),r}(o,e,t)};return console.info("âœ… Sync status check complete:",{health:p,score:d,synced:c,total:r}),a.NextResponse.json({success:!0,data:f})}catch(e){return console.error("âŒ Error checking sync status:",e),a.NextResponse.json({success:!1,error:"Failed to check synchronization status",message:e.message||"An unexpected error occurred"},{status:500})}}let p=new c.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/sync-status/route",pathname:"/api/sync-status",filename:"route",bundlePath:"app/api/sync-status/route"},resolvedPagePath:"C:\\Users\\Jonathan\\Desktop\\Billing\\app\\api\\sync-status\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:j}=p,m="/api/sync-status/route";function g(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:f})}},58489:(e,t,o)=>{o.d(t,{gG:()=>n,lu:()=>a});var r=o(88403),c=o(87707);class s{async syncProjects(){console.info("\uD83D\uDD04 Starting project synchronization...");try{let[e,t]=await Promise.allSettled([r.e1.getProjects(),c.VC.getProjects()]),o="fulfilled"===e.status?e.value:[],s="fulfilled"===t.status?t.value:[];console.info(`ðŸ“Š Fetched ${o.length} Clockify projects and ${s.length} Zoho projects`),this.clockifyProjectsCache.clear(),this.zohoProjectsCache.clear(),o.forEach(e=>{this.clockifyProjectsCache.set(e.id,e)}),s.forEach(e=>{this.zohoProjectsCache.set(e.project_id,e)});let n=this.createProjectMappings(o,s);this.mappingCache.clear(),n.forEach(e=>{let t=e.clockifyId||e.zohoId||e.name;this.mappingCache.set(t,e)}),this.lastSyncTime=new Date;let a={totalProjects:n.length,syncedProjects:n.filter(e=>"synced"===e.status).length,clockifyOnlyProjects:n.filter(e=>"clockify-only"===e.status).length,zohoOnlyProjects:n.filter(e=>"zoho-only"===e.status).length,orphanedProjects:n.filter(e=>"orphaned"===e.status).length,archivedProjects:n.filter(e=>e.archived).length,mappings:n,timestamp:new Date};return console.info("âœ… Project synchronization complete:",{total:a.totalProjects,synced:a.syncedProjects,clockifyOnly:a.clockifyOnlyProjects,zohoOnly:a.zohoOnlyProjects,orphaned:a.orphanedProjects,archived:a.archivedProjects}),a}catch(e){throw console.error("âŒ Error synchronizing projects:",e),e}}createProjectMappings(e,t){let o=[],r=new Set;return e.forEach(e=>{let c=this.normalizeName(e.name),s=t.find(e=>{if(r.has(e.project_id))return!1;let t=this.normalizeName(e.project_name);return this.areNamesMatching(c,t)});s?(r.add(s.project_id),o.push({clockifyId:e.id,clockifyName:e.name,zohoId:s.project_id,zohoName:s.project_name,name:e.name,status:"synced",archived:e.archived||!1,lastSyncedAt:new Date})):o.push({clockifyId:e.id,clockifyName:e.name,name:e.name,status:e.archived?"orphaned":"clockify-only",archived:e.archived||!1,lastSyncedAt:new Date})}),t.forEach(e=>{if(!r.has(e.project_id)){let t=e.status?.toLowerCase()==="inactive"||e.status?.toLowerCase()==="closed";o.push({zohoId:e.project_id,zohoName:e.project_name,name:e.project_name,status:t?"orphaned":"zoho-only",archived:t,lastSyncedAt:new Date})}}),o}normalizeName(e){return e?e.toLowerCase().trim().replace(/[^\w\s]/g,"").replace(/\s+/g," "):""}areNamesMatching(e,t){return!!(e===t||e.includes(t)||t.includes(e))||this.calculateSimilarity(e,t)>.8}calculateSimilarity(e,t){let o=e.length>t.length?e:t,r=e.length>t.length?t:e;if(0===o.length)return 1;let c=this.levenshteinDistance(o,r);return(o.length-c)/o.length}levenshteinDistance(e,t){let o=[];for(let e=0;e<=t.length;e++)o[e]=[e];for(let t=0;t<=e.length;t++)o[0][t]=t;for(let r=1;r<=t.length;r++)for(let c=1;c<=e.length;c++)t.charAt(r-1)===e.charAt(c-1)?o[r][c]=o[r-1][c-1]:o[r][c]=Math.min(o[r-1][c-1]+1,o[r][c-1]+1,o[r-1][c]+1);return o[t.length][e.length]}async getProjectDetails(e,t){try{if(this.isCacheStale()&&(console.debug("\uD83D\uDCDD Cache is stale, refreshing project data..."),await this.syncProjects()),"clockify"===t||!t){let t=this.clockifyProjectsCache.get(e);if(t)return console.debug(`âœ… Found project in Clockify cache: ${t.name}`),this.convertClockifyToProjectDetails(t)}if("zoho"===t||!t){let t=this.zohoProjectsCache.get(e);if(t)return console.debug(`âœ… Found project in Zoho cache: ${t.project_name}`),this.convertZohoToProjectDetails(t)}let o=this.mappingCache.get(e);if(o){if(console.debug(`ðŸ“‹ Found project in mapping cache: ${o.name}`),o.clockifyId&&o.clockifyId!==e){let e=this.clockifyProjectsCache.get(o.clockifyId);if(e)return console.debug(`âœ… Found alternate project in Clockify: ${e.name}`),this.convertClockifyToProjectDetails(e)}if(o.zohoId&&o.zohoId!==e){let e=this.zohoProjectsCache.get(o.zohoId);if(e)return console.debug(`âœ… Found alternate project in Zoho: ${e.project_name}`),this.convertZohoToProjectDetails(e)}}return console.debug(`ðŸ” Project ${e} not in cache, fetching on-demand...`),await this.fetchProjectOnDemand(e,t)}catch(t){return console.debug(`âš ï¸ Could not get project details for ${e}:`,t),null}}async fetchProjectOnDemand(e,t){try{if("clockify"===t||!t)try{let t=(await r.e1.getProjects()).find(t=>t.id===e);if(t)return console.debug(`âœ… Fetched project from Clockify on-demand: ${t.name}`),this.clockifyProjectsCache.set(t.id,t),this.convertClockifyToProjectDetails(t)}catch(e){console.debug("âš ï¸ Clockify on-demand fetch failed:",e)}if("zoho"===t||!t)try{let t=(await c.VC.getProjects()).find(t=>t.project_id===e);if(t)return console.debug(`âœ… Fetched project from Zoho on-demand: ${t.project_name}`),this.zohoProjectsCache.set(t.project_id,t),this.convertZohoToProjectDetails(t)}catch(e){console.debug("âš ï¸ Zoho on-demand fetch failed:",e)}return console.debug(`âš ï¸ Could not fetch project ${e} from any source`),null}catch(e){return console.error("âŒ Error fetching project on-demand:",e),null}}convertClockifyToProjectDetails(e){return{id:e.id,name:e.name,clientName:e.clientName,billable:e.billable,archived:e.archived,source:"clockify",hourlyRate:"object"==typeof e.hourlyRate?e.hourlyRate.amount:e.hourlyRate,color:e.color}}convertZohoToProjectDetails(e){return{id:e.project_id,name:e.project_name,clientName:e.customer_name,billable:!0,archived:e.status?.toLowerCase()==="inactive"||e.status?.toLowerCase()==="closed",source:"zoho",projectId:e.project_id,customerId:e.customer_id,customerName:e.customer_name,signedFee:e.signed_fee}}isCacheStale(){return!this.lastSyncTime||Date.now()-this.lastSyncTime.getTime()>this.CACHE_TTL}getMappings(){return Array.from(this.mappingCache.values())}getOrphanedProjects(){return Array.from(this.mappingCache.values()).filter(e=>"orphaned"===e.status)}getClockifyOnlyProjects(){return Array.from(this.mappingCache.values()).filter(e=>"clockify-only"===e.status)}getZohoOnlyProjects(){return Array.from(this.mappingCache.values()).filter(e=>"zoho-only"===e.status)}clearCache(){this.mappingCache.clear(),this.clockifyProjectsCache.clear(),this.zohoProjectsCache.clear(),this.lastSyncTime=null,console.info("\uD83E\uDDF9 Project mapping cache cleared")}constructor(){this.mappingCache=new Map,this.clockifyProjectsCache=new Map,this.zohoProjectsCache=new Map,this.lastSyncTime=null,this.CACHE_TTL=3e5}}let n=new s;async function a(e,t){return await n.getProjectDetails(e,t)}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[9276,5972,8918,8403,7707],()=>o(14585));module.exports=r})();