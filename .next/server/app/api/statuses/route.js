"use strict";(()=>{var e={};e.id=324,e.ids=[324],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29972:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>x,patchFetch:()=>_,requestAsyncStorage:()=>m,routeModule:()=>h,serverHooks:()=>j,staticGenerationAsyncStorage:()=>g});var r={};s.r(r),s.d(r,{DELETE:()=>l,GET:()=>d,POST:()=>p,dynamic:()=>i});var o=s(49303),a=s(88716),n=s(60670),u=s(87070),c=s(52663);let i="force-dynamic";async function d(){try{console.log("Fetching statuses from database...");let e=await c.Z.status.findMany();console.log("Fetched",e.length,"statuses from database");let t=e.reduce((e,t)=>(e[t.projectId]||(e[t.projectId]={}),e[t.projectId][t.month]=t.status,e),{});return u.NextResponse.json(t)}catch(e){if(console.error("Error fetching statuses:",e),"P2021"===e.code||e.message?.includes("does not exist"))return console.log("Tables do not exist, returning empty statuses"),u.NextResponse.json({});return u.NextResponse.json({error:"Failed to fetch statuses"},{status:500})}}async function p(e){let{projectId:t,month:s,status:r}=await e.json();try{return console.log("Updating status for project:",t,"month:",s),await c.Z.status.upsert({where:{projectId_month:{projectId:t,month:s}},update:{status:r},create:{projectId:t,month:s,status:r}}),console.log("Status updated successfully"),u.NextResponse.json({success:!0})}catch(e){if(console.error("Error updating status:",e),"P2021"===e.code||e.message?.includes("does not exist")){console.log("Table does not exist, attempting to create schema...");try{return await c.Z.status.create({data:{projectId:"__test__",month:"__test__",status:"test"}}),await c.Z.status.deleteMany({where:{projectId:"__test__",month:"__test__"}}),await c.Z.status.upsert({where:{projectId_month:{projectId:t,month:s}},update:{status:r},create:{projectId:t,month:s,status:r}}),u.NextResponse.json({success:!0})}catch(e){return console.error("Failed to create table:",e),u.NextResponse.json({error:"Database schema not ready. Please run database setup first."},{status:500})}}return u.NextResponse.json({error:"Failed to update status"},{status:500})}}async function l(e){let{projectId:t,month:s}=await e.json();try{return await c.Z.status.delete({where:{projectId_month:{projectId:t,month:s}}}),u.NextResponse.json({success:!0})}catch(e){if("P2025"===e.code)return u.NextResponse.json({success:!0});return console.error("Error deleting status:",e),u.NextResponse.json({error:"Failed to delete status"},{status:500})}}let h=new o.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/statuses/route",pathname:"/api/statuses",filename:"route",bundlePath:"app/api/statuses/route"},resolvedPagePath:"C:\\Users\\Jonathan\\Desktop\\Billing\\app\\api\\statuses\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:m,staticGenerationAsyncStorage:g,serverHooks:j}=h,x="/api/statuses/route";function _(){return(0,n.patchFetch)({serverHooks:j,staticGenerationAsyncStorage:g})}},52663:(e,t,s)=>{s.d(t,{Z:()=>o});let r=require("@prisma/client"),o=globalThis.prisma??new r.PrismaClient({log:["error"]})}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972],()=>s(29972));module.exports=r})();